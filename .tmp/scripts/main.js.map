{"version":3,"sources":["main.js"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["/*eslint-env browser, jquery */\n/*global Base64, bootstrapHelpers, ol, commonsModule, htmlEditorModule, importModule, mapControlsModule, mapLayersModule, MapModule, pickerModule, roadbookModule, styleModule, swal */\n/**\n* @fileOverview TinyRoadbook application\n* @author Christophe Boisier\n* @version: 0.1.9\n*/\n\n/**\n* Main module.\n* @module\n* @external $\n* @external Base64\n* @external bootstrapHelpers\n* @external commonsModule\n* @external htmlEditorModule\n* @external importModule\n* @external mapControlsModule\n* @external mapLayersModule\n* @external MapModule\n* @external ol\n* @external pickerModule\n* @external roadbookModule\n* @external styleModule\n* @external swal\n* @return {Object} Public functions / variables\n*/\n/*eslint-disable no-unused-vars*/\nvar appModule = (function () {\n    /*eslint-enable no-unused-vars*/\n    'use strict';\n\n    var debug = ((parseInt($.urlParam('debug'))) ? true : false); // (document.domain === 'localhost')\n    var mapMod1;\n    var mapIconsStyle;\n    var selectedLayer;\n\n    // Start debugging\n    commonsModule.init({\n        debug: debug\n    });\n    mapLayersModule.settings.debug = debug;\n\n    //commonsModule.loadWebFonts();\n\n    swal.setDefaults({\n        buttonsStyling: false,\n        confirmButtonClass: 'btn btn-primary',\n        cancelButtonClass: 'btn btn-default'\n    });\n\n    // Define map base layers\n    var openCycleMapLayer = mapLayersModule.create('openCycleMap');\n    var openStreetMapLayer = mapLayersModule.create('openStreetMap', {visible: true});\n    var mapsForFreeReliefLayer = mapLayersModule.create('mapsForFreeRelief');\n    var customBaseLayerLayer = mapLayersModule.create('customBaseLayer');\n    var googleMapLayer = mapLayersModule.create('googleMap');\n    var googleTerrainLayer = mapLayersModule.create('googleTerrain');\n    var googleSatelliteLayer = mapLayersModule.create('googleSatellite');\n    var mapquestOSMLayer = mapLayersModule.create('mapquestOSM');\n    var mapquestSatLayer = mapLayersModule.create('mapquestSat');\n\n    // Define map overlays\n    var gpxFileLayer = mapLayersModule.create('gpxFile', {zIndex: 8});\n    var googleHybridLayer = mapLayersModule.create('googleHybrid', {zIndex: 7});\n    var googleBikeLayer = mapLayersModule.create('googleBike', {zIndex: 6});\n    var lonviaCyclingLayer = mapLayersModule.create('lonviaCycling', {zIndex: 5});\n    var lonviaHikingLayer = mapLayersModule.create('lonviaHiking', {zIndex: 4});\n    var mapquestHybLayer = mapLayersModule.create('mapquestHyb', {zIndex: 3});\n    var uniHeidelbergAsterhLayer = mapLayersModule.create('uniHeidelbergAsterh', {zIndex: 2});\n    var customOverlayLayer = mapLayersModule.create('customOverlay', {zIndex: 1});\n\n    // Define map controls\n    var attributionControl = mapControlsModule.create('attribution');\n    var scaleLineControl = mapControlsModule.create('scaleLine');\n    var fullScreenControl = mapControlsModule.create('fullScreen');\n    var layerSwitcherControl = mapControlsModule.create('layerSwitcher');\n    var zoomSliderControl = mapControlsModule.create('zoomSlider');\n\n    // Check if the godfather mode must be enabled via URL parameters\n    var godfatherMode = (parseInt($.urlParam('godfather'))) ? true : false; // || (document.domain === 'localhost')\n    console.log('Godfather mode', godfatherMode);\n\n\n\n    /**\n    * Load the Addthis widget library and update parameters when the roadbook change\n    * @private\n    */\n    var initAddthisWidget = function () {\n\n        // Default config\n        /*eslint-disable camelcase*/\n        var addthis_share = {\n            url: document.URL\n            , title: 'I\\'m doing a tiny roadbook for my next tour'\n        };\n        /*eslint-enable camelcase*/\n\n        // Load the Addthis widget library\n        //$.getScript('https://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5689e8d8b9037927', function () {\n        //    console.log('Addthis widget library loaded');\n\n        // Watch roadbook editor changes\n        var editor = roadbookModule.getEditor();\n        editor.on('text-change', function () {\n\n            // Update Addthis widget data attributs\n            // http://support.addthis.com/customer/portal/topics/38604-customizing-addthis/articles\n            var description = editor.getText();\n            $.extend(addthis_share, {\n                description: description.substring(0, 100) + ((description.length > 100) ? '...' : '')\n                //image: (canvas ? canvas.toDataURL('image/png') : '')\n            });\n\n            //$('.addthis_sharing_toolbox')\n            //    .attr('data-title', 'I\\'m doing a tiny road book for my next tour')\n            //    .attr('data-title', 'I\\'m doing a tiny road book for my next tour');\n            //$('meta[property=\"og:title\"]').attr('content', addthis_share.title);\n            //$('meta[property=\"og:url\"]').attr('content', addthis_share.url);\n            //$('meta[property=\"og:description\"]').attr('content', editor.getHTML());\n\n        });\n\n        //});\n\n    };\n\n\n\n    /**\n    * Build a valid HTML file with the editor content\n    * @public\n    * @return {String} HTML file content\n    */\n    var buildExport = function () {\n\n        var htmlDoc = '';\n        var dfd = new $.Deferred();\n\n        var roadbookEditor = roadbookModule.getEditor();\n        var styleEditor = styleModule.getEditor();\n\n        var title = window.location.hostname;\n        var $input = $('#roadbook_title');\n        if ($input && $input.val()) {\n            title = $input.val();\n        }\n\n        var description = '';\n        $input = $('#roadbook_description');\n        if ($input && $input.val()) {\n            description = $input.val();\n        }\n\n        if (roadbookEditor && styleEditor && mapIconsStyle) {\n            htmlDoc = '<html>\\n'\n            + '<head>\\n'\n            + '<title>' + title + '</title>\\n'\n            + '<meta content=\"text/html; charset=UTF-8\" http-equiv=\"content-type\">\\n'\n            + '<meta name=\"description\" content=\"' + description + '\">\\n'\n            + '<style type=\"text/css\">\\n'\n            + styleEditor.getText() + '\\n'\n            + mapIconsStyle + '\\n'\n            + '</style>\\n'\n            + '</head>\\n'\n            + '<body>\\n'\n            + '<div class=\"roadbook\">\\n'\n            + roadbookEditor.getHTML() + '\\n'\n            + '</div>\\n'\n            + '</body>\\n'\n            + '</html>';\n\n            dfd.resolve(htmlDoc);\n        }\n\n        return dfd;\n\n    };\n\n\n\n    /**\n    * Rebuild the save link URL\n    * @public\n    * @return {String} HTML file content\n    */\n    var updateSaveLink = function () {\n\n        buildExport().done(function (htmlDoc) {\n            if (htmlDoc) {\n                $('.save_roadbook').attr('href', 'data:text/html;base64, ' + Base64.encode(htmlDoc));\n            }\n        });\n\n        var $input = $('#roadbook_title');\n        if ($input) {\n            var filename = $.trim($input.val() || document.domain).replace(/\\s+/gi, '_').replace(/[^a-zA-Z0-9\\_-]/gi, '') + '.html';\n            $('.save_roadbook').attr('download', filename);\n        }\n\n    };\n\n\n\n    /**\n    * Initialize an OL3 map\n    * @private\n    * @param {target} target - Map div selector\n    * @return {object} - The map object\n    */\n    var initMap = function (target) {\n\n        var layers;\n\n        if (!godfatherMode) {\n            layers = [\n                new ol.layer.Group({\n                    name: 'baseLayers',\n                    title: 'Base map',\n                    layers: [\n                        customBaseLayerLayer,\n                        mapquestSatLayer,\n                        openCycleMapLayer,\n                        mapquestOSMLayer,\n                        openStreetMapLayer\n                    ]\n                }),\n                new ol.layer.Group({\n                    name: 'overlays',\n                    title: 'Overlays',\n                    layers: [\n                        customOverlayLayer,\n                        mapquestHybLayer,\n                        lonviaHikingLayer,\n                        lonviaCyclingLayer,\n                        gpxFileLayer\n                    ]\n                })\n            ];\n        } else {\n            layers = [\n                new ol.layer.Group({\n                    name: 'baseLayers',\n                    title: 'Base map',\n                    layers: [\n                        customBaseLayerLayer,\n                        googleSatelliteLayer,\n                        mapquestSatLayer,\n                        googleTerrainLayer,\n                        mapsForFreeReliefLayer,\n                        openCycleMapLayer,\n                        googleMapLayer,\n                        mapquestOSMLayer,\n                        openStreetMapLayer\n                    ]\n                }),\n                new ol.layer.Group({\n                    name: 'overlays',\n                    title: 'Overlays',\n                    layers: [\n                        customOverlayLayer,\n                        uniHeidelbergAsterhLayer,\n                        mapquestHybLayer,\n                        lonviaHikingLayer,\n                        lonviaCyclingLayer,\n                        googleBikeLayer,\n                        googleHybridLayer,\n                        gpxFileLayer\n                    ]\n                })\n            ];\n        }\n        var controls = ol.control.defaults({\n            attribution: false,\n            attributionOptions: /** @type {olx.control.AttributionOptions} */ ({\n                collapsible: false\n            }),\n            zoomOptions: {\n\n            }\n        }).extend([\n            attributionControl,\n            scaleLineControl,\n            fullScreenControl,\n            zoomSliderControl,\n            layerSwitcherControl\n        ]);\n\n        return new ol.Map({\n            layers: layers,\n            target: target,\n            view: new ol.View({\n                center: [0, 0],\n                zoom: 4,\n                minZoom: 2,\n                maxZoom: 19\n            }),\n            controls: controls,\n            logo: false\n        });\n\n    };\n\n\n\n\n    /**\n    * Document ready\n    */\n    $(function () {\n\n        // Initialize mandatory modules\n        console.time('Bootstrap module initialized');\n        bootstrapHelpers.init({\n            debug: debug\n        });\n\n        roadbookModule.init();\n        htmlEditorModule.init();\n        styleModule.init();\n        importModule.init();\n\n        initAddthisWidget();\n\n        var $input;\n\n        var $tabs = $('a[data-toggle=\"tab\"]');\n\n        // Initialize the home pane functionalities only when visible for the first time\n        //$tabs.filter('[href=\"#home_pane\"]').one('shown.bs.tab', function () {\n        //    commonsModule.parallax();\n        //});\n\n        // Initialize the editor pane functionalities only when visible for the first time\n        $tabs.filter('[href=\"#editor_pane\"]').one('shown.bs.tab', function () {\n\n            // Several links may open the pane, so this prevent initializing several maps\n            if (mapMod1) {\n                return false;\n            }\n\n            mapMod1 = new MapModule(initMap('map'), {\n                debug: debug\n            });\n            console.log('Map initialized');\n\n            /*\n            // Try to restore map center and zoom from the local storage\n            if (!mapMod1.restoreMapProperties()) {\n            // Or center map on user position and set a default zoom\n            mapMod1.setCenterOnPosition();\n            mapMod1.map.getView().setZoom(12);\n        }\n        // Check map events and store changes to local storage\n        mapMod1.storeMapChanges();\n        */\n\n        // Redraw the map and update classes when the map width input value change\n        $('#map_width').on('change', function () {\n            $tabs.filter('[href=\"#editor_pane\"]').one('shown.bs.tab', function () {\n                mapMod1.updateSize();\n            });\n        });\n\n        // Initialize the picker module\n        pickerModule.watchMapClick(mapMod1.map);\n\n        // On layer change, adjust zoom delta depending on selected base layer\n        // zoomDelta = -2;\n\n        // Select the layer passed to the modal\n        $('#layer_settings_modal').on('show.bs.modal', function (e) {\n            var $modal = $(this);\n\n            // Select the layer passed as link attribute\n            var layerVarName = $(e.relatedTarget).data('layer') + 'Layer';\n            if (typeof layerVarName !== 'undefined') {\n                /*eslint-disable no-eval*/\n                selectedLayer = eval(layerVarName);\n                /*eslint-enable no-eval*/\n            }\n\n            if (selectedLayer) {\n\n                // Populate fields with the selected layer properties\n                // hide unwanted field groups\n                // validate form and update layer values\n                mapLayersModule.initSettingsForm(selectedLayer, '#layer_settings_form', '.form-group');\n                //mapLayersModule.initSettingsForm(selectedLayer, '#layer_settings_form', '.form-group, fieldset');\n\n                // Change modal title\n                var title = selectedLayer.get('title');\n                $modal.find('.modal-title').html(title);\n\n                // Initialize tooltip for range inputs\n                bootstrapHelpers.rangeValueTooltip();\n            }\n\n        });\n\n        // Update map overlay when user click ok\n        $('#layer_settings_form').on('submit', function (e) {\n            e.preventDefault();\n            var $modal = $('#layer_settings_modal');\n            $modal.modal('hide');\n        });\n\n        commonsModule.hideHashOnClick('#map .layer-switcher');\n\n        // Add a link to settings beside each layer labels (layerswitcher)\n        /*$('.layer-switcher').find('input').filter('[data-layer]').each(function () {\n        $input = $(this);\n        var layerName = $input.data('layer');\n        $input.next('label').append(' <a href=\"#layer_settings_modal\" data-toggle=\"modal\" data-layer=\"' + layerName + '\">'\n        + '<span class=\"glyphicon glyphicon-cog\"></span></a>');\n    });*/\n\n    // Force the Bootstrap modal API to initialize the layerswitcher links\n    $('.layer-switcher').on('click', 'a[data-toggle=\"modal\"]', function (e) {\n        e.preventDefault();\n        //window.location.hash = '';\n        $(this).trigger('click.bs.modal.data-api');\n    });\n\n});\n\n// Initialize the settings pane functionalities only when visible for the first time\n$tabs.filter('[href=\"#settings_pane\"]').one('shown.bs.tab', function () {\n\n});\n\n// Initialize the style pane functionalities only when visible for the first time\n$tabs.filter('[href=\"#style_pane\"]').one('shown.bs.tab', function () {\n\n});\n\n// Hide the modal when the form is submited\n/*var $modal;\n$('.modal').each(function () {\n$modal = $(this);\n$modal.find('form').on('submit', function (e) {\ne.preventDefault();\n$modal.modal('hide');\n});\n});*/\n\n// Load icon styles if not already\n$.get('styles/osm.css', function(data) {\n    mapIconsStyle = data;\n    updateSaveLink();\n});\n\n// Build a file list preview when input change\n$input = $('#gpx_file');\n$input.on('change', function (e) {\n    var files = e.target.files;\n    var output = bootstrapHelpers.buildFileList(files);\n    $('#' + $input.attr('id') + '_output').html(output);\n});\n\n// Clone the file settings to the modal body\n//$('#file_settings_modal .modal-body').html($('#file_settings').clone(true, true));\n/*$('#file_settings_modal')\n.on('show.bs.modal', function () {\nvar $modal = $(this);\n$modal.find('.modal-body').html($('#file_settings').clone(true, true));\n})\n.on('hide.bs.modal', function () {\nvar $modal = $(this);\n$('#file_settings').html($modal.find('.modal-body').clone());\n});*/\n\n});\n\n\n\nreturn {\n    mapMod1: mapMod1,\n    buildExport: buildExport,\n    updateSaveLink: updateSaveLink\n};\n\n})();\n"],"sourceRoot":"/source/"}