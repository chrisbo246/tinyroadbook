{"version":3,"sources":["main.js"],"names":["appModule","debug","parseInt","$","urlParam","mapMod1","mapIconsStyle","selectedLayer","commonsModule","init","mapLayersModule","settings","swal","setDefaults","buttonsStyling","confirmButtonClass","cancelButtonClass","openCycleMapLayer","create","openStreetMapLayer","visible","mapsForFreeReliefLayer","customBaseLayerLayer","googleMapLayer","googleTerrainLayer","googleSatelliteLayer","gpxFileLayer","zIndex","googleHybridLayer","googleBikeLayer","lonviaCyclingLayer","lonviaHikingLayer","uniHeidelbergAsterhLayer","customOverlayLayer","attributionControl","mapControlsModule","scaleLineControl","fullScreenControl","layerSwitcherControl","zoomSliderControl","godfatherMode","console","log","initAddthisWidget","addthis_share","url","document","URL","title","editor","roadbookModule","getEditor","on","description","getText","extend","substring","length","buildExport","htmlDoc","dfd","Deferred","roadbookEditor","styleEditor","styleModule","window","location","hostname","$input","val","lang","getHTML","resolve","updateSaveLink","done","attr","Base64","encode","filename","trim","domain","replace","initMap","target","layers","ol","layer","Group","name","controls","control","defaults","attribution","attributionOptions","collapsible","zoomOptions","Map","view","View","center","zoom","minZoom","maxZoom","logo","time","bootstrapHelpers","htmlEditorModule","roadbookImportModule","$tabs","filter","one","MapModule","updateSize","pickerModule","watchMapClick","map","e","$modal","layerVarName","relatedTarget","data","eval","initSettingsForm","get","find","html","rangeValueTooltip","preventDefault","modal","hideHashOnClick","trigger","files","output","buildFileList"],"mappings":"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","file":"main.js","sourcesContent":["/*eslint-env browser, jquery */\r\n/*global Base64, bootstrapHelpers, ol, commonsModule, htmlEditorModule, roadbookImportModule, mapControlsModule, mapLayersModule, MapModule, pickerModule, roadbookModule, styleModule, swal */\r\n/**\r\n* @fileOverview TinyRoadbook application\r\n* @author Christophe Boisier\r\n* @version: 0.1.9\r\n*/\r\n\r\n/**\r\n* Main module.\r\n* @module\r\n* @external $\r\n* @external Base64\r\n* @external bootstrapHelpers\r\n* @external commonsModule\r\n* @external htmlEditorModule\r\n* @external roadbookImportModule\r\n* @external mapControlsModule\r\n* @external mapLayersModule\r\n* @external MapModule\r\n* @external ol\r\n* @external pickerModule\r\n* @external roadbookModule\r\n* @external styleModule\r\n* @external swal\r\n* @return {Object} Public functions / variables\r\n*/\r\n/*eslint-disable no-unused-vars*/\r\nvar appModule = (function () {\r\n    /*eslint-enable no-unused-vars*/\r\n    'use strict';\r\n\r\n    var debug = ((parseInt($.urlParam('debug'))) ? true : false); // (document.domain === 'localhost')\r\n    var mapMod1;\r\n    var mapIconsStyle;\r\n    var selectedLayer;\r\n\r\n    // Start debugging\r\n    commonsModule.init({\r\n        debug: debug\r\n    });\r\n    mapLayersModule.settings.debug = debug;\r\n\r\n    //commonsModule.loadWebFonts();\r\n\r\n    swal.setDefaults({\r\n        buttonsStyling: false,\r\n        confirmButtonClass: 'btn btn-primary',\r\n        cancelButtonClass: 'btn btn-default'\r\n    });\r\n\r\n    // Define map base layers\r\n    var openCycleMapLayer = mapLayersModule.create('openCycleMap');\r\n    var openStreetMapLayer = mapLayersModule.create('openStreetMap', {visible: true});\r\n    var mapsForFreeReliefLayer = mapLayersModule.create('mapsForFreeRelief');\r\n    var customBaseLayerLayer = mapLayersModule.create('customBaseLayer');\r\n    var googleMapLayer = mapLayersModule.create('googleMap');\r\n    var googleTerrainLayer = mapLayersModule.create('googleTerrain');\r\n    var googleSatelliteLayer = mapLayersModule.create('googleSatellite');\r\n    //var mapquestOSMLayer = mapLayersModule.create('mapquestOSM');\r\n    //var mapquestSatLayer = mapLayersModule.create('mapquestSat');\r\n\r\n    // Define map overlays\r\n    var gpxFileLayer = mapLayersModule.create('gpxFile', {zIndex: 8});\r\n    var googleHybridLayer = mapLayersModule.create('googleHybrid', {zIndex: 7});\r\n    var googleBikeLayer = mapLayersModule.create('googleBike', {zIndex: 6});\r\n    var lonviaCyclingLayer = mapLayersModule.create('lonviaCycling', {zIndex: 5});\r\n    var lonviaHikingLayer = mapLayersModule.create('lonviaHiking', {zIndex: 4});\r\n    //var mapquestHybLayer = mapLayersModule.create('mapquestHyb', {zIndex: 3});\r\n    var uniHeidelbergAsterhLayer = mapLayersModule.create('uniHeidelbergAsterh', {zIndex: 2});\r\n    var customOverlayLayer = mapLayersModule.create('customOverlay', {zIndex: 1});\r\n\r\n    // Define map controls\r\n    var attributionControl = mapControlsModule.create('attribution');\r\n    var scaleLineControl = mapControlsModule.create('scaleLine');\r\n    var fullScreenControl = mapControlsModule.create('fullScreen');\r\n    var layerSwitcherControl = mapControlsModule.create('layerSwitcher');\r\n    var zoomSliderControl = mapControlsModule.create('zoomSlider');\r\n\r\n    // Check if the godfather mode must be enabled via URL parameters\r\n    var godfatherMode = (parseInt($.urlParam('godfather'))) ? true : false; // || (document.domain === 'localhost')\r\n    console.log('Godfather mode', godfatherMode);\r\n\r\n\r\n\r\n    /**\r\n    * Load the Addthis widget library and update parameters when the roadbook change\r\n    * @private\r\n    */\r\n    var initAddthisWidget = function () {\r\n\r\n        // Default config\r\n        /*eslint-disable camelcase*/\r\n        var addthis_share = {\r\n            url: document.URL\r\n            , title: 'I\\'m doing a tiny roadbook for my next tour'\r\n        };\r\n        /*eslint-enable camelcase*/\r\n\r\n        // Load the Addthis widget library\r\n        //$.getScript('https://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5689e8d8b9037927', function () {\r\n        //    console.log('Addthis widget library loaded');\r\n\r\n        // Watch roadbook editor changes\r\n        var editor = roadbookModule.getEditor();\r\n        editor.on('text-change', function () {\r\n\r\n            // Update Addthis widget data attributs\r\n            // http://support.addthis.com/customer/portal/topics/38604-customizing-addthis/articles\r\n            var description = editor.getText();\r\n            $.extend(addthis_share, {\r\n                description: description.substring(0, 100) + ((description.length > 100) ? '...' : '')\r\n                //image: (canvas ? canvas.toDataURL('image/png') : '')\r\n            });\r\n\r\n            //$('.addthis_sharing_toolbox')\r\n            //    .attr('data-title', 'I\\'m doing a tiny road book for my next tour')\r\n            //    .attr('data-title', 'I\\'m doing a tiny road book for my next tour');\r\n            //$('meta[property=\"og:title\"]').attr('content', addthis_share.title);\r\n            //$('meta[property=\"og:url\"]').attr('content', addthis_share.url);\r\n            //$('meta[property=\"og:description\"]').attr('content', editor.getHTML());\r\n\r\n        });\r\n\r\n        //});\r\n\r\n    };\r\n\r\n\r\n\r\n    /**\r\n    * Build a valid HTML file with the editor content\r\n    * @public\r\n    * @return {String} HTML file content\r\n    */\r\n    var buildExport = function () {\r\n\r\n        var htmlDoc = '';\r\n        var dfd = new $.Deferred();\r\n\r\n        var roadbookEditor = roadbookModule.getEditor();\r\n        var styleEditor = styleModule.getEditor();\r\n\r\n        var title = window.location.hostname;\r\n        var $input = $('#roadbook_title');\r\n        if ($input && $input.val()) {\r\n            title = $input.val();\r\n        }\r\n\r\n        var description = '';\r\n        $input = $('#roadbook_description');\r\n        if ($input && $input.val()) {\r\n            description = $input.val();\r\n        }\r\n\r\n        var lang = '';\r\n        $input = $('#roadbook_language');\r\n        if ($input && $input.val()) {\r\n            lang = $input.val();\r\n        }\r\n\r\n        if (roadbookEditor && styleEditor && mapIconsStyle) {\r\n            htmlDoc = '<!DOCTYPE html>\\n'\r\n            + '<html lang=\"' + lang + '\">\\n'\r\n            + '<head>\\n'\r\n            + '<title>' + title + '</title>\\n'\r\n            + '<meta content=\"text/html; charset=UTF-8\" http-equiv=\"content-type\">\\n'\r\n            + '<meta name=\"description\" content=\"' + description + '\">\\n'\r\n            + '<style type=\"text/css\">\\n'\r\n            + styleEditor.getText() + '\\n'\r\n            + mapIconsStyle + '\\n'\r\n            + '</style>\\n'\r\n            + '</head>\\n'\r\n            + '<body>\\n'\r\n            + '<div class=\"roadbook\">\\n'\r\n            + roadbookEditor.getHTML() + '\\n'\r\n            + '</div>\\n'\r\n            + '</body>\\n'\r\n            + '</html>';\r\n\r\n            dfd.resolve(htmlDoc);\r\n        }\r\n\r\n        return dfd;\r\n\r\n    };\r\n\r\n\r\n\r\n    /**\r\n    * Rebuild the save link URL\r\n    * @public\r\n    * @return {String} HTML file content\r\n    */\r\n    var updateSaveLink = function () {\r\n\r\n        buildExport().done(function (htmlDoc) {\r\n            if (htmlDoc) {\r\n                $('.save_roadbook').attr('href', 'data:text/html;base64, ' + Base64.encode(htmlDoc));\r\n            }\r\n        });\r\n\r\n        var $input = $('#roadbook_title');\r\n        if ($input) {\r\n            var filename = $.trim($input.val() || document.domain).replace(/\\s+/gi, '_').replace(/[^a-zA-Z0-9\\_-]/gi, '') + '.html';\r\n            $('.save_roadbook').attr('download', filename);\r\n        }\r\n\r\n    };\r\n\r\n\r\n\r\n    /**\r\n    * Initialize an OL3 map\r\n    * @private\r\n    * @param {target} target - Map div selector\r\n    * @return {object} - The map object\r\n    */\r\n    var initMap = function (target) {\r\n\r\n        var layers;\r\n\r\n        if (!godfatherMode) {\r\n            layers = [\r\n                new ol.layer.Group({\r\n                    name: 'baseLayers',\r\n                    title: 'Base map',\r\n                    layers: [\r\n                        customBaseLayerLayer,\r\n                        //mapquestSatLayer,\r\n                        openCycleMapLayer,\r\n                        //mapquestOSMLayer,\r\n                        openStreetMapLayer\r\n                    ]\r\n                }),\r\n                new ol.layer.Group({\r\n                    name: 'overlays',\r\n                    title: 'Overlays',\r\n                    layers: [\r\n                        customOverlayLayer,\r\n                        //mapquestHybLayer,\r\n                        lonviaHikingLayer,\r\n                        lonviaCyclingLayer,\r\n                        gpxFileLayer\r\n                    ]\r\n                })\r\n            ];\r\n        } else {\r\n            layers = [\r\n                new ol.layer.Group({\r\n                    name: 'baseLayers',\r\n                    title: 'Base map',\r\n                    layers: [\r\n                        customBaseLayerLayer,\r\n                        googleSatelliteLayer,\r\n                        //mapquestSatLayer,\r\n                        googleTerrainLayer,\r\n                        mapsForFreeReliefLayer,\r\n                        openCycleMapLayer,\r\n                        googleMapLayer,\r\n                        //mapquestOSMLayer,\r\n                        openStreetMapLayer\r\n                    ]\r\n                }),\r\n                new ol.layer.Group({\r\n                    name: 'overlays',\r\n                    title: 'Overlays',\r\n                    layers: [\r\n                        customOverlayLayer,\r\n                        uniHeidelbergAsterhLayer,\r\n                        //mapquestHybLayer,\r\n                        lonviaHikingLayer,\r\n                        lonviaCyclingLayer,\r\n                        googleBikeLayer,\r\n                        googleHybridLayer,\r\n                        gpxFileLayer\r\n                    ]\r\n                })\r\n            ];\r\n        }\r\n        var controls = ol.control.defaults({\r\n            attribution: false,\r\n            attributionOptions: /** @type {olx.control.AttributionOptions} */ ({\r\n                collapsible: false\r\n            }),\r\n            zoomOptions: {\r\n\r\n            }\r\n        }).extend([\r\n            attributionControl,\r\n            scaleLineControl,\r\n            fullScreenControl,\r\n            zoomSliderControl,\r\n            layerSwitcherControl\r\n        ]);\r\n\r\n        return new ol.Map({\r\n            layers: layers,\r\n            target: target,\r\n            view: new ol.View({\r\n                center: [0, 0],\r\n                zoom: 4,\r\n                minZoom: 2,\r\n                maxZoom: 19\r\n            }),\r\n            controls: controls,\r\n            logo: false\r\n        });\r\n\r\n    };\r\n\r\n\r\n\r\n\r\n    /**\r\n    * Document ready\r\n    */\r\n    $(function () {\r\n\r\n        // Initialize mandatory modules\r\n        console.time('Bootstrap module initialized');\r\n        bootstrapHelpers.init({\r\n            debug: debug\r\n        });\r\n\r\n        roadbookModule.init();\r\n        htmlEditorModule.init();\r\n        styleModule.init();\r\n        roadbookImportModule.init();\r\n\r\n        initAddthisWidget();\r\n\r\n        var $input;\r\n\r\n        var $tabs = $('a[data-toggle=\"tab\"]');\r\n\r\n        // Initialize the home pane functionalities only when visible for the first time\r\n        //$tabs.filter('[href=\"#home_pane\"]').one('shown.bs.tab', function () {\r\n        //    commonsModule.parallax();\r\n        //});\r\n\r\n        // Initialize the editor pane functionalities only when visible for the first time\r\n        $tabs.filter('[href=\"#editor_pane\"]').one('shown.bs.tab', function () {\r\n\r\n            // Several links may open the pane, so this prevent initializing several maps\r\n            if (mapMod1) {\r\n                return false;\r\n            }\r\n\r\n            mapMod1 = new MapModule(initMap('map'), {\r\n                debug: debug\r\n            });\r\n            console.log('Map initialized');\r\n\r\n            /*\r\n            // Try to restore map center and zoom from the local storage\r\n            if (!mapMod1.restoreMapProperties()) {\r\n            // Or center map on user position and set a default zoom\r\n            mapMod1.setCenterOnPosition();\r\n            mapMod1.map.getView().setZoom(12);\r\n        }\r\n        // Check map events and store changes to local storage\r\n        mapMod1.storeMapChanges();\r\n        */\r\n\r\n        // Redraw the map and update classes when the map width input value change\r\n        $('#map_width').on('change', function () {\r\n            $tabs.filter('[href=\"#editor_pane\"]').one('shown.bs.tab', function () {\r\n                mapMod1.updateSize();\r\n            });\r\n        });\r\n\r\n        // Initialize the picker module\r\n        pickerModule.watchMapClick(mapMod1.map);\r\n\r\n        // On layer change, adjust zoom delta depending on selected base layer\r\n        // zoomDelta = -2;\r\n\r\n        // Select the layer passed to the modal\r\n        $('#layer_settings_modal').on('show.bs.modal', function (e) {\r\n            var $modal = $(this);\r\n\r\n            // Select the layer passed as link attribute\r\n            var layerVarName = $(e.relatedTarget).data('layer') + 'Layer';\r\n            if (typeof layerVarName !== 'undefined') {\r\n                /*eslint-disable no-eval*/\r\n                selectedLayer = eval(layerVarName);\r\n                /*eslint-enable no-eval*/\r\n            }\r\n\r\n            if (selectedLayer) {\r\n\r\n                // Populate fields with the selected layer properties\r\n                // hide unwanted field groups\r\n                // validate form and update layer values\r\n                mapLayersModule.initSettingsForm(selectedLayer, '#layer_settings_form', '.form-group');\r\n                //mapLayersModule.initSettingsForm(selectedLayer, '#layer_settings_form', '.form-group, fieldset');\r\n\r\n                // Change modal title\r\n                var title = selectedLayer.get('title');\r\n                $modal.find('.modal-title').html(title);\r\n\r\n                // Initialize tooltip for range inputs\r\n                bootstrapHelpers.rangeValueTooltip();\r\n            }\r\n\r\n        });\r\n\r\n        // Update map overlay when user click ok\r\n        $('#layer_settings_form').on('submit', function (e) {\r\n            e.preventDefault();\r\n            var $modal = $('#layer_settings_modal');\r\n            $modal.modal('hide');\r\n        });\r\n\r\n        commonsModule.hideHashOnClick('#map .layer-switcher');\r\n\r\n        // Add a link to settings beside each layer labels (layerswitcher)\r\n        /*$('.layer-switcher').find('input').filter('[data-layer]').each(function () {\r\n        $input = $(this);\r\n        var layerName = $input.data('layer');\r\n        $input.next('label').append(' <a href=\"#layer_settings_modal\" data-toggle=\"modal\" data-layer=\"' + layerName + '\">'\r\n        + '<span class=\"glyphicon glyphicon-cog\"></span></a>');\r\n    });*/\r\n\r\n    // Force the Bootstrap modal API to initialize the layerswitcher links\r\n    $('.layer-switcher').on('click', 'a[data-toggle=\"modal\"]', function (e) {\r\n        e.preventDefault();\r\n        //window.location.hash = '';\r\n        $(this).trigger('click.bs.modal.data-api');\r\n    });\r\n\r\n});\r\n\r\n// Initialize the settings pane functionalities only when visible for the first time\r\n$tabs.filter('[href=\"#settings_pane\"]').one('shown.bs.tab', function () {\r\n\r\n});\r\n\r\n// Initialize the style pane functionalities only when visible for the first time\r\n$tabs.filter('[href=\"#style_pane\"]').one('shown.bs.tab', function () {\r\n\r\n});\r\n\r\n// Hide the modal when the form is submited\r\n/*var $modal;\r\n$('.modal').each(function () {\r\n$modal = $(this);\r\n$modal.find('form').on('submit', function (e) {\r\ne.preventDefault();\r\n$modal.modal('hide');\r\n});\r\n});*/\r\n\r\n// Load icon styles if not already\r\n$.get('styles/osm.css', function(data) {\r\n    mapIconsStyle = data;\r\n    updateSaveLink();\r\n});\r\n\r\n// Build a file list preview when input change\r\n$input = $('#gpx_file');\r\n$input.on('change', function (e) {\r\n    var files = e.target.files;\r\n    var output = bootstrapHelpers.buildFileList(files);\r\n    $('#' + $input.attr('id') + '_output').html(output);\r\n});\r\n\r\n// Clone the file settings to the modal body\r\n//$('#file_settings_modal .modal-body').html($('#file_settings').clone(true, true));\r\n/*$('#file_settings_modal')\r\n.on('show.bs.modal', function () {\r\nvar $modal = $(this);\r\n$modal.find('.modal-body').html($('#file_settings').clone(true, true));\r\n})\r\n.on('hide.bs.modal', function () {\r\nvar $modal = $(this);\r\n$('#file_settings').html($modal.find('.modal-body').clone());\r\n});*/\r\n\r\n});\r\n\r\n\r\n\r\nreturn {\r\n    mapMod1: mapMod1,\r\n    buildExport: buildExport,\r\n    updateSaveLink: updateSaveLink\r\n};\r\n\r\n})();\r\n"]}