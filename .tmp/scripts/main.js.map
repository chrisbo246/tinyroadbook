{"version":3,"sources":["main.js"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["/*eslint-env browser, jquery */\n/*global Base64, bootstrapModule, ol, commonsModule, htmlEditorModule, importModule, mapControlsModule, mapLayersModule, MapModule, pickerModule, roadbookModule, styleModule, swal */\n/**\n * @fileOverview TinyRoadbook application\n * @author Christophe Boisier\n * @version: 0.1.9\n */\n\n/**\n * Main module.\n * @module\n * @external $\n * @external Base64\n * @external bootstrapModule\n * @external commonsModule\n * @external htmlEditorModule\n * @external importModule\n * @external mapControlsModule\n * @external mapLayersModule\n * @external MapModule\n * @external ol\n * @external pickerModule\n * @external roadbookModule\n * @external styleModule\n * @external swal\n * @return {Object} Public functions / variables\n */\n/*eslint-disable no-unused-vars*/\nvar appModule = (function () {\n    /*eslint-enable no-unused-vars*/\n    'use strict';\n\n    var mapMod1;\n    var mapIconsStyle;\n\n    // Start debugging\n    commonsModule.debug();\n    commonsModule.loadWebFonts();\n\n    swal.setDefaults({\n        buttonsStyling: false,\n        confirmButtonClass: 'btn btn-primary',\n        cancelButtonClass: 'btn btn-default'\n    });\n\n    // Define map base layers\n    var openCycleMapLayer = mapLayersModule.create('openCycleMap');\n    var openStreetMapLayer = mapLayersModule.create('openStreetMap', {visible: true});\n    var mapsForFreeReliefLayer = mapLayersModule.create('mapsForFreeRelief');\n    var customBaseLayerLayer = mapLayersModule.create('customBaseLayer', {title: 'Custom tile server <a href=\"#layer_settings_modal\" data-toggle=\"modal\" data-target-section=\"1\"><span class=\"glyphicon glyphicon-cog\"></span></a>'});\n    var googleMapLayer = mapLayersModule.create('googleMap');\n    var googleTerrainLayer = mapLayersModule.create('googleTerrain');\n    var googleSatelliteLayer = mapLayersModule.create('googleSatellite');\n\n    // Define map overlays\n    var lonviaHikingLayer = mapLayersModule.create('lonviaHiking');\n    var lonviaCyclingLayer = mapLayersModule.create('lonviaCycling');\n    var gpxLayer = mapLayersModule.create('gpxFile', {title: 'GPS tracks <a href=\"#gpx_reader_modal\" data-toggle=\"modal\"><span class=\"glyphicon glyphicon-cog\"></span></a>'});\n    var customOverlayLayer = mapLayersModule.create('customOverlay', {title: 'Custom tile server <a href=\"#layer_settings_modal\" data-toggle=\"modal\" data-target-section=\"2\"><span class=\"glyphicon glyphicon-cog\"></span></a>'});\n    var googleBikeLayer = mapLayersModule.create('googleBike');\n    var googleHybridLayer = mapLayersModule.create('googleHybrid');\n    var uniHeidelbergAsterhLayer = mapLayersModule.create('uniHeidelbergAsterh');\n\n    // Define map controls\n    var attributionControl = mapControlsModule.create('attribution');\n    var scaleLineControl = mapControlsModule.create('scaleLine');\n    var fullScreenControl = mapControlsModule.create('fullScreen');\n    var layerSwitcherControl = mapControlsModule.create('layerSwitcher');\n    var zoomSliderControl = mapControlsModule.create('zoomSlider');\n\n    // Check if the godfather mode must be enabled via URL parameters\n    var godfatherMode = (parseInt($.urlParam('godfather'))) ? true : false; // || (document.domain === 'localhost')\n    console.log('Godfather mode', godfatherMode);\n\n\n\n    /**\n     * Load the Addthis widget library and update parameters when the roadbook change\n     * @private\n     */\n    var initAddthisWidget = function () {\n\n        // Default config\n        /*eslint-disable camelcase*/\n        var addthis_share = {\n            url: document.URL\n            , title: 'I\\'m doing a tiny roadbook for my next tour'\n        };\n        /*eslint-enable camelcase*/\n\n        // Load the Addthis widget library\n        //$.getScript('https://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5689e8d8b9037927', function () {\n        //    console.log('Addthis widget library loaded');\n\n            // Watch roadbook editor changes\n            var editor = roadbookModule.getEditor();\n            editor.on('text-change', function () {\n\n                // Update Addthis widget data attributs\n                // http://support.addthis.com/customer/portal/topics/38604-customizing-addthis/articles\n                var description = editor.getText();\n                $.extend(addthis_share, {\n                        description: description.substring(0, 100) + ((description.length > 100) ? '...' : '')\n                        //image: (canvas ? canvas.toDataURL('image/png') : '')\n                    });\n\n                //$('.addthis_sharing_toolbox')\n                //    .attr('data-title', 'I\\'m doing a tiny road book for my next tour')\n                //    .attr('data-title', 'I\\'m doing a tiny road book for my next tour');\n                //$('meta[property=\"og:title\"]').attr('content', addthis_share.title);\n                //$('meta[property=\"og:url\"]').attr('content', addthis_share.url);\n                //$('meta[property=\"og:description\"]').attr('content', editor.getHTML());\n\n            });\n\n        //});\n\n    };\n\n\n\n    /**\n     * Build a valid HTML file with the editor content\n     * @public\n     * @return {String} HTML file content\n     */\n    var buildExport = function () {\n\n        var htmlDoc = '';\n        var dfd = new $.Deferred();\n\n        var roadbookEditor = roadbookModule.getEditor();\n        var styleEditor = styleModule.getEditor();\n\n        if (roadbookEditor && styleEditor && mapIconsStyle) {\n            htmlDoc = '<html>\\n'\n                + '<head>\\n'\n                + '<title>' + window.location.hostname + '</title>\\n'\n                + '<meta charset=\"UTF-8\">\\n'\n                + '<style>\\n'\n                + styleEditor.getText() + '\\n'\n                + mapIconsStyle + '\\n'\n                + '</style>\\n'\n                + '</head>\\n'\n                + '<body>\\n'\n                + '<div class=\"roadbook\">\\n'\n                + roadbookEditor.getHTML() + '\\n'\n                + '</div>\\n'\n                + '</body>\\n'\n                + '</html>';\n\n            dfd.resolve(htmlDoc);\n        }\n\n        return dfd;\n\n    };\n\n\n\n    /**\n     * Rebuild the save link URL\n     * @public\n     * @return {String} HTML file content\n     */\n    var updateSaveLink = function () {\n\n        buildExport().done(function (htmlDoc) {\n            if (htmlDoc) {\n                $('#save_roadbook').attr('href', 'data:text/html;base64, ' + Base64.encode(htmlDoc));\n            }\n        });\n\n    };\n\n\n\n    /**\n     * Initialize an OL3 map\n     * @private\n     * @param {target} target - Map div selector\n     * @return {object} - The map object\n     */\n    var initMap = function (target) {\n\n        var layers;\n\n        if (!godfatherMode) {\n            layers = [\n                new ol.layer.Group({\n                    name: 'baseLayers',\n                    title: 'Base map',\n                    layers: [\n                        customBaseLayerLayer,\n                        mapsForFreeReliefLayer,\n                        openCycleMapLayer,\n                        openStreetMapLayer\n                    ]\n                }),\n                new ol.layer.Group({\n                    name: 'overlays',\n                    title: 'Overlays',\n                    layers: [\n                        customOverlayLayer,\n                        lonviaHikingLayer,\n                        lonviaCyclingLayer,\n                        gpxLayer\n                    ]\n                })\n            ];\n        } else {\n            layers = [\n                new ol.layer.Group({\n                    name: 'baseLayers',\n                    title: 'Base map',\n                    layers: [\n                        customBaseLayerLayer,\n                        googleSatelliteLayer,\n                        googleTerrainLayer,\n                        mapsForFreeReliefLayer,\n                        openCycleMapLayer,\n                        googleMapLayer,\n                        openStreetMapLayer\n                    ]\n                }),\n                new ol.layer.Group({\n                    name: 'overlays',\n                    title: 'Overlays',\n                    layers: [\n                        customOverlayLayer,\n                        uniHeidelbergAsterhLayer,\n                        lonviaHikingLayer,\n                        googleBikeLayer,\n                        lonviaCyclingLayer,\n                        googleHybridLayer,\n                        gpxLayer\n                    ]\n                })\n            ];\n        }\n        var controls = ol.control.defaults({\n            attribution: false,\n            attributionOptions: /** @type {olx.control.AttributionOptions} */ ({\n                collapsible: false\n            }),\n            zoomOptions: {\n\n            }\n        }).extend([\n            attributionControl,\n            scaleLineControl,\n            fullScreenControl,\n            layerSwitcherControl,\n            zoomSliderControl\n        ]);\n\n        return new ol.Map({\n            layers: layers,\n            target: target,\n            view: new ol.View({\n                center: [0, 0],\n                zoom: 4,\n                minZoom: 2,\n                maxZoom: 19\n            }),\n            controls: controls\n        });\n\n    };\n\n\n\n    /**\n     * Document ready\n     */\n    $(function () {\n\n        // Initialize mandatory modules\n        console.time('Bootstrap module initialized');\n        bootstrapModule.debug();\n        bootstrapModule.restoreActiveTab();\n        bootstrapModule.tab();\n        bootstrapModule.modalTogglerAttributs();\n        bootstrapModule.tooltip();\n        bootstrapModule.storeButtonState();\n        console.timeEnd('Bootstrap module initialized');\n\n        commonsModule.disableUnsupported();\n        commonsModule.adsense();\n        commonsModule.hideHashOnClick();\n\n        roadbookModule.init();\n        htmlEditorModule.init();\n        styleModule.init();\n        importModule.init();\n\n        initAddthisWidget();\n\n        // Try to define user language at the first connection\n        var $input = $('#user_language');\n        if ($input) {\n            $input.val(navigator.language || navigator.userLanguage).trigger('change');\n            console.log('User language defined', $input.val());\n        }\n        // Then store / restore input values\n        commonsModule.fixInputValues();\n        commonsModule.storeForms();\n\n        var $tabs = $('a[data-toggle=\"tab\"]');\n\n        // Initialize the home pane functionalities only when visible for the first time\n        $tabs.filter('[href=\"#home_pane\"]').one('shown.bs.tab', function () {\n\n            commonsModule.parallax();\n\n        });\n\n        // Initialize the editor pane functionalities only when visible for the first time\n        $tabs.filter('[href=\"#editor_pane\"]').one('shown.bs.tab', function () {\n\n            // Several links may open the pane, so this prevent initializing several maps\n            if (mapMod1) {\n                return false;\n            }\n\n            mapMod1 = new MapModule(initMap('map'));\n            console.log('Map initialized');\n            mapMod1.debug();\n\n            // Try to restore map center and zoom from the local storage\n            if (!mapMod1.restoreMapState()) {\n                // Or center map on user position and set a default zoom\n                mapMod1.setCenterOnPosition();\n                mapMod1.map.getView().setZoom(12);\n            }\n\n            // Check map events and store changes to local storage\n            mapMod1.storeMapState();\n\n            // Initialize the picker module\n            pickerModule.watchMapClick(mapMod1.map);\n\n            // On layer change, adjust zoom delta depending on selected base layer\n            // zoomDelta = -2;\n\n            // Watch GPX file input changes\n            $('#gpx_file').on('change', function (inputEvent) {\n                var files = inputEvent.target.files;\n                bootstrapModule.inputFileList(files, '#gpx_file_list');\n            });\n\n            // Update map overlay when user click ok\n            $('#gpx_reader_form').on('submit', function (e) {\n\n                e.preventDefault();\n                $('#gpx_reader_modal').modal('hide');\n                var files = document.getElementById('gpx_file').files;\n\n                var $spinner = $('#map').find('.spinner');\n                $spinner.fadeIn();\n\n                gpxLayer.getSource().clear();\n\n                var dfd = commonsModule.reader(files, function (result) {\n                    var gpxFormat = new ol.format.GPX();\n                    var gpxFeatures = gpxFormat.readFeatures(result, {\n                        dataProjection: 'EPSG:4326',\n                        featureProjection: 'EPSG:3857'\n                    });\n                    gpxLayer.getSource().addFeatures(gpxFeatures);\n                    gpxLayer.setProperties({\n                        visible: true\n                    });\n                });\n\n                dfd.done(function () {\n                    $spinner.fadeOut();\n                });\n\n                // Refresh the layerswitcher control\n                layerSwitcherControl.renderPanel();\n\n                // Adjust the view to fit tracks\n                //mapMod1.fitVectorLayer(gpxLayer);\n\n            });\n\n            // Force the Bootstrap modal API to initialize the layerswitcher links\n            $('.layer-switcher').on('click', 'a[data-toggle=\"modal\"]', function () {\n                $(this).trigger('click.bs.modal.data-api');\n            });\n\n        });\n\n        // Initialize the settings pane functionalities only when visible for the first time\n        $tabs.filter('[href=\"#settings_pane\"]').one('shown.bs.tab', function () {\n\n            commonsModule.resetButton();\n            bootstrapModule.rangeValueTooltip();\n\n        });\n\n        // Initialize the style pane functionalities only when visible for the first time\n        $tabs.filter('[href=\"#style_pane\"]').one('shown.bs.tab', function () {\n\n        });\n\n        // Reset buttons\n        $('#reset_settings').click(function () {\n            commonsModule.resetInputValues();\n        });\n\n        $('#layer_settings_form').on('submit', function (e) {\n            e.preventDefault();\n            $('#layer_settings_modal').modal('hide');\n        });\n\n        // Hide the modal when the form is submited\n        /*var $modal;\n        $('.modal').each(function () {\n            $modal = $(this);\n            $modal.find('form').on('submit', function (e) {\n                e.preventDefault();\n                $modal.modal('hide');\n            });\n        });*/\n\n\n        // Load icon styles if not already\n        $.get('styles/poi.css', function(data) {\n            mapIconsStyle = data;\n            updateSaveLink();\n        });\n\n        // Update local tile url\n        mapLayersModule.inputLayerSource(customBaseLayerLayer, '#base_layer_tile_server');\n        mapLayersModule.inputLayerSource(customOverlayLayer, '#overlay_tile_server');\n\n    });\n\n\n\n    return {\n        buildExport: buildExport,\n        updateSaveLink: updateSaveLink\n    };\n\n})();\n"],"sourceRoot":"/source/"}