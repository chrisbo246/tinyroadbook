{"version":3,"sources":["mapLayersModule.js"],"names":["mapLayersModule","settings","debug","bingMapsKey","properties","visible","basil","olLayerTypes","olSourceTypes","olFormatTypes","olStyleTypes","olSourceGetters","olStyleTypeGetters","olStylePropertyGetters","olStylePropertySetters","protocol","window","location","layers","selectedLayer","Basil","layer","commonsModule","hideLogs","split","forEach","eventType","on","e","key","console","log","get","target","type","watchLayerChanges","namespace","getProperties","value","zIndex","opacity","set","restoreLayer","setProperties","create","name","warn","$","extend","title","treatLayers","fn","each","i","l","getLayers","validateSettingsForm","formSelector","$input","style","parsley","$form","excluded","$element","is","data","getInputValue","updateSourceUrl","loadFileFeatures","dataProjection","featureProjection","getStyle","initSettingsForm","formGroupSelector","$groups","$formGroups","find","hide","layerTypes","getInstancesOf","ol","layerKeys","getKeys","layerProperties","getSource","source","types","push","has","key2","show","html","sourceTypes","sourceKeys","sourceProperties","getFormat","format","sourceExtraProperties","getter2","formatTypes","styleTypes","styleProperties","key3","getter3","filter","setInputValue","styleType","url","setUrls","isArray","trim","setUrl","files","featuresOptions","length","clear","dfd","reader","result","features","readFeatures","addFeatures","setVisible","timezonesStyle","feature","offset","match","hours","parseInt","minutes","date","Date","local","getTime","getTimezoneOffset","delta","Math","abs","getHours","getMinutes","Style","fill","Fill","color","stroke","Stroke","openStreetMap","Tile","OSM","urls","openSeaMap","attributions","Attribution","ATTRIBUTION","crossOrigin","openStreetMapHumanitarian","mapquestOSM","MapQuest","mapquestSat","openCycleMap","thunderforestTransport","thunderforestTransportDark","thunderforestLandscape","thunderforestOutdoor","arcgis","XYZ","arcgisRestHighwayUSA","extent","TileArcGISRest","googleMap","googleTerrain","googleSatellite","bingRoad","maxZoom","BingMaps","imagerySet","bingAerial","bingAerialWithLabels","bingCollinsBart","bingOrdnanceSurvey","stamenToner","Stamen","stamenTonerLite","stamenTonerBackground","stamenWatercolor","stamenTerrain","stamenTerrainWithLabels","customBaseLayer","mapsForFreeRelief","googleBike","googleHybrid","mapquestHyb","lonviaCycling","lonviaHiking","stamenTonerHybrid","stamenTonerLabels","stamenTonerLines","mapsForFreeWater","mapsForFreeAdmin","uniHeidelbergAsterh","uniHeidelbergAdminb","uniHeidelbergHybrid","ImageData","warm","shade","inputs","elevationImage","width","height","elevationData","shadeData","Uint8ClampedArray","dp","resolution","maxX","maxY","pixel","twoPi","PI","halfPi","sunEl","sunAz","cosSunEl","cos","sinSunEl","sin","pixelX","pixelY","x0","x1","y0","y1","z0","z1","dzdx","dzdy","slope","aspect","cosIncidence","scaled","vert","atan","sqrt","atan2","mapboxShadedRelief","Image","Raster","sources","operationType","operation","timeZones","Vector","minResolution","extractStyles","projection","KML","gpxFile","GPX","drawingVector","customOverlay"],"mappings":"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","file":"mapLayersModule.js","sourcesContent":["/*eslint-env browser, jquery */\r\n/*global console, $, ol, Basil, parsley, commonsModule */\r\n/**\r\n* OL3 layers module.\r\n* @module\r\n* @external $\r\n* @external ol\r\n* @return {Object} Public functions / variables\r\n*/\r\n/*eslint-disable no-unused-vars*/\r\nvar mapLayersModule = (function () {\r\n    /*eslint-enable no-unused-vars*/\r\n    'use strict';\r\n\r\n    var settings = {\r\n        debug: false,\r\n        bingMapsKey: 'Ak-dzM4wZjSqTlzveKz5u0d4IQ4bRzVI309GxmkgSVr1ewS6iPSrOvOKhA-CJlm3',\r\n        properties: {\r\n            visible: false\r\n        },\r\n        basil: {\r\n        }\r\n    };\r\n\r\n    var olLayerTypes = ['Base', 'Group', 'Heatmap', 'Image', 'Layer', 'Tile', 'Vector', 'VectorTile'];\r\n\r\n    var olSourceTypes = ['BingMaps', 'CartoDB', 'Cluster',\r\n    'Image', 'ImageCanvas', 'ImageMapGuide', 'ImageStatic', 'ImageVector',\r\n    'ImageWMS', 'MapQuest', 'OSM', 'Raster', 'Source', 'Stamen', 'Tile',\r\n    'TileArcGISRest', 'TileDebug', 'TileImage', 'TileJSON', 'TileUTFGrid',\r\n    'TileWMS', 'Vector', 'VectorTile', 'WMTS', 'XYZ', 'Zoomify'];\r\n    // 'ImageArcGISRest', 'ImageEvent', 'RasterEvent', 'TileEvent', 'VectorEvent', 'UrlTile',\r\n\r\n    var olFormatTypes = ['GMLBase', 'JSONFeature', 'TextFeature',\r\n    'XML', 'XMLFeature', 'EsriJSON', 'Feature', 'GeoJSON', 'GML', 'GML2', 'GML3', 'GPX',\r\n    'IGC', 'KML', 'MVT', 'OSMXML', 'Polyline', 'TopoJSON', 'WFS', 'WKT',\r\n    'WMSCapabilities', 'WMSGetFeatureInfo', 'WMTSCapabilities'];\r\n\r\n    var olStyleTypes = ['AtlasManager', 'Circle', 'Fill', 'Icon', 'Image', 'RegularShape',\r\n    'Stroke', 'Style', 'Text'];\r\n\r\n    var olSourceGetters = {'revision': 'getRevision', 'state': 'getState', 'urls': 'getUrls', 'url': 'getUrl'};\r\n    //'attributions': 'getAttributions', 'logo': 'getLogo', 'projection': 'getProjection',\r\n    //'tileGrid': 'getTileGrid', 'tileLoadFunction': 'getTileLoadFunction', 'tileUrlFunction': 'getTileUrlFunction'\r\n    //var olSourceSetters = {'revision': 'setRevision', 'state': 'setState', 'urls': 'setUrls', 'url': 'setUrl'};\r\n    var olStyleTypeGetters = {'Fill': 'getFill', 'Image': 'getImage', 'Stroke': 'getStroke', 'Text': 'getText'};\r\n    var olStylePropertyGetters = {'color': 'getColor', 'lineCap': 'getLineCap', 'geometry': 'getGeometry', 'geometryFunction': 'getGeometryFunction', 'lineDash': 'getLineDash',\r\n    'lineJoin': 'getLineJoin', 'miterLimit': 'getMiterLimit', 'width': 'getWidth', 'zIndex': 'getZIndex'};\r\n    var olStylePropertySetters = {'color': 'setColor', 'lineCap': 'setLineCap', 'geometry': 'setGeometry', 'geometryFunction': 'setGeometryFunction', 'lineDash': 'setLineDash',\r\n    'lineJoin': 'setLineJoin', 'miterLimit': 'setMiterLimit', 'width': 'setWidth', 'zIndex': 'getZIndex'};\r\n\r\n\r\n    var protocol = (window.location.protocol === 'https:') ? 'https:' : 'http:';\r\n\r\n    var layers = {};\r\n    var selectedLayer;\r\n    var basil;\r\n\r\n    if (typeof Basil === 'function') {\r\n        basil = new window.Basil(settings.basil);\r\n    }\r\n\r\n\r\n\r\n    /**\r\n    * Display some logs about layer events\r\n    * @private\r\n    * @param {Object} layer - ol.layer\r\n    */\r\n    var debug = function (layer) {\r\n\r\n        if (!settings.debug) {\r\n            commonsModule.hideLogs();\r\n            return false;\r\n        }\r\n\r\n        // postcompose precompose render propertychange\r\n        'change change:blur change:extent change:gradient change:layers change:maxResolution change:minResolution change:opacity change:preload change:radius change:source change:useInterimTilesOnError change:visible change:zIndex'.split(' ').forEach(function (eventType) {\r\n            layer.on(eventType, function (e) {\r\n                if (e.key) {\r\n                    console.log('Layer ' + e.key + ' changed', layer.get(e.key));\r\n                } else {\r\n                    console.log(e.target.get('name') + ' layer' + e.type, e);\r\n                }\r\n\r\n            });\r\n        });\r\n\r\n    };\r\n\r\n\r\n\r\n    /**\r\n    * Restore some properties from the local storage and save changes\r\n    * @private\r\n    * @param {Object} layer - ol.layer\r\n    */\r\n    var watchLayerChanges = function (layer) {\r\n\r\n        // Store layer properties changes\r\n        layer.on('propertychange', function () {\r\n\r\n            var namespace = layer.get('name');\r\n            if (namespace) {\r\n\r\n                var properties = layer.getProperties();\r\n                var key = 'properties';\r\n                var value = {\r\n                    visible: properties.visible,\r\n                    zIndex: properties.zIndex,\r\n                    opacity: properties.opacity\r\n                };\r\n                basil.set(key, value, {'namespace': namespace});\r\n                console.log(namespace + ' properties stored', value);\r\n\r\n            }\r\n\r\n        });\r\n\r\n    };\r\n\r\n\r\n\r\n    /**\r\n    * Restore all layers properties from the local storage\r\n    * @private\r\n    * @param {Object} layer - ol.layer\r\n    */\r\n    var restoreLayer = function (layer) {\r\n\r\n        var namespace = layer.get('name');\r\n        if (namespace) {\r\n\r\n            var key = 'properties';\r\n            var value = basil.get(key, {'namespace': namespace});\r\n            if (value !== null) {\r\n                layer.setProperties(value);\r\n                console.log(namespace + ' ' + key + ' restored', value);\r\n            }\r\n\r\n        }\r\n\r\n    };\r\n\r\n\r\n\r\n    /**\r\n    * Create a new layer using predefined settings\r\n    * @public\r\n    * @param {string} name - Predefined layer (variable name)\r\n    * @param {Object} [properties] - Layer custom parameters\r\n    * @return {Object} OL3 layer\r\n    */\r\n    var create = function (name, properties) {\r\n\r\n        if (!layers[name]) {\r\n            console.warn(name + ' layer definition is not defined');\r\n            return false;\r\n        }\r\n\r\n        // Define the new layer with a predefined layer\r\n        var layer = layers[name]();\r\n\r\n        debug(layer);\r\n\r\n        // Apply default and custom settings\r\n        layer.setProperties($.extend(true, {}, settings.properties, properties));\r\n\r\n        // Append a link to the settings after each title\r\n        var title = layer.get('title');\r\n        if (title) {\r\n            layer.set('title', title\r\n            + ' <a href=\"#layer_settings_modal\" data-toggle=\"modal\" data-layer=\"' + name + '\">'\r\n            + '<span class=\"glyphicon glyphicon-cog\"></span></a>');\r\n        }\r\n\r\n        if (basil) {\r\n            restoreLayer(layer);\r\n            watchLayerChanges(layer);\r\n        }\r\n\r\n        return layer;\r\n    };\r\n\r\n\r\n\r\n    /**\r\n    * Apply a function on (nested) layers\r\n    * @public\r\n    * @param {Object} layer - Map object or layer group\r\n    * @param {function} fn - Function with layer as parameter, to apply to each layer\r\n    */\r\n    var treatLayers = function (layer, fn) {\r\n\r\n        $.each(layers, function (i, l) {\r\n            if (l.getLayers()) {\r\n                treatLayers(l, fn);\r\n            } else {\r\n                fn(l);\r\n            }\r\n        });\r\n\r\n    };\r\n\r\n\r\n\r\n    /**\r\n    * Live update layer values once a field was validated by Parsley\r\n    * @public\r\n    * @param {Object} layer - Map object or layer group\r\n    */\r\n    var validateSettingsForm = function (formSelector) {\r\n\r\n        var $input, key, value, style, type;\r\n\r\n        if (!$().parsley) {\r\n            console.warn('Parsley is not defined');\r\n            return false;\r\n        }\r\n\r\n        var $form = $(formSelector);\r\n        $form.parsley({\r\n            excluded: 'input[type=button], input[type=submit], input[type=reset], input[type=hidden], [disabled], :hidden'\r\n        })\r\n        .on('field:success', function() {\r\n            $input = this.$element;\r\n\r\n            // Update layer properties\r\n            if ($input.is('[data-ol-layer][data-ol-property]')) {\r\n                key = $input.data('ol-property');\r\n                value = commonsModule.getInputValue($input);\r\n                if (key && value !== null) {\r\n                    selectedLayer.set(key, value);\r\n                }\r\n            }\r\n\r\n            // Update source urls\r\n            if ($input.is('[data-ol-source][data-ol-property=\"urls\"]')) {\r\n                value = commonsModule.getInputValue($input);\r\n                value = value.split('\\n');\r\n                updateSourceUrl(selectedLayer, value);\r\n            }\r\n\r\n            // Update source features\r\n            if ($input.is('[data-ol-source=\"Vector\"][data-ol-format=\"GPX\"]')) {\r\n                value = commonsModule.getInputValue($input);\r\n                loadFileFeatures(selectedLayer, value, {\r\n                    dataProjection: 'EPSG:4326',\r\n                    featureProjection: 'EPSG:3857'\r\n                });\r\n                //mapModule.fitVectorLayer(selectedLayer);\r\n            }\r\n\r\n            // Update layer style\r\n            if ($input.is('[data-ol-style][data-ol-property]')) {\r\n                key = $input.data('ol-property');\r\n                value = commonsModule.getInputValue($input);\r\n                type = $input.data('ol-style');\r\n                style = selectedLayer.getStyle();\r\n                if (olStyleTypeGetters[type] && typeof style[olStyleTypeGetters[type]]) {\r\n                    style = style[olStyleTypeGetters[type]]();\r\n                    if (olStylePropertySetters[key] && typeof style[olStylePropertySetters[key]]) {\r\n                        style[olStylePropertySetters[key]](value);\r\n                    }\r\n                }\r\n            }\r\n\r\n        })\r\n        .on('form:submit', function () {\r\n            // Prevent form submission\r\n            return false;\r\n        });\r\n\r\n    };\r\n\r\n\r\n\r\n    /**\r\n    * Edit layer\r\n    * @public\r\n    * @param {Object} layer - Map object or layer group\r\n    */\r\n    var initSettingsForm = function (layer, formSelector, formGroupSelector) {\r\n\r\n        var $input, $groups, key, value;\r\n\r\n        var $form = $(formSelector);\r\n        var $formGroups = $form.find(formGroupSelector);\r\n\r\n        // Memorize the selected layer\r\n        selectedLayer = layer;\r\n\r\n        // Hide every form groups\r\n        $formGroups.hide();\r\n\r\n        // Get layer types\r\n        var layerTypes = commonsModule.getInstancesOf(layer, ol.layer, olLayerTypes);\r\n        console.log('Layer types', layerTypes);\r\n\r\n        // Get layer properties\r\n        var layerKeys = layer.getKeys();\r\n        console.log('Layer keys', layerKeys);\r\n        var layerProperties = layer.getProperties(layer);\r\n        console.log('Layer properties', layerProperties);\r\n        if (typeof layer.getSource === 'function') {\r\n            var source = layer.getSource();\r\n        }\r\n        if (typeof layer.getStyle === 'function') {\r\n            var style = layer.getStyle();\r\n        }\r\n\r\n        // Unhide filtered form groups\r\n        //$groups = $formGroups.has('[data-ol-layer]');\r\n        var types = layerTypes;\r\n        types.push('*');\r\n        types.forEach(function (type) {\r\n            $groups = $formGroups.has('[data-ol-layer=\"' + type + '\"]');\r\n            layerKeys.forEach(function (key2) {\r\n                $groups.has('[data-ol-property=\"' + key2 + '\"]').show()\r\n                .find('label small').html('(' + type + ')');\r\n            });\r\n        });\r\n\r\n        if (source) {\r\n\r\n            // Get source types\r\n            var sourceTypes = commonsModule.getInstancesOf(source, ol.source, olSourceTypes);\r\n            console.log('Layer source types', sourceTypes);\r\n\r\n            // Get source properties\r\n            var sourceKeys = source.getKeys();\r\n            console.log('Layer source keys', sourceKeys);\r\n            var sourceProperties = source.getProperties(layer);\r\n            console.log('Layer source properties', sourceProperties);\r\n            //if (typeof source.getUrls === 'function') {\r\n            //    var sourceUrls = source.getUrls(layer);\r\n            //    console.log('Source URLs', sourceUrls);\r\n            //}\r\n            if (typeof source.getFormat === 'function') {\r\n                var format = source.getFormat();\r\n            }\r\n\r\n            var sourceExtraProperties = {};\r\n            $.each(olSourceGetters, function (key2, getter2) {\r\n                if (typeof source[getter2] === 'function') {\r\n                    value = source[getter2]();\r\n                    if (value && !sourceProperties[key2]) {\r\n                        sourceExtraProperties[key2] = value;\r\n                    }\r\n                }\r\n            });\r\n            console.log('Source extra properties', sourceExtraProperties);\r\n\r\n            // Unhide filtered form groups\r\n            //$groups = $formGroups.has('[data-ol-source]');\r\n            types = sourceTypes;\r\n            types.push('*');\r\n            types.forEach(function (type) {\r\n                $groups = $formGroups.has('[data-ol-source=\"' + type + '\"]');\r\n                sourceKeys.forEach(function (key2) {\r\n                    $groups.has('[data-ol-property=\"' + key2 + '\"]').show()\r\n                    .find('label small').html('(' + type + ')');\r\n                });\r\n                $.each(sourceExtraProperties, function (key2) {\r\n                    $groups.has('[data-ol-property=\"' + key2 + '\"]').show()\r\n                    .find('label small').html('(' + type + ')');\r\n                });\r\n                //if (sourceUrls) {\r\n                //    $groups.has('[data-ol-property=\"urls\"]').show();\r\n                //}\r\n            });\r\n\r\n            if (format) {\r\n\r\n                // Get format types\r\n                var formatTypes = commonsModule.getInstancesOf(format, ol.format, olFormatTypes);\r\n                console.log('Layer format types', formatTypes);\r\n\r\n                // Unhide filtered form groups\r\n                //$groups = $formGroups.has('[data-ol-format]');\r\n                types = formatTypes;\r\n                types.push('*');\r\n                types.forEach(function (type) {\r\n                    $groups = $formGroups.has('[data-ol-format=\"' + type + '\"]');\r\n                    $groups.show()\r\n                    .find('label small').html('(' + type + ')');\r\n                });\r\n                $groups.has('[data-ol-format=\"\"]').show();\r\n\r\n            }\r\n\r\n            /*\r\n            if (typeof source.getFeatures === 'function'') {\r\n            var features = source.getFeatures();\r\n        }\r\n\r\n        if (features) {\r\n        $.each(features, function (i, feature) {\r\n\r\n        var id = feature.getId();\r\n        console.log('Feature id', id);\r\n        var keys = feature.getKeys();\r\n        console.log('Feature keys', keys);\r\n\r\n        if (typeof feature.getFormat === 'function') {\r\n        format = feature.getFormat();\r\n    }\r\n\r\n    if (format) {\r\n    var types = commonsModule.getInstancesOf(format, ol.format, olFormatTypes);\r\n    console.log('Feature format types', types);\r\n}\r\n\r\n});\r\n}\r\n*/\r\n\r\n}\r\n\r\nif (style) {\r\n\r\n    var styleTypes = commonsModule.getInstancesOf(style, ol.style, olStyleTypes);\r\n    console.log('Layer style types', styleTypes);\r\n\r\n    var styleProperties = {};\r\n\r\n    $.each(olStyleTypeGetters, function (key2, getter2) {\r\n        if (typeof style[getter2] === 'function') {\r\n\r\n            styleProperties[key2] = {};\r\n            value = style[getter2]();\r\n\r\n            if (value) {\r\n                styleTypes = commonsModule.getInstancesOf(value, ol.style, olStyleTypes);\r\n\r\n                // If property is a child style\r\n                if (styleTypes) {\r\n                    console.log('Child style ' + key2 + ' found', styleTypes);\r\n\r\n                    // Unhide filtered form groups\r\n                    //$groups = $formGroups.has('[data-ol-style]');\r\n                    types = styleTypes;\r\n                    types.push('*');\r\n                    types.forEach(function (type) {\r\n                        $groups = $formGroups.has('[data-ol-style=\"' + type + '\"]');\r\n\r\n                        $.each(olStylePropertyGetters, function (key3, getter3) {\r\n                            if (typeof value[getter3] === 'function') {\r\n                                value = value[getter3]();\r\n                                //console.log(key2 + ' ' + key3 + '(' + (typeof value) + ')', value);\r\n                                styleProperties[key2][key3] = value;\r\n                                $groups.has('[data-ol-property=\"' + key3 + '\"]').show()\r\n                                .find('label small').html('(' + type + ')');\r\n                            }\r\n                        });\r\n\r\n                    });\r\n\r\n\r\n                } else {\r\n                    styleProperties[key2] = value;\r\n                }\r\n            }\r\n\r\n        }\r\n    });\r\n    console.log('Layer style properties', styleProperties);\r\n\r\n}\r\n\r\n// Populate fields with layer properties\r\nif (layerProperties) {\r\n    $formGroups.find(':input').filter('[data-ol-layer][data-ol-property]').each(function () {\r\n        $input = $(this);\r\n        key = $input.data('ol-property');\r\n        if (layerProperties[key] !== null) {\r\n            value = layerProperties[key];\r\n            commonsModule.setInputValue($input, value);\r\n            console.log('Layer property ' + key + ' populated', value);\r\n        }\r\n    });\r\n}\r\n\r\nif (sourceProperties) {\r\n    $formGroups.find(':input').filter('[data-ol-source][data-ol-property]').each(function () {\r\n        $input = $(this);\r\n        key = $input.data('ol-property');\r\n        if (sourceProperties[key] !== null) {\r\n            value = sourceProperties[key];\r\n            commonsModule.setInputValue($input, value);\r\n            console.log('Source property ' + key + ' populated', value);\r\n        }\r\n    });\r\n}\r\nif (sourceExtraProperties) {\r\n    $formGroups.find(':input').filter('[data-ol-source][data-ol-property]').each(function () {\r\n        $input = $(this);\r\n        key = $input.data('ol-property');\r\n        if (sourceExtraProperties[key] !== null) {\r\n            value = sourceExtraProperties[key];\r\n            commonsModule.setInputValue($input, value);\r\n            console.log('Source property ' + key + ' populated', value);\r\n        }\r\n    });\r\n}\r\n/*if (sourceUrls) {\r\n$formGroups.find(':input').filter('[data-ol-source][data-ol-property=\"urls\"]').each(function () {\r\n$input = $(this);\r\nvalue = sourceUrls;\r\ncommonsModule.setInputValue($input, value);\r\nconsole.log('Layer input \"URL\" populated', value);\r\n});\r\n}*/\r\n\r\nif (formatTypes) {\r\n    $formGroups.find(':input').filter('[data-ol-source=\"Vector\"][data-ol-format=\"GPX\"]').each(function () {\r\n        console.log('Layer input \"file\" ready', value);\r\n    });\r\n}\r\n\r\nif (styleProperties) {\r\n    var styleType;\r\n    $formGroups.find(':input').filter('[data-ol-style][data-ol-property]').each(function () {\r\n        $input = $(this);\r\n        styleType = $input.data('ol-style');\r\n        key = $input.data('ol-property');\r\n        if (styleType && key && styleProperties[styleType] && styleProperties[styleType][key] !== null) {\r\n            value = styleProperties[styleType][key];\r\n            console.log(styleType + ' ' + key + ' (' + (typeof value) + ')', value);\r\n            commonsModule.setInputValue($input, value);\r\n        }\r\n    });\r\n}\r\n\r\n// Initialize Parsley excluding hidden fields\r\n// and update layer properties when the form is submitted\r\nvalidateSettingsForm(formSelector);\r\n\r\n};\r\n\r\n\r\n\r\n/**\r\n* Update layer source url\r\n* @public\r\n* @param {Object} layer - OL3 layer\r\n* @param {String|array} url - URL\r\n*/\r\nvar updateSourceUrl = function (layer, url) {\r\n\r\n    if (!layer) {\r\n        return false;\r\n    }\r\n\r\n    var source = layer.getSource();\r\n\r\n    if (typeof source.setUrls !== 'undefined') {\r\n        if ($.isArray(url)) {\r\n            source.setUrls(url);\r\n        } else {\r\n            url = $.trim(url);\r\n            source.setUrl(url);\r\n        }\r\n    }\r\n\r\n    // Show layer if the URL is defined, else hide layer\r\n    //layer.setVisible((url));\r\n\r\n};\r\n\r\n\r\n\r\n/**\r\n* Update the GPX layer with the input file values\r\n* @private\r\n* @param {Object} layer - OL layer\r\n* @param {Object} files - Input file [files]\r\n* @param {Object} featuresOptions - Features options\r\n*/\r\nvar loadFileFeatures = function (layer, files, featuresOptions) {\r\n\r\n    if (files.length === 0) {\r\n        return false;\r\n    }\r\n\r\n    var source = layer.getSource();\r\n\r\n    // Remove all features\r\n    source.clear();\r\n\r\n    var dfd = commonsModule.reader(files, function (result) {\r\n\r\n        // Import features from files\r\n        var format = source.getFormat();\r\n        var features = format.readFeatures(result, featuresOptions);\r\n        source.addFeatures(features);\r\n\r\n        // Display layer\r\n        layer.setVisible(true);\r\n\r\n    });\r\n\r\n    // Refresh the layerswitcher control\r\n    //layerSwitcherControl.renderPanel();\r\n\r\n    // Adjust the view to fit tracks\r\n    //mapMod1.fitVectorLayer(gpxLayer);\r\n\r\n    return dfd;\r\n\r\n};\r\n\r\n\r\n\r\n// Styles ______________________________________________________________________________________\r\n/**\r\n* Timezones layer style\r\n* @see http://openlayers.org/en/v3.4.0/examples/kml-timezones.html\r\n* @private\r\n*/\r\nvar timezonesStyle = function (feature) { // feature, resolution\r\n    var offset = 0;\r\n    var name = feature.get('name'); // e.g. GMT -08:30\r\n    var match = name.match(/([\\-+]\\d{2}):(\\d{2})$/);\r\n    if (match) {\r\n        var hours = parseInt(match[1], 10);\r\n        var minutes = parseInt(match[2], 10);\r\n        offset = 60 * hours + minutes;\r\n    }\r\n    var date = new Date();\r\n    var local = new Date(date.getTime() +\r\n    (date.getTimezoneOffset() + offset) * 60000);\r\n    // offset from local noon (in hours)\r\n    var delta = Math.abs(12 - local.getHours() + (local.getMinutes() / 60));\r\n    if (delta > 12) {\r\n        delta = 24 - delta;\r\n    }\r\n    var opacity = 0.75 * (1 - delta / 12);\r\n    return [new ol.style.Style({\r\n        fill: new ol.style.Fill({\r\n            color: [0x55, 0x55, 0x55, opacity]\r\n            //color: [0xff, 0xff, 0x33, opacity]\r\n        }),\r\n        stroke: new ol.style.Stroke({\r\n            color: '#ffffff'\r\n        })\r\n    })];\r\n};\r\n\r\n// Base layers _________________________________________________________________________________\r\nlayers.openStreetMap = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'openStreetMap',\r\n        title: 'Road Map<small> (by <a href=\"https://www.openstreetmap.org\">OpenStreetMap</a>)</small>', // (offline)\r\n        visible: true,\r\n        type: 'base',\r\n        source: new ol.source.OSM({\r\n            // crossOrigin: null,\r\n            urls: [\r\n                protocol + '//a.tile.openstreetmap.org/{z}/{x}/{y}.png'\r\n                //'../../Datas/Tiles/osm_mapnik/{z}/{x}/{y}.png'\r\n            ]\r\n        })\r\n    });\r\n};\r\nlayers.openSeaMap = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'openSeaMap',\r\n        title: 'Shipping lanes<small> (by <a href=\"http://www.openseamap.org\">OpenSeaMap</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.OSM({\r\n            attributions: [\r\n                new ol.Attribution({\r\n                    html: 'All maps &copy; ' +\r\n                    '<a href=\"http://www.openseamap.org/\">OpenSeaMap</a>'\r\n                }),\r\n                ol.source.OSM.ATTRIBUTION\r\n            ],\r\n            crossOrigin: null,\r\n            urls: [\r\n                'http://tiles.openseamap.org/seamark/{z}/{x}/{y}.png',\r\n                'http://t1.openseamap.org/seamark/{z}/{x}/{y}.png'\r\n            ]\r\n        })\r\n    });\r\n};\r\nlayers.openStreetMapHumanitarian = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'openStreetMapHumanitarian',\r\n        title: 'Humanitarian <small>(by <a href=\"https://www.openstreetmap.org\">OpenStreetMap</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.OSM({\r\n            attributions: [\r\n                new ol.Attribution({\r\n                    html: 'All maps &copy; ' +\r\n                    '<a href=\"http://www.openstreetmap.fr/\">OpenStreetMap</a>'\r\n                }),\r\n                ol.source.OSM.ATTRIBUTION\r\n            ],\r\n            url: protocol + '//tile-{a-c}.openstreetmap.fr/hot/{z}/{x}/{y}.png'\r\n        })\r\n    });\r\n};\r\nlayers.mapquestOSM = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'mapquestOSM',\r\n        title: 'Road map<small> (by <a href=\"http://open.mapquest.com\">MapQuest</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.MapQuest({\r\n            layer: 'osm'\r\n        })\r\n    });\r\n};\r\nlayers.mapquestSat = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'mapquestSat',\r\n        title: 'Aerial view<small> (by <a href=\"http://open.mapquest.com\">MapQuest</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.MapQuest({\r\n            layer: 'sat'\r\n        })\r\n    });\r\n};\r\n// http://thunderforest.com/maps/opencyclemap/\r\nlayers.openCycleMap = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'openCycleMap',\r\n        title: 'Cycling roads<small> (by <a href=\"http://www.opencyclemap.org\">OpenCycleMap</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.OSM({\r\n            attributions: [\r\n                new ol.Attribution({\r\n                    html: 'All maps &copy; ' +\r\n                    '<a href=\"http://www.opencyclemap.org/\">OpenCycleMap</a>'\r\n                }),\r\n                ol.source.OSM.ATTRIBUTION\r\n            ],\r\n            url: 'http://{a-c}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png'\r\n        })\r\n    });\r\n};\r\n// http://thunderforest.com/maps/transport/\r\nlayers.thunderforestTransport = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'thunderforestTransport',\r\n        title: 'Transports<small> (by <a href=\"http://www.thunderforest.com\">ThunderForest</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.OSM({\r\n            attributions: [\r\n                new ol.Attribution({\r\n                    html: 'All maps &copy; ' +\r\n                    '<a href=\"http://www.thunderforest.com/\">ThunderForest</a>'\r\n                }),\r\n                ol.source.OSM.ATTRIBUTION\r\n            ],\r\n            url: 'http://{a-c}.tile.thunderforest.com/transport/{z}/{x}/{y}.png'\r\n        })\r\n    });\r\n};\r\n// http://thunderforest.com/maps/transport-dark/\r\nlayers.thunderforestTransportDark = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'thunderforestTransportDark',\r\n        title: 'Transport dark<small> (by <a href=\"http://www.thunderforest.com\">ThunderForest</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.OSM({\r\n            attributions: [\r\n                new ol.Attribution({\r\n                    html: 'All maps &copy; ' +\r\n                    '<a href=\"http://www.thunderforest.com/\">ThunderForest</a>'\r\n                }),\r\n                ol.source.OSM.ATTRIBUTION\r\n            ],\r\n            url: 'https://{a-c}.tile.thunderforest.com/transport-dark/{z}/{x}/{y}.png'\r\n        })\r\n    });\r\n};\r\n// http://thunderforest.com/maps/landscape/\r\nlayers.thunderforestLandscape = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'thunderforestLandscape',\r\n        title: 'Landscape<small> (by <a href=\"http://www.thunderforest.com\">ThunderForest</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.OSM({\r\n            attributions: [\r\n                new ol.Attribution({\r\n                    html: 'All maps &copy; ' +\r\n                    '<a href=\"http://www.thunderforest.com/\">ThunderForest</a>'\r\n                }),\r\n                ol.source.OSM.ATTRIBUTION\r\n            ],\r\n            url: 'https://{a-c}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png'\r\n        })\r\n    });\r\n};\r\n// http://thunderforest.com/maps/outdoors/\r\nlayers.thunderforestOutdoor = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'thunderforestOutdoor',\r\n        title: 'Outdoor activities<small> (by <a href=\"http://www.thunderforest.com\">ThunderForest</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.OSM({\r\n            attributions: [\r\n                new ol.Attribution({\r\n                    html: 'All maps &copy; ' +\r\n                    '<a href=\"http://www.thunderforest.com/\">ThunderForest</a>'\r\n                }),\r\n                ol.source.OSM.ATTRIBUTION\r\n            ],\r\n            url: 'https://{a-c}.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png'\r\n        })\r\n    });\r\n};\r\nlayers.arcgis = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'arcgis',\r\n        title: 'Terrain<small> (by <a href=\"https://services.arcgisonline.com\">ArcGIS</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.XYZ({\r\n            crossOrigin: 'anonymous', // Important\r\n            attributions: [\r\n                new ol.Attribution({\r\n                    html: 'Tiles &copy; <a href=\"https://services.arcgisonline.com/ArcGIS/' +\r\n                    'rest/services/World_Topo_Map/MapServer\">ArcGIS</a>'\r\n                })\r\n            ],\r\n            url: protocol + '//server.arcgisonline.com/ArcGIS/rest/services/' +\r\n            'World_Topo_Map/MapServer/tile/{z}/{y}/{x}'\r\n        })\r\n    });\r\n};\r\nlayers.arcgisRestHighwayUSA = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'arcgisRestHighwayUSA',\r\n        title: 'Highway USA<small> (by <a href=\"https://services.arcgisonline.com\">ArcGIS</a>)</small>',\r\n        type: 'base',\r\n        extent: [-13884991, 2870341, -7455066, 6338219],\r\n        source: new ol.source.TileArcGISRest({\r\n            url: protocol + '//sampleserver1.arcgisonline.com/ArcGIS/rest/services/Specialty/' + 'ESRI_StateCityHighway_USA/MapServer'\r\n        })\r\n    });\r\n};\r\nlayers.googleMap = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'googleMap',\r\n        title: 'Road map<small> (by <a href=\"https://www.google.com/maps/\">Google</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.XYZ({\r\n            crossOrigin: 'anonymous', // Important\r\n            url: protocol + '//mt1.google.com/vt/lyrs=m@285235804&hl=en&x={x}&y={y}&z={z}&s=1'\r\n        })\r\n    });\r\n};\r\nlayers.googleTerrain = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'googleTerrain',\r\n        title: 'Terrain + labels<small> (by <a href=\"https://www.google.com/maps/\">Google</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.XYZ({\r\n            crossOrigin: 'anonymous', // Important\r\n            url: protocol + '//mts1.google.com/vt/lyrs=t@132,r@285000000&hl=en&src=app&x={x}&y={y}&z={z}&s=1'\r\n            //url: protocol + '//mts0.google.com/maps//vt/lyrs=t@132,r@285000000&hl=en&src=app&x={x}&y={y}&z={z}&s=1'\r\n        })\r\n    });\r\n};\r\nlayers.googleSatellite = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'googleSatellite',\r\n        title: 'Aerial view<small> (by <a href=\"https://www.google.com/maps/\">Google</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.XYZ({\r\n            crossOrigin: 'anonymous', // Important\r\n            //resolutions: [9784, 2446, 1223, 76.44, 9.55, 2.39],\r\n            url: protocol + '//www.google.se/maps/vt/pb=!1m5!1m4!1i{z}!2i{x}!3i{y}!4i256!2m2!1e1!3i198!4e0'\r\n            //url: protocol + '//khms0.google.com/maps//kh/v=165&src=app&x={x}&y={y}&z={z}&s=1'\r\n        })\r\n    });\r\n};\r\nlayers.bingRoad = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'bingRoad',\r\n        title: 'Road map<small> (by <a href=\"https://www.bing.com/maps/\">Bing</a>)</small>',\r\n        type: 'base',\r\n        maxZoom: 19,\r\n        source: new ol.source.BingMaps({\r\n            key: settings.bingMapsKey,\r\n            imagerySet: 'Road'\r\n        })\r\n    });\r\n};\r\nlayers.bingAerial = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'bingAerial',\r\n        title: 'Aerial view<small> (by <a href=\"https://www.bing.com/maps/\">Bing</a>)</small>',\r\n        type: 'base',\r\n        maxZoom: 19,\r\n        source: new ol.source.BingMaps({\r\n            key: settings.bingMapsKey,\r\n            imagerySet: 'Aerial'\r\n        })\r\n    });\r\n};\r\nlayers.bingAerialWithLabels = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'bingAerialWithLabels',\r\n        title: 'Aerial view with labels<small> (by <a href=\"https://www.bing.com/maps/\">Bing</a>)</small>',\r\n        type: 'base',\r\n        maxZoom: 19,\r\n        source: new ol.source.BingMaps({\r\n            key: settings.bingMapsKey,\r\n            imagerySet: 'AerialWithLabels'\r\n        })\r\n    });\r\n};\r\nlayers.bingCollinsBart = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'bingCollinsBart',\r\n        title: 'CollinsBart<small> (by <a href=\"https://www.bing.com/maps/\">Bing</a>)</small>',\r\n        type: 'base',\r\n        maxZoom: 19,\r\n        source: new ol.source.BingMaps({\r\n            key: settings.bingMapsKey,\r\n            imagerySet: 'collinsBart'\r\n        })\r\n    });\r\n};\r\nlayers.bingOrdnanceSurvey = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'bingOrdnanceSurvey',\r\n        title: 'OrdnanceSurvey<small> (by <a href=\"https://www.bing.com/maps/\">Bing</a>)</small>',\r\n        type: 'base',\r\n        maxZoom: 19,\r\n        source: new ol.source.BingMaps({\r\n            key: settings.bingMapsKey,\r\n            imagerySet: 'ordnanceSurvey'\r\n        })\r\n    });\r\n};\r\n// Stamen\r\n// http://maps.stamen.com/#watercolor/12/37.7706/-122.3782\r\n// toner toner-hybrid toner-labels toner-lines toner-background toner-lite\r\nlayers.stamenToner = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'stamenToner',\r\n        title: 'B&W map<small> (by <a href=\"http://maps.stamen.com\">Stamen</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.Stamen({\r\n            layer: 'toner'\r\n        })\r\n    });\r\n};\r\nlayers.stamenTonerLite = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'stamenTonerLite',\r\n        title: 'Gray scale map<small> (by <a href=\"http://maps.stamen.com\">Stamen</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.Stamen({\r\n            layer: 'toner-lite'\r\n        })\r\n    });\r\n};\r\nlayers.stamenTonerBackground = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'stamenTonerBackground',\r\n        title: 'B&W background<small> (by <a href=\"http://maps.stamen.com\">Stamen</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.Stamen({\r\n            layer: 'toner-background'\r\n        })\r\n    });\r\n};\r\nlayers.stamenWatercolor = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'stamenWatercolor',\r\n        title: 'Watercolor map<small> (by <a href=\"http://maps.stamen.com\">Stamen</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.Stamen({\r\n            layer: 'watercolor'\r\n        })\r\n    });\r\n};\r\n// terrain terrain-labels terrain-lines terrain-background\r\nlayers.stamenTerrain = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'stamenTerrain',\r\n        title: 'Terrain USA<small> (by <a href=\"http://maps.stamen.com\">Stamen</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.Stamen({\r\n            layer: 'terrain'\r\n        })\r\n    });\r\n};\r\nlayers.stamenTerrainWithLabels = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'stamenTerrainLabels',\r\n        title: 'Terrain + labels USA<small> (by <a href=\"http://maps.stamen.com\">Stamen</a>)</small>',\r\n        type: 'base',\r\n        source: new ol.source.Stamen({\r\n            layer: 'terrain-labels'\r\n        })\r\n    });\r\n};\r\nlayers.customBaseLayer = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'customBaseLayer',\r\n        title: 'Custom',\r\n        type: 'base',\r\n        source: new ol.source.XYZ({\r\n            urls: []\r\n        })\r\n    });\r\n};\r\nlayers.mapsForFreeRelief = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'mapsForFreeRelief',\r\n        title: 'Relief<small> (by <a href=\"http://www.maps-for-free.com\">maps-for-free.com</a>)</small>',\r\n        type: 'base',\r\n        //maxResolution: 76.43702828517625, //Z11\r\n        source: new ol.source.XYZ({\r\n            maxZoom: 11,\r\n            urls: [\r\n                'http://www.maps-for-free.com/layer/relief/z{z}/row{y}/{z}_{x}-{y}.jpg'\r\n            ]\r\n        })\r\n    });\r\n};\r\n/*\r\n// Err\r\nlayers.stamenBurningMap = function () {\r\nreturn new ol.layer.Tile({\r\nname: 'stamenBurningMap',\r\ntitle: 'Burning map<small> (by <a href=\"http://maps.stamen.com\">Stamen</a>)</small>',\r\ntype: 'base',\r\nsource: new ol.source.Stamen({\r\nlayer: 'burningmap'\r\n})\r\n});\r\n};\r\n// Err\r\nlayers.stamenMars = function () {\r\nreturn new ol.layer.Tile({\r\nname: 'stamenMars',\r\ntitle: 'Mars<small> (by <a href=\"http://maps.stamen.com\">Stamen</a>)</small>',\r\ntype: 'base',\r\nsource: new ol.source.Stamen({\r\nlayer: 'mars'\r\n})\r\n});\r\n};\r\n// Err\r\nlayers.stamenTreesCabsCrime = function () {\r\nreturn new ol.layer.Tile({\r\nname: 'stamenTreesCabsCrime',\r\ntitle: 'Trees Cabs Crime<small> (by <a href=\"http://maps.stamen.com\">Stamen</a>)</small>',\r\ntype: 'base',\r\nsource: new ol.source.Stamen({\r\nlayer: 'trees-cabs-crime'\r\n})\r\n});\r\n};\r\n*/\r\n// Overlays ____________________________________________________________________________________\r\nlayers.googleBike = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'googleBike',\r\n        title: 'Cycling roads<small> (by <a href=\"https://www.google.com/maps/\">Google</a>)</small>',\r\n        visible: true,\r\n        source: new ol.source.XYZ({\r\n            crossOrigin: 'anonymous',\r\n            url: protocol + '//mts0.google.com/vt/lyrs=h@239000000,bike&hl=en&src=app&x={x}&y={y}&z={z}&s=1'\r\n            //url: protocol + '//mts0.google.com/maps//vt/lyrs=h@239000000,bike&hl=en&src=app&x={x}&y={y}&z={z}&s=1'\r\n        })\r\n    });\r\n};\r\nlayers.googleHybrid = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'googleHybrid',\r\n        title: 'Roads + labels<small> (by <a href=\"https://www.google.com/maps/\">Google</a>)</small>',\r\n        visible: true,\r\n        source: new ol.source.XYZ({\r\n            crossOrigin: 'anonymous',\r\n            url: protocol + '//mt1.google.com/vt/lyrs=h@239000000&hl=en&x={x}&y={y}&z={z}&s=1'\r\n        })\r\n    });\r\n};\r\nlayers.mapquestHyb = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'mapquestHyb',\r\n        title: 'City names<small> (by <a href=\"http://open.mapquest.com\">MapQuest</a>)</small>',\r\n        source: new ol.source.MapQuest({\r\n            layer: 'hyb'\r\n        })\r\n    });\r\n};\r\nlayers.lonviaCycling = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'lonviaCycling',\r\n        title: 'Cycling roads<small> (by <a href=\"http://www.waymarkedtrails.org\">Lonvia</a>)</small>',\r\n        opacity: 0.6,\r\n        source: new ol.source.OSM({\r\n            attributions: [\r\n                new ol.Attribution({\r\n                    html: 'Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> and contributors <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>'\r\n                }),\r\n                ol.source.OSM.ATTRIBUTION\r\n            ],\r\n            crossOrigin: null,\r\n            url: 'http://tile.lonvia.de/cycling/{z}/{x}/{y}.png'\r\n            // urls: [\r\n            //  'http://tile.waymarkedtrails.org/cycling/{z}/{x}/{y}.png',\r\n            //  'http://tile.lonvia.de/cycling/{z}/{x}/{y}.png',\r\n            //  '../../Datas/Tiles/lonvia_cycling/{z}/{x}/{y}.png'\r\n            // ]\r\n        })\r\n    });\r\n};\r\nlayers.lonviaHiking = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'lonviaHiking',\r\n        title: 'Hiking paths<small> (by <a href=\"http://www.waymarkedtrails.org\">Lonvia</a>)</small>',\r\n        opacity: 0.6,\r\n        source: new ol.source.OSM({\r\n            attributions: [\r\n                new ol.Attribution({\r\n                    html: 'Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> and contributors <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>'\r\n                }),\r\n                ol.source.OSM.ATTRIBUTION\r\n            ],\r\n            crossOrigin: null,\r\n            url: 'http://tile.lonvia.de/hiking/{z}/{x}/{y}.png'\r\n        })\r\n    });\r\n};\r\nlayers.stamenTonerHybrid = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'stamenTonerHybrid',\r\n        title: 'B&W roads + labels<small> (by <a href=\"http://maps.stamen.com\">Stamen</a>)</small>',\r\n        source: new ol.source.Stamen({\r\n            layer: 'toner-hybrid'\r\n        })\r\n    });\r\n};\r\nlayers.stamenTonerLabels = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'stamenTonerLabels',\r\n        title: 'B&W labels<small> (by <a href=\"http://maps.stamen.com\">Stamen</a>)</small>',\r\n        source: new ol.source.Stamen({\r\n            layer: 'toner-labels'\r\n        })\r\n    });\r\n};\r\nlayers.stamenTonerLines = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'stamenTonerLines',\r\n        title: 'B&W roads<small> (by <a href=\"http://maps.stamen.com\">Stamen</a>)</small>',\r\n        source: new ol.source.Stamen({\r\n            layer: 'toner-lines'\r\n        })\r\n    });\r\n};\r\n// https://www.google.com/intl/fr-FR_US/help/terms_maps.html\r\nlayers.mapsForFreeWater = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'mapsForFreeWater',\r\n        title: 'Water<small> (by <a href=\"http://www.maps-for-free.com\">maps-for-free.com</a>)</small>',\r\n        opacity: 0.7,\r\n        source: new ol.source.XYZ({\r\n            url: 'http://www.maps-for-free.com/layer/water/z{z}/row{y}/{z}_{x}-{y}.gif'\r\n        })\r\n    });\r\n};\r\nlayers.mapsForFreeAdmin = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'mapsForFreeAdmin',\r\n        title: 'Admin<small> (by <a href=\"http://www.maps-for-free.com\">maps-for-free.com</a>)</small>',\r\n        opacity: 0.3,\r\n        source: new ol.source.XYZ({\r\n            url: 'http://www.maps-for-free.com/layer/admin/z{z}/row{y}/{z}_{x}-{y}.gif'\r\n        })\r\n    });\r\n};\r\n// http://korona.geog.uni-heidelberg.de/contact.html\r\nlayers.uniHeidelbergAsterh = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'uniHeidelbergAsterh',\r\n        title: 'Hillshade<small> (by <a href=\"http://korona.geog.uni-heidelberg.de\">uni-heidelberg.de</a>)</small>',\r\n        source: new ol.source.XYZ({\r\n            maxZoom: 18,\r\n            url: 'http://korona.geog.uni-heidelberg.de/tiles/asterh/x={x}&y={y}&z={z}'\r\n        })\r\n    });\r\n};\r\nlayers.uniHeidelbergAdminb = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'uniHeidelbergAdminb',\r\n        title: 'Admin boundaries<small> (by <a href=\"http://korona.geog.uni-heidelberg.de\">uni-heidelberg.de</a>)</small>',\r\n        opacity: 0.8,\r\n        source: new ol.source.XYZ({\r\n            url: 'http://korona.geog.uni-heidelberg.de/tiles/adminb/x={x}&y={y}&z={z}'\r\n        })\r\n    });\r\n};\r\nlayers.uniHeidelbergHybrid = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'uniHeidelbergHybrid',\r\n        title: 'Hibrid<small> (by <a href=\"http://korona.geog.uni-heidelberg.de\">uni-heidelberg.de</a>)</small>',\r\n        opacity: 0.8,\r\n        source: new ol.source.XYZ({\r\n            url: 'http://korona.geog.uni-heidelberg.de/tiles/hybrid/x={x}&y={y}&z={z}'\r\n        })\r\n    });\r\n};\r\n\r\n\r\n\r\n/**\r\n*\r\n*/\r\nvar ImageData = function () {\r\n    console.warm('ImageData function in development');\r\n};\r\n\r\n\r\n\r\n/**\r\n* Generates a shaded relief image given elevation data.  Uses a 3x3\r\n* neighborhood for determining slope and aspect.\r\n* @private\r\n* @param {Array.<ImageData>} inputs Array of input images.\r\n* @param {Object} data Data added in the \"beforeoperations\" event.\r\n* @return {ImageData} Output image.\r\n*/\r\nvar shade = function (inputs, data) {\r\n    var elevationImage = inputs[0];\r\n    var width = elevationImage.width;\r\n    var height = elevationImage.height;\r\n    var elevationData = elevationImage.data;\r\n    var shadeData = new Uint8ClampedArray(elevationData.length);\r\n    var dp = data.resolution * 2;\r\n    var maxX = width - 1;\r\n    var maxY = height - 1;\r\n    var pixel = [0, 0, 0, 0];\r\n    var twoPi = 2 * Math.PI;\r\n    var halfPi = Math.PI / 2;\r\n    var sunEl = Math.PI * data.sunEl / 180;\r\n    var sunAz = Math.PI * data.sunAz / 180;\r\n    var cosSunEl = Math.cos(sunEl);\r\n    var sinSunEl = Math.sin(sunEl);\r\n    var pixelX, pixelY, x0, x1, y0, y1, offset,\r\n    z0, z1, dzdx, dzdy, slope, aspect, cosIncidence, scaled;\r\n    for (pixelY = 0; pixelY <= maxY; ++pixelY) {\r\n        y0 = pixelY === 0 ? 0 : pixelY - 1;\r\n        y1 = pixelY === maxY ? maxY : pixelY + 1;\r\n        for (pixelX = 0; pixelX <= maxX; ++pixelX) {\r\n            x0 = pixelX === 0 ? 0 : pixelX - 1;\r\n            x1 = pixelX === maxX ? maxX : pixelX + 1;\r\n            // determine elevation for (x0, pixelY)\r\n            offset = (pixelY * width + x0) * 4;\r\n            pixel[0] = elevationData[offset];\r\n            pixel[1] = elevationData[offset + 1];\r\n            pixel[2] = elevationData[offset + 2];\r\n            pixel[3] = elevationData[offset + 3];\r\n            z0 = data.vert * (pixel[0] + pixel[1] * 2 + pixel[2] * 3);\r\n            // determine elevation for (x1, pixelY)\r\n            offset = (pixelY * width + x1) * 4;\r\n            pixel[0] = elevationData[offset];\r\n            pixel[1] = elevationData[offset + 1];\r\n            pixel[2] = elevationData[offset + 2];\r\n            pixel[3] = elevationData[offset + 3];\r\n            z1 = data.vert * (pixel[0] + pixel[1] * 2 + pixel[2] * 3);\r\n            dzdx = (z1 - z0) / dp;\r\n            // determine elevation for (pixelX, y0)\r\n            offset = (y0 * width + pixelX) * 4;\r\n            pixel[0] = elevationData[offset];\r\n            pixel[1] = elevationData[offset + 1];\r\n            pixel[2] = elevationData[offset + 2];\r\n            pixel[3] = elevationData[offset + 3];\r\n            z0 = data.vert * (pixel[0] + pixel[1] * 2 + pixel[2] * 3);\r\n            // determine elevation for (pixelX, y1)\r\n            offset = (y1 * width + pixelX) * 4;\r\n            pixel[0] = elevationData[offset];\r\n            pixel[1] = elevationData[offset + 1];\r\n            pixel[2] = elevationData[offset + 2];\r\n            pixel[3] = elevationData[offset + 3];\r\n            z1 = data.vert * (pixel[0] + pixel[1] * 2 + pixel[2] * 3);\r\n            dzdy = (z1 - z0) / dp;\r\n            slope = Math.atan(Math.sqrt(dzdx * dzdx + dzdy * dzdy));\r\n            aspect = Math.atan2(dzdy, -dzdx);\r\n            if (aspect < 0) {\r\n                aspect = halfPi - aspect;\r\n            } else if (aspect > halfPi) {\r\n                aspect = twoPi - aspect + halfPi;\r\n            } else {\r\n                aspect = halfPi - aspect;\r\n            }\r\n            cosIncidence = sinSunEl * Math.cos(slope) +\r\n            cosSunEl * Math.sin(slope) * Math.cos(sunAz - aspect);\r\n            offset = (pixelY * width + pixelX) * 4;\r\n            scaled = 255 * cosIncidence;\r\n            shadeData[offset] = scaled;\r\n            shadeData[offset + 1] = scaled;\r\n            shadeData[offset + 2] = scaled;\r\n            shadeData[offset + 3] = elevationData[offset + 3];\r\n        }\r\n    }\r\n    return new ImageData(shadeData, width, height);\r\n};\r\n\r\nlayers.mapboxShadedRelief = function () {\r\n    return new ol.layer.Image({\r\n        name: 'mapboxShadedRelief',\r\n        title: 'Shaded relief<small> (by <a href=\"http://www.mapbox.com\">Mapbox</a>)</small>',\r\n        source: new ol.source.Raster({\r\n            sources: [\r\n                new ol.source.XYZ({\r\n                    url: 'https://{a-d}.tiles.mapbox.com/v3/aj.sf-dem/{z}/{x}/{y}.png',\r\n                    crossOrigin: 'anonymous'\r\n                })\r\n            ],\r\n            operationType: 'image',\r\n            operation: shade\r\n        }),\r\n        opacity: 0.3\r\n    });\r\n};\r\n// See http://openlayers.org/en/v3.4.0/examples/kml-timezones.html\r\nlayers.timeZones = function () {\r\n    return new ol.layer.Vector({\r\n        name: 'timeZones',\r\n        title: 'Time zones',\r\n        style: timezonesStyle,\r\n        minResolution: 4891,\r\n        source: new ol.source.Vector({\r\n            extractStyles: false,\r\n            projection: 'EPSG:3857',\r\n            url: 'data/kml/timezones.kml',\r\n            format: new ol.format.KML()\r\n        })\r\n        //source: new ol.source.Vector({\r\n        //    url: 'data/kml/timezones.kml',\r\n        //    format: new ol.format.KML({\r\n        //        extractStyles: false\r\n        //    })\r\n        //})\r\n    });\r\n};\r\nlayers.gpxFile = function () {\r\n    return new ol.layer.Vector({\r\n        name: 'gpxFile',\r\n        title: 'GPS tracks',\r\n        visible: false,\r\n        source: new ol.source.Vector({\r\n            url: '',\r\n            format: new ol.format.GPX()\r\n        }),\r\n        style: new ol.style.Style({\r\n            stroke: new ol.style.Stroke({\r\n                color: '#33ff00',\r\n                width: 5\r\n            })\r\n        })\r\n    });\r\n};\r\n\r\nlayers.drawingVector = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'drawing',\r\n        title: 'My drawings'\r\n        // ,\r\n        //    source: new ol.source.MapQuest({layer: 'sat'})\r\n    });\r\n};\r\nlayers.customOverlay = function () {\r\n    return new ol.layer.Tile({\r\n        name: 'customOverlay',\r\n        title: 'Custom',\r\n        source: new ol.source.XYZ({\r\n            urls: []\r\n        })\r\n    });\r\n};\r\n/*\r\nlayers.toolserverHillShading = function () {\r\nreturn new ol.layer.Tile({\r\nname: 'toolserverHillShading',\r\ntitle: 'Toolserver hill shading',\r\nminZoom: 2,\r\nmaxZoom: 15,\r\nsource: new ol.source.XYZ({\r\n// crossOrigin: null,\r\nurls: [\r\n// 'http://toolserver.org/~cmarqu/hill/{z}/{x}/{y}.png',\r\n'http://a.tiles.wmflabs.org/hillshading/{z}/{x}/{y}.png',\r\n'http://b.tiles.wmflabs.org/hillshading/{z}/{x}/{y}.png',\r\n'http://c.tiles.wmflabs.org/hillshading/{z}/{x}/{y}.png'\r\n]\r\n})\r\n});\r\n};\r\n*/\r\n//layers.grid = function () {\r\n//return new ol.layer.Tile({\r\n//  name: 'gridLayer',\r\n//  title: 'Country data',\r\n//  style: 'Grid',\r\n//  // visible: false,\r\n//  source: sources.grid\r\n//});\r\n//};\r\n// if (map && map.getView()) {\r\n//    map.addLayer(scoresLayer);\r\n// } else {\r\n//    userOverlays.push(scoresLayer);\r\n// }\r\n\r\n// _____________________________________________________________________________________________\r\n\r\n/**\r\n* Update layer source url from a file input\r\n* <input id=\"gpx_file\" type=\"file\" accept=\".gpx\" />\r\n* @see {@link http://www.html5rocks.com/en/tutorials/file/dndfiles/}\r\n* @public\r\n* @param {string} selector - File input ID\r\n* @param {Object} layer - OL3 vector layer\r\n*/\r\n/*\r\nvar GPXFileSource = function (selector, layer) {\r\nif (!(window.File && window.FileReader && window.FileList && window.Blob)) {\r\n$(selector).addClass('disabled');\r\nconsole.warn('The File APIs are not fully supported by your browser.');\r\nreturn false;\r\n}\r\nvar gpxFormat = new ol.format.GPX();\r\nvar gpxFeatures;\r\n\r\nvar $filePath = $(selector);\r\n$filePath.on('change', function (e) {\r\n\r\nvar files = e.target.files;\r\nvar output = [];\r\nfor (var i = 0, f; f = files[i]; i++) {\r\nvar reader = new FileReader();\r\nreader.readAsText(f); //, 'UTF-8'\r\n//reader.readAsDataURL(f);\r\n\r\nreader.onload = function (e) {\r\n\r\ngpxFeatures = gpxFormat.readFeatures(e.target.result, {\r\ndataProjection: 'EPSG:4326',\r\nfeatureProjection: 'EPSG:3857'\r\n});\r\nlayer.getSource().addFeatures(gpxFeatures);\r\n\r\nlayer.setProperties({\r\nvisible: true\r\n});\r\n\r\n};\r\n\r\nreader.onloadstart = function (e) {\r\n//console.log('GPX tracks loading...');\r\n};\r\nreader.onloadend = function (e) {\r\nconsole.log('GPX tracks loaded');\r\n};\r\nreader.onerror = function (e) {\r\nswal({title: 'Oups!', text: 'An error occured while trying to read your file.', type: 'warning'});\r\n};\r\n\r\n// Build the list of loaded files\r\noutput.push('<li class=\"list-group-item\">'\r\n+ escape(f.name) + ' <span class=\"badge\">'\r\n+ formatBytes(f.size)\r\n+ (' ' + f.type || '')\r\n//+ (f.lastModifiedDate ? ' last modified: ' + f.lastModifiedDate.toLocaleDateString() : '')\r\n+ '<span></li>');\r\n};\r\n\r\nvar $list = $(selector + '_list');\r\nif ($list) {\r\n$list.html('<ul class=\"list-group\">' + output.join('') + '</ul>');\r\n}\r\n});\r\n};\r\n*/\r\n\r\n\r\n\r\n// Set default properties\r\n/*$.each(layers, function (i, layer) {\r\nlayer().setProperties(defaultProperties);\r\n});*/\r\n/*\r\n// Translate layer and group titles once i18next plugin initialized\r\n$.when(deferred.init.i18next).done(function () {\r\nroadBaselayers.setProperties({\r\ntitle: $.t('sections:roadLayers.title')\r\n});\r\nreliefBaselayers.setProperties({\r\ntitle: $.t('sections:roadWithReliefLayers.title')\r\n});\r\naerialBaselayers.setProperties({\r\ntitle: $.t('sections:satelliteLayers.title')\r\n});\r\nbaselayers.setProperties({\r\ntitle: $.t('sections:baseLayer.title')\r\n});\r\nroadOverlays.setProperties({\r\ntitle: $.t('sections:roadLayers.title')\r\n});\r\ninformationOverlays.setProperties({\r\ntitle: $.t('sections:infoLayers.title')\r\n});\r\n//terrainOverlays.setProperties({\r\n//    title: $.t('sections:reliefLayers.title')\r\n//});\r\nuserOverlays.setProperties({\r\ntitle: $.t('sections:myLayers.title')\r\n});\r\noverlays.setProperties({\r\ntitle: $.t('sections:layers.title')\r\n});\r\ninformationOverlays.setProperties({\r\ntitle: $.t('sections:infoLayers.title')\r\n});\r\nconsole.log('Map layers translated');\r\n});\r\n*/\r\n\r\n\r\n\r\nreturn {\r\n    create: create,\r\n    loadFileFeatures: loadFileFeatures,\r\n    initSettingsForm: initSettingsForm,\r\n    selectedLayer: selectedLayer,\r\n    settings: settings,\r\n    treatLayers: treatLayers,\r\n    updateSourceUrl: updateSourceUrl\r\n};\r\n\r\n})();\r\n"]}