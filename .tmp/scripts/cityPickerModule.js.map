{"version":3,"sources":["../../app/scripts/cityPickerModule.js"],"names":[],"mappings":"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","file":"cityPickerModule.js","sourcesContent":["//jslint browser: true\n//global window, console, $, ol, swal, Quill, geocodeModule\n\n/**\n * City picker module.\n * @external jQuery\n * @external OL3\n * @external swal\n * @external Quill\n * @external geocodeModule\n * @module\n * @returns {Object} Public functions and variables\n */\nvar cityPickerModule = (function () {\n    'use strict';\n\n    var settings = {\n        quill: {\n            //readOnly: false,\n            //theme: 'snow',\n            styles: false,\n            formats: ['bold', 'italic', 'strike', 'underline',\n                    'font', 'size', 'align', 'color', 'background'] //'bullet', 'list', 'image', 'link'\n        },\n        spinner: {\n            color: '#fff',\n            scale: 0.75\n        }\n    };\n    \n    var editor;\n    var spinner = new Spinner(settings.spinner);    \n    \n    \n\n    /**\n     * Convert a number to a name according to the range of values\n     * @param {number} number - The number to convert\n     * @param {number} min - The minimal value the number can have\n     * @param {number} min - The minimal value the number can have\n     * @param {array} values - Possible returned values sorted from the smallest to the biggest\n     * @param {integer} index - Default value (array index starting from 0)\n     * @returns {string} One of the possible values\n     */\n    var numberToName = function (number, min, max, values, index) {\n        //if (!$.isNumeric(number)) return values[index];\n\n        // Define the default value with the medium value if empty\n        index = index || Math.ceil(values.length / 2);\n        // Make sure the number is in the min-max range\n        number = Math.min(Math.max(number, min), max);\n\n        var step = (max - min) / values.length;\n        var i = (number - min) / step;\n        i = i.toFixed(0);\n        var name = values[i] || values[index];\n        console.log('numberToFontSize(' + number + ', ' + min + ', ' + max + ') step:' + step + ' i:' + i + ' name:' + name);\n        return name;\n    };\n\n\n\n    /**\n     * Convert a number to a valid font size-name\n     * @param {number} number - Value to convert\n     * @param {number} min - The smallest value accepted\n     * @param {number} max - The biggest value accepted\n     * @returns {string} A valid font size-name from xx-small to xx-large\n     */\n    var _numberToFontSizeName = function (number, min, max) {\n        var array = ['xx-small', 'x-small', 'smaller', 'small', 'normal',\n                'large', 'larger', 'x-large', 'xx-large'];\n        return numberToName(number, min, max, array, 4);\n    };\n\n\n    /**\n     * Convert a number to a valid color name\n     * @param {number} number - Value to convert\n     * @param {number} min - The smallest value accepted\n     * @param {number} max - The biggest value accepted\n     * @returns {string} A valid color name\n     */\n    var _numberToColorName = function (number, min, max) {\n        var array = ['lightgray', 'gray', 'black']; // 'whitesmock', 'silver',\n        return numberToName(number, min, max, array, 1);\n    };\n\n\n\n    /**\n     * Prepare cursor for insertion\n     * - Delete selected text\n     * - Move to the end if position cannot be found\n     * - Set position to 0 if editor is empty (pos 1)\n     * @returns {integer} Cursor position\n     */\n    var _posBeforeInsert = function () {\n\n        var pos;\n        var length = editor.getLength();\n        // Focus editor prior to get selection\n        if (length > 1) {\n            editor.focus();\n        }\n        var range = editor.getSelection();\n\n        if (range) {\n            pos = range.start; //+ 1\n            if (range.start !== range.end) {\n                editor.deleteText(range.start, range.end);\n            }\n            console.log('Cursor ready for insertion at pos ' + pos);\n        } else {\n            pos = length - 1;\n            console.log('Cursor is ready for insertion at the last pos ' + pos);\n        }\n        //if (pos === 1) pos = 0;\n\n        return pos;\n\n    };\n\n\n\n    /**\n     * Add city name to the editor\n     * @param {Object} json - The JSON object returned by Nominatim\n     */\n    var _insertCity = function (json) {\n\n        var size,\n            color,\n            names = [],\n            types = ['country', 'state', 'county',\n                    'city', 'town', 'village', 'hamlet']; //'state_district', 'city_district',\n        //var smallestAreaType = $('#smallest_area_type').val() || 'village';\n\n        if (!json) {\n            return;\n        }\n\n        if (json.address) {\n            var name;\n            types.forEach(function (value) {\n                if (json.address[value]) {\n                    name = json.address[value];\n                    //console.log(value + '/' + smallestAreaType);\n                    //if (value === smallestAreaType) {\n                    //    return false;\n                    //}\n                }\n            });\n            names.push(name);\n        }\n\n        if (json.extratags) {\n            // Define font size depending on population\n            if (json.extratags.population && $('#font_size_proportional').is(':checked')) {\n                //var size = (Math.log(json.extratags.population) / 15 + 0.4).toFixed(2) + 'em';\n                size = _numberToFontSizeName(Math.log(json.extratags.population) || 0, 0, Math.log(25000000));\n            }\n            if (json.extratags.population && $('#font_color_proportional').is(':checked')) {\n                //var val = (255 - Math.log(json.extratags.population) * 15).toFixed(0);\n                //var color = 'rgb(' + val + ', ' + val + ', ' + val + ')';\n                color = _numberToColorName(Math.log(json.extratags.population) || 0, 0, Math.log(25000000));\n            }\n        }\n\n        if (json.namedetails) {\n            // Add also the local language name\n            if ($('#insert_local_name').is(':checked') && json.namedetails.name) {\n                names.push(json.namedetails.name);\n            }\n        }\n\n        // Insert text\n        if (names.length > 0) {\n            var pos = _posBeforeInsert();\n            var text;\n\n            // Insert icon\n            if (json.icon && $('#insert_icon') && $('#insert_icon').is(':checked')) {\n                text = json.icon;\n                console.log('pos:' + pos + ' text:' + text);\n                editor.insertEmbed(pos, 'image', text);\n                pos = pos + 1;//text.length;\n                //console.log('Cursor positioned at pos:' + pos + '/' + editor.getLength() - 1);\n            }\n\n            // Insert city name\n            text = $.unique(names).join(' / ');\n            editor.insertText(pos, text, {\n                'size': size || '1em',\n                'color': color || 'black'\n            });\n            pos = pos + text.length;\n            //console.log('Cursor positioned at pos:' + pos + '/' + editor.getLength() - 1);\n\n            // Insert a separator\n            var $separator = $('#separator');\n            text = ($separator) ? $separator.val() : '\\n';\n            editor.insertText(pos, text);\n            pos = pos + text.length;\n            //console.log('Cursor positioned at pos:' + pos + '/' + editor.getLength() - 1);\n\n            // Move cursor after insertions\n            editor.setSelection(pos, pos);\n\n            console.log('Cursor positioned at pos:' + pos + '/' + editor.getLength() - 1);\n\n\n        } else {\n            console.log('Extracted data does not contain a city name.');\n        }\n\n\n\n    };\n\n\n\n    /**\n     * Use reverse geocode to define the name of the city at a given position\n     * @param {object} json - The JSON object returned by Nominatim reverse geocode\n     */\n    var _getCityDetails = function (json) {\n\n        if (!json || !json.address) {\n            return;\n        }\n\n        var params = {\n            format: 'json',\n            limit: 1,\n            polygon_svg: 0,\n            addressdetails: 1,\n            extratags: 1,\n            namedetails: 1\n            //'accept-language': 'en'\n        };\n\n        // Build query\n        var query = [];\n        // , 'city_district', 'state_district'\n        ['village', 'town', 'city', 'county', 'state', 'country'].forEach(function (value) {\n            if (json.address[value]) {\n                query.push(json.address[value]);\n                //console.log(json.address[value]);\n                return false;\n            }\n        });\n\n        // Build params\n        $.each({city: 'city', county: 'county', state: 'state', country: 'country',\n                'postal_code': 'postalcode', 'country_code': 'countrycodes'}, function (key, value) {\n            if (json.address[key]) {\n                params[value] = json.address[key];\n            }\n        });\n\n        return geocodeModule.nominatimSearch(params, query);\n\n    };\n\n\n\n    /**\n     * Use reverse geocode to define the name of the city at a given position\n     * @param {object} position - Longitude, latitude at EPSG:4326 projection\n     * @param {integer} zoom - Zoom level used for extraction\n     */\n    var _getCity = function (position, zoom) {\n\n        if (!position || !zoom) {\n            return false;\n        }\n        \n        spinner.spin(document.getElementById('spinner'));\n        \n        //console.log('Zoom: ' + zoom);\n        zoom = Math.min(Math.max((zoom || 10), 0), 18);\n        //console.log('Extraction level: ' + zoom);\n\n        var params = {\n            format: 'json',\n            lon: position[0],\n            lat: position[1],\n            zoom: zoom, //$('#zoom_level_extraction').val() || 10\n            osm_type: 'N',\n            addressdetails: 1,\n            extratags: 0,\n            namedetails: 0,\n            'accept-language': 'en'\n        };\n\n        geocodeModule.nominatimReverse(params).success(function (json) {\n            //console.log(JSON.stringify(json));\n\n            setTimeout(function () {\n                return _getCityDetails(json)\n                    .success(function (json) {\n                        console.log(JSON.stringify(json));\n                        _insertCity(json[0]);\n                    })\n                    .done(function () {\n                        spinner.stop();\n                    });\n            }, 1000);\n            \n            \n            /*\n            if ($('#font_color_proportional, #font_size_proportional, #insert_local_name, #insert_icon').is(':checked')) {\n                // Wait 1s to respect the Nominatim policy\n                // and make a seconde request to get more details\n                setTimeout(function () {\n                    _getCityDetails(json);\n                }, 1000);\n            } else {\n                // Else insert the city name in editor\n                _insertCity(json);\n            }\n            */\n\n        });\n\n    };\n\n\n    /**\n     * Print editor content\n     * @param {Object} data - Formated text\n     */\n    var _print = function (data) {\n\n        console.log(data);\n\n        console.log($('#export_direction').val());\n        var $el = $('#export_direction');\n        if ($el && $el.val() === 'inline') {\n            data = data.replace(/<div>/g, ', ');\n            console.log(data);\n        }\n\n        var printWin = window.open('', window.location.hostname, ''); //height=600,width=800\n        printWin.document.write('<html>'\n                + '<head><title>' + window.location.hostname + '</title></head>'\n                + '<body>' + data + '</body></html>');\n        printWin.print();\n        printWin.close();\n\n        return true;\n    };\n\n\n\n    /**\n     * Start listening clicks on the map\n     * @public\n     * @param {Object} map - OL3 map\n     */\n    var setMap = function (map) {\n    \n        map.on('click', function (evt) {\n\n            var view = map.getView();\n            var zoom = view.getZoom();\n            var position = evt.coordinate;\n            var projection = view.getProjection();\n            \n            position = ol.proj.transform(position, projection.getCode(), 'EPSG:4326');\n            \n            console.time('Reverse geocoding');\n            _getCity(position, zoom);\n            console.timeEnd('Reverse geocoding');\n            \n        });\n\n    };\n\n\n\n    /**\n     * Toggle buttons visibility when editor is empty or not\n     */\n    var _toggleButtonStatusEmptyEditor = function () {\n\n        var $buttons = $('#copy_editor, #print_editor, #erase_editor');\n        if (editor.getLength() === 1) {\n            $buttons\n                .attr('disabled', true)\n                .closest('li').addClass('disabled');\n            //$('#get_started_alert').fadeIn();\n        } else {\n            $buttons\n                .attr('disabled', false)\n                .closest('li').removeClass('disabled');\n            //$('#get_started_alert').fadeOut();\n        }\n\n    };\n\n\n\n    $(function () {\n\n        var $editor = $('#editor');\n\n        editor = new Quill('#editor', settings.quill);\n        editor.addModule('toolbar', {\n            container: '#editor_toolbar'\n        });\n        var qlMultiCursorModule = editor.addModule('multi-cursor', {\n            timeout: 10000\n        });\n\n        editor.on('selection-change', function (range) {\n\n            var $buttons = $('#editor_toolbar').find('.ql-bold, .ql-italic, .ql-strike, .ql-underline, .ql-size, .ql-color, .ql-background'); // .ql-font .ql-align .ql-bullet .ql-list .ql-image .ql-link\n            \n            if (range) {\n                if (range.start === range.end) {\n                    //qlMultiCursorModule.setCursor('selectionStart', range.start, 'Insertion point', '#337ab7');\n                    $buttons.attr('disabled', true).closest('li').addClass('disabled');\n                    console.log('Cursor is on', range.start);\n                } else {\n                    //var text = editor.getText(range.start, range.end);\n                    $buttons.attr('disabled', false).closest('li').removeClass('disabled');\n                    //console.log('User has highlighted', text);\n                }\n            } else {\n                console.log('Cursor not in the editor');\n            }\n        });\n\n        editor.on('text-change', function (delta, source) {\n\n            // Copy editor content to hidden textarea (for garlic autosave)\n            $('#stored_roadbook').val(editor.getHTML()).trigger('change');\n\n            _toggleButtonStatusEmptyEditor();\n\n            // Auto-scroll the textarea to keep the last city visible\n            $editor.scrollTop($editor[0].scrollHeight);\n\n        });\n\n        // Populate editor with hidden textarea data\n        // once garlic has restored this field\n        // then move the cursor to the end\n        $('#stored_roadbook').garlic({\n            excluded: '',\n            onRetrieve: function (elem, retrievedValue) {\n                editor.setHTML(retrievedValue);\n                //var pos = editor.getLength() - 1;\n                //editor.setSelection(pos, pos);\n                //console.log('Cursor moved to position ' + pos);\n            }\n        });\n\n        _toggleButtonStatusEmptyEditor();\n\n        // Print button\n        $('#print_editor').click(function (e) {\n            e.preventDefault();\n            _print(editor.getHTML());\n        });\n\n        // Erase button\n        $('#erase_editor').click(function (e) {\n            e.preventDefault();\n\n            swal({\n                title: 'Are you sure?',\n                text: 'Your roadbook will be permanently deleted. You will not be able to recover it.',\n                type: 'warning',\n                showCancelButton: true,\n                confirmButtonColor: '#DD6B55',\n                confirmButtonText: 'Yes delete it',\n                cancelButtonText: 'No stop !',\n                closeOnConfirm: false,\n                closeOnCancel: false\n            }, function (isConfirm) {\n                if (isConfirm) {\n                    editor.setText('');\n                    swal({\n                        title: 'Deleted!',\n                        text: 'Your roadbook has been deleted. Let\\'s start a new one!',\n                        type: 'success',\n                        timer: 2500,\n                        showConfirmButton: false\n                    });\n                } else {\n                    swal({\n                        title: 'Cancelled',\n                        text: 'Whew... you narrow escape! ^_^',\n                        type: 'error',\n                        timer: 2500,\n                        showConfirmButton: false\n                    });\n                }\n            });\n\n        });\n\n        // Copy to clipboard button\n        /*\n        var client = new ZeroClipboard(document.getElementById('copy_editor'));//editor\n        client.on('ready', function (readyEvent) {\n            console.log('ZeroClipboard ready');\n        });\n        client.on('copy', function (event) {\n            event.clipboardData.setData('text/plain', event.relatedTarget.innerHTML\n                //.replace(/[<&>'\"]/g, function (c) {\n                //    return \"&#\" + c.charCodeAt() + \";\";\n                //})\n            );\n            client.on('aftercopy', function (event) {\n                swal({title: 'Good job!', text: 'Your roadbook has been copied to the clipboard.', type: 'success', timer: 2500, showConfirmButton: true});\n            });\n        });\n        client.on('error', function (event) {\n            swal({title: 'Oups!', text: 'ZeroClipboard error of type \"' + event.name + '\": ' + event.message, type: 'warning', timer: 10000, showConfirmButton: true});\n            ZeroClipboard.destroy();\n        });\n        */\n\n        // Show / hide editor toolbar switch\n        /*var $el = $('#editor_toolbar_visibility');\n        $el.change(function () {\n            if ($el.is(':checked')) {\n                $('#editor_toolbar').show();\n            } else {\n                $('#editor_toolbar').hide();\n            }\n        });//.trigger('change');*/\n\n    });\n\n    return {\n        setMap: setMap\n        //getCityDetails: getCityDetails,\n        //insertCity: insertCity\n    };\n\n})();"]}