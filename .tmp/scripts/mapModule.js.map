{"version":3,"sources":["../../app/scripts/mapModule.js"],"names":[],"mappings":"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","file":"mapModule.js","sourcesContent":["//jslint browser: true\n//global console, window, escape, FileReader, $, ol, controls, mapControlsModule\n\n/**\n * OL3 module.\n * @external jQuery\n * @external ol3\n * @see {@link http://openlayers.org/en/v3.12.1/apidoc/}\n * @module\n * @returns {Object} Public functions and variables\n */\nvar mapModule = (function () {\n    'use strict';\n\n    var map,\n        draw,\n        ready = $.Deferred();\n\n\n\n    /**\n     * Draw map\n     * @public\n     */\n    var init = function (target) {\n\n        ready.resolve();\n\n        return map;\n\n    };\n\n\n\n    /**\n     * Add a predefined control on a initialized map\n     * (Remove control with map.removeControl(control);)\n     * @private\n     * @param {string} control - Predefined control variable name\n     * @param {object} map - OL3 initialized map\n     */\n    var _addControl = function (control, map) {\n        if (!map || !controls[control]) {\n            return;\n        }\n        map.addControl(mapControlsModule.controls[control]);\n    };\n\n\n\n\n    /**\n     * Center the map at a given position and make a zoom\n     * @public\n     * @param {number} longitude - Longitude at EPSG:4326 projection\n     * @param {number} latitude - Latitude at EPSG:4326 projection\n     * @param {integer} [zoom] - Zoom from 0 to 18\n     */\n    var centerMap = function (longitude, latitude, zoom) {\n\n        var view = map.getView();\n        view.setCenter(ol.proj.transform([longitude, latitude], 'EPSG:4326', 'EPSG:3857'));\n        if (zoom) {\n            view.setZoom(zoom);\n        }\n        console.log('Map centered at longitude: ' + longitude + ' latitude: ' + latitude + ' zoom: ' + zoom);\n    };\n\n\n\n    /**\n     * Center map on user position\n     * @public\n     * @param {Object} map - OL3 map\n     */\n    var centerOnPosition = function (map) {\n\n        var view = map.getView();\n\n        var geolocation = new ol.Geolocation({\n            projection: view.getProjection(),\n            tracking: true\n        });\n\n        geolocation.once('change:position', function () {\n            view.setCenter(geolocation.getPosition());\n            //view.setResolution(2.388657133911758);\n            view.setZoom(10);\n        });\n        \n    };\n\n\n\n    /**\n     * Center the map on a vector source and adjust zoom\n     * @see {@link http://openlayers.org/en/v3.4.0/examples/center.html}\n     * @public\n     */\n    var fitLayerGeometry = function (id, map, layer, featureId) {\n\n        var source = layer.getSource();\n        var feature = source.getFeatureById(id);\n        var polygon = /** @type {ol.geom.SimpleGeometry} */ (feature.getGeometry());\n        var size = /** @type {ol.Size} */ (map.getSize());\n\n        var view = map.getView();\n        view.fit(polygon, size, {\n            padding: [0, 0, 0, 0],\n            constrainResolution: false\n            // nearest: true,\n            // minResolution: 50\n        });\n    };\n\n\n\n    /**\n     * Fit all layers in the map viewport\n     * @public\n     * @param {Object} map - OL3 map\n     */\n    var fitAll = function (map) {\n\n        var extent = ol.extent.createEmpty();\n        map.getLayers().forEach(function (layer) {\n            ol.extent.extend(extent, layer.getSource().getExtent());\n        });\n        map.getView().fit(extent, map.getSize());\n\n    };\n\n\n\n    /**\n     * Zoom out to view extent\n     * @public\n     * @param {Object} map - OL3 map\n     */\n    var zoomOut = function (map) {\n        //var extent = map.  .getSource().getExtent();\n        var view = map.getView();\n        var extent = view.getExtent();\n        view.fit(extent, map.getSize());\n    };\n\n\n\n    /**\n     * Update layer source url from a file input\n     * <input id=\"gpx_file_path\" type=\"file\" accept=\".gpx\" />\n     * @see {@link http://www.html5rocks.com/en/tutorials/file/dndfiles/}\n     * @public\n     * @param {string} selector - File input ID\n     * @param {Object} layer - OL3 vector layer\n     */\n    var setFileSource = function (selector, layer) {\n\n        if (!(window.File && window.FileReader && window.FileList && window.Blob)) {\n            console.warn('The File APIs are not fully supported in this browser.');\n        }\n\n        var $filePath = $(selector);\n        $filePath.on('change', function (e) {\n\n            var files = e.target.files;\n            files.forEach(function (f) {\n\n                var reader = new FileReader();\n                reader.onload = (function (theFile) {\n                    return function (e) {\n                        layer.setProperties({\n                            title: escape(theFile.name),\n                            source: new ol.source.Vector({\n                                url: e.target.result,\n                                format: new ol.format.GPX()\n                            }),\n                            visible: true\n                        });\n                    };\n                })(f);\n\n                reader.readAsDataURL(f);\n\n            });\n\n        });\n\n    };\n\n\n\n    return {\n        map: map,\n        ready: ready,\n        init: init,\n        centerOnPosition: centerOnPosition,\n        setFileSource: setFileSource,\n        fitAll: fitAll\n    };\n\n})();"]}