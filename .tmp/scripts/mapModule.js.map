{"version":3,"sources":["../../app/scripts/mapModule.js"],"names":[],"mappings":"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","file":"mapModule.js","sourcesContent":["//jslint browser: true\n//global console, window, escape, FileReader, $, ol, controls, mapControlsModule\n\n/**\n * OL3 module.\n * @external jQuery\n * @external ol3\n * @see {@link http://openlayers.org/en/v3.12.1/apidoc/}\n * @module\n * @returns {Object} Public functions and variables\n */\nvar mapModule = (function () {\n    'use strict';\n    \n    var map,\n        draw,\n        ready = $.Deferred();\n\n\n\n    /**\n     * Draw map\n     * @public\n     */\n    var init = function (target) {\n\n        ready.resolve();\n\n        return map;\n\n    };\n\n\n\n    /**\n     * Add a predefined control on a initialized map\n     * (Remove control with map.removeControl(control);)\n     * @private\n     * @param {string} control - Predefined control variable name\n     * @param {object} map - OL3 initialized map\n     */\n    var _addControl = function (control, map) {\n        if (!map || !controls[control]) {\n            return;\n        }\n        map.addControl(mapControlsModule.controls[control]);\n    };\n\n\n\n\n    /**\n     * Center the map at a given position and make a zoom\n     * @public\n     * @param {number} longitude - Longitude at EPSG:4326 projection\n     * @param {number} latitude - Latitude at EPSG:4326 projection\n     * @param {integer} [zoom] - Zoom from 0 to 18\n     */\n    var centerMap = function (longitude, latitude, zoom) {\n\n        var view = map.getView();\n        view.setCenter(ol.proj.transform([longitude, latitude], 'EPSG:4326', 'EPSG:3857'));\n        if (zoom) {\n            view.setZoom(zoom);\n        }\n        console.log('Map centered at longitude: ' + longitude + ' latitude: ' + latitude + ' zoom: ' + zoom);\n    };\n\n\n\n    /**\n     * Center map on user position\n     * @public\n     * @param {Object} map - OL3 map\n     */\n    var centerOnPosition = function (map) {\n\n        var view = map.getView();\n\n        var geolocation = new ol.Geolocation({\n            projection: view.getProjection(),\n            tracking: true\n        });\n\n        geolocation.once('change:position', function () {\n            view.setCenter(geolocation.getPosition());\n            //view.setResolution(2.388657133911758);\n            view.setZoom(10);\n        });\n        \n    };\n\n\n\n    /**\n     * Center the map on a vector source and adjust zoom\n     * @see {@link http://openlayers.org/en/v3.4.0/examples/center.html}\n     * @public\n     */\n    var fitLayerGeometry = function (id, map, layer, featureId) {\n\n        var source = layer.getSource();\n        var feature = source.getFeatureById(id);\n        var polygon = /** @type {ol.geom.SimpleGeometry} */ (feature.getGeometry());\n        var size = /** @type {ol.Size} */ (map.getSize());\n\n        var view = map.getView();\n        view.fit(polygon, size, {\n            padding: [0, 0, 0, 0],\n            constrainResolution: false\n            // nearest: true,\n            // minResolution: 50\n        });\n    };\n\n\n\n    /**\n     * Fit all layers in the map viewport\n     * @public\n     * @param {Object} map - OL3 map\n     */\n    var fitAll = function (map) {\n\n        var extent = ol.extent.createEmpty();\n        map.getLayers().forEach(function (layer) {\n            ol.extent.extend(extent, layer.getSource().getExtent());\n        });\n        map.getView().fit(extent, map.getSize());\n\n    };\n\n\n\n    /**\n     * Zoom out to view extent\n     * @public\n     * @param {Object} map - OL3 map\n     */\n    var zoomOut = function (map) {\n        //var extent = map.  .getSource().getExtent();\n        var view = map.getView();\n        var extent = view.getExtent();\n        view.fit(extent, map.getSize());\n    };\n\n    \n    \n    /**\n     * Convert bytes to string size\n     * @param {integer} bytes - Size in bytes\n     * @param {integer} decimals - Round number to n decimals\n     * @returns {string} The formatted value\n     */\n    var _formatBytes = function (bytes, decimals) {\n       if(bytes == 0) return '0 Byte';\n       var k = 1000;\n       var dm = decimals + 1 || 3;\n       var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n       var i = Math.floor(Math.log(bytes) / Math.log(k));\n       return (bytes / Math.pow(k, i)).toPrecision(dm) + ' ' + sizes[i];\n    };\n\n\n\n    /**\n     * Update layer source url from a file input\n     * <input id=\"gpx_file_path\" type=\"file\" accept=\".gpx\" />\n     * @see {@link http://www.html5rocks.com/en/tutorials/file/dndfiles/}\n     * @public\n     * @param {string} selector - File input ID\n     * @param {Object} layer - OL3 vector layer\n     */\n    var setFileSource = function (selector, layer) {\n\n        if (!(window.File && window.FileReader && window.FileList && window.Blob)) {\n            swal({title: 'Oups!', text: 'The File APIs are not fully supported by your browser.', type: 'warning'});\n            return;\n        }\n\n        var gpxFormat = new ol.format.GPX();\n        var gpxFeatures;\n    \n        var $filePath = $(selector);  \n        $filePath.on('change', function (e) {\n            \n            var files = e.target.files;\n            var output = [];\n            for (var i = 0, f; f = files[i]; i++) {\n\n                var reader = new FileReader();                \n                reader.readAsText(f); //, 'UTF-8'\n                //reader.readAsDataURL(f);\n                \n                reader.onload = function (e) {\n                    \n                    gpxFeatures = gpxFormat.readFeatures(e.target.result, {\n                        dataProjection: 'EPSG:4326',\n                        featureProjection: 'EPSG:3857'\n                    });\n                    layer.getSource().addFeatures(gpxFeatures);\n                    \n                    layer.setProperties({\n                        visible: true\n                    });\n                    \n                };\n                \n                reader.onloadstart = function (e) {\n                    //console.log('GPX tracks loading...');\n                };\n                reader.onloadend = function (e) {\n                    console.log('GPX tracks loaded');\n                };\n                reader.onerror = function (e) {\n                    swal({title: 'Oups!', text: 'An error occured while trying to read your file.', type: 'warning'});\n                };\n                \n                // Build the list of loaded files\n                output.push('<li class=\"list-group-item\">'\n                + escape(f.name) + ' <span class=\"badge\">'\n                + _formatBytes(f.size)\n                + (' ' + f.type || '')\n                //+ (f.lastModifiedDate ? ' last modified: ' + f.lastModifiedDate.toLocaleDateString() : '')\n                + '<span></li>');\n\n            };\n            \n            var $list = $(selector + '_list');\n            if ($list) {\n                $list.html('<ul class=\"list-group\">' + output.join('') + '</ul>');\n            }\n\n        });\n\n    };\n\n\n\n    return {\n        map: map,\n        ready: ready,\n        init: init,\n        centerOnPosition: centerOnPosition,\n        setFileSource: setFileSource,\n        fitAll: fitAll\n    };\n\n})();"]}