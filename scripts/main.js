"use strict";if(window.numberToName=function(e,t,o,n,a){a=a||Math.ceil(n.length/2);var r=(o-t)/n.length,i=(e-t)/r;i=Math.min(Math.max(i.toFixed(0),0),n.length-1);var l=n[i]||n[a];return console.log("numberToFontSize("+e+", "+t+", "+o+") step: "+r+" i: "+i+" name: "+l),l},window.formatBytes=function(e,t){if(0===e)return"0 Byte";var o=1e3,n=t+1||3,a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(e)/Math.log(o));return(e/Math.pow(o,r)).toPrecision(n)+" "+a[r]},window.escapeHtml=function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(e).replace(/[&<>"'\/]/g,function(e){return t[e]})},"undefined"==typeof $.urlParam&&($.urlParam=function(e){var t=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null===t?null:t[1]||0}),"undefined"==typeof String.prototype.toUpperCaseFirst&&(String.prototype.toUpperCaseFirst=function(){return this.charAt(0).toUpperCase()+this.slice(1).toLowerCase()}),"undefined"==typeof toCamel)var toCamel=function(){return this.toLowerCase().replace(/[^a-zA-Z0-9]([a-zA-Z0-9])?/g,function(e){return e[1]?e[1].toUpperCase():""})};if("undefined"==typeof String.prototype.toCamel&&(String.prototype.toCamel=function(e){return this.toLowerCase().replace(/[^a-zA-Z0-9]([a-zA-Z0-9])?/g,function(e){return e[1]?e[1].toUpperCase():""})}),"undefined"==typeof Array.prototype.max&&(Array.prototype.max=function(e){return Math.max.apply(Math,e)}),"undefined"==typeof Array.prototype.min&&(Array.prototype.min=function(e){return Math.min.apply(Math,e)}),"undefined"==typeof degToRad)var degToRad=function(e){return e*Math.PI*2/360};if("undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),"undefined"==typeof radToDeg)var radToDeg=function(e){return 360*e/(2*Math.PI)};if("undefined"==typeof Number.prototype.toDeg&&(Number.prototype.toDeg=function(){return 360*this/(2*Math.PI)}),"undefined"==typeof mod)var mod=function(e){return(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)};if("undefined"==typeof Number.prototype.mod&&(Number.prototype.mod=function(){return(this%(2*Math.PI)+2*Math.PI)%(2*Math.PI)}),"undefined"==typeof formatBytes)var formatBytes=function(e,t){if(0===e)return"0 Byte";var o=1e3,n=t+1||3,a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(e)/Math.log(o));return(e/Math.pow(o,r)).toPrecision(n)+" "+a[r]};if("undefined"==typeof getAllEvents)var getAllEvents=function(e){var t=[];for(var o in e)0===o.indexOf("on")&&t.push(o.slice(2));return t.join(" ")};var Spinner=function(e){var t={selector:".spinner"};e=$.extend(!0,{},t,e);var o,n=[],a=$(e.selector);a.fadeOut();var r=function(e){return"undefined"==typeof e.state?(console.warn("Parameter shoud be a deferred"),!1):(n.push(e),void(o&&"pending"===o.state()||(a.fadeIn(),o=new $.Deferred,i())))},i=function l(){var e=n;n=[],$.when.apply($,e).always(function(){n.length>0?l():(o.resolve(),a.fadeOut())})};return{addJob:r}},commonsModule=function(){var e,t={debug:!1,disabledLogs:["log","time","timeEnd"],hideHash:!0,selector:{userLanguage:"#user_language, #language, #lang"},basil:{},adsense:{containers:".adsbygoogle",adClient:"ca-pub-8495719252049968",adSlot:"3723415549",adFormat:"auto"},garlic:{fieldsSelector:".garlic-auto-save",formsSelector:'[data-persist="garlic"]'},parsley:{fieldsSelector:"[data-parsley-id]",formsSelector:"[data-parsley-validate]"},webFontLoader:{version:"1.6.16",config:{google:{families:["Material+Icons"]}}},materialDesign:{iconsSelector:".material-icons"},parallax:{selector:'[data-type="background"]'},scrollTo:{toggleSelector:".scroll"},mixitup:{selector:"#disabled_priorities, #faq_list"},i18next:{instance:null},input:{events:"input change click"},chosen:{events:"chosen:updated chosen:maxselected"},bootstrapSwitch:{events:" switchChange.bootstrapSwitch"},sortable:{events:"sortactivate sortbeforeStop sortchange sortcreate sortdeactivate sortout sortover sortreceive sortremove sort sortstart sortstop sortupdate"},dataReset:{formsSelector:"form",toggleSelector:".delete_data"},inputReset:{formsSelector:"form",toggleSelector:".reset_inputs",defaultAttribut:"default-value"},spinner:{selector:".spinner"},swal:{resetData:{title:"Reset everything",text:"This will erase your roadbook, reset settings and delete all local data stored by this application.",type:"warning",confirmButtonText:"Yes reset",cancelButtonText:"No stop !",showCancelButton:!0,closeOnConfirm:!1},inputReset:{title:"Done",text:"All inputs have been reset to their default values.",type:"success",timer:3e3,showConfirmButton:!1}}},o=t,n="https:"===window.location.protocol?"https:":"http:",a=new Spinner(o.spinner),r=function(e){e=e||"body";var t,n=$(e).find(o.adsense.containers).filter(":not([data-adsbygoogle-status])");console.log(n.length+" uninitialized ad(s) found in "+e),n.each(function(e,n){t=$(n),0===t.parents(":not(:visible)").length?(t.attr("data-ad-client")||t.attr("data-ad-client",o.adsense.adClient),t.attr("data-ad-slot")||t.attr("data-ad-slot",o.adsense.adSlot),t.attr("data-ad-format")||t.attr("data-ad-format",o.adsense.adFormat),console.log("Adsense attributs added to","#"+t.attr("id")),(adsbygoogle=window.adsbygoogle||[]).push({}),console.log("#"+t.attr("id")+" ad initialised with attributs ",t.data())):console.log("#"+t.attr("id")+" ad is in a hidden container and cannot be initialized now")})},i=function(){$.getScript(n+"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",function(){console.log("Google Adsense library loaded"),$("html").addClass("adsbygoogle-status-done")})},l=function(){$(function(){var e=$(window);$(o.parallax.selector).each(function(){var t=$(this);e.scroll(function(){var o=-(e.scrollTop()/t.data("speed")),n="50% "+o+"px";t.css({backgroundPosition:n})})})})},s=function(e){$.extend(!0,o.scrollTo,e),$(function(){$(o.scrollTo.toggleSelector).click(function(){return $.scrollTo(this.hash,1500,{easing:"swing"}),!1})})},c=function(){if(document.cookie){var t=document.cookie.split(";");t.forEach(function(e){document.cookie=e.split("=")[0]+"=; username=; expires=Thu, 01 Jan 1970 00:00:00 UTC"})}localStorage&&localStorage.clear(),$().garlic&&$(o.garlic.fieldsSelector).garlic("destroy"),e&&e.reset()},u=function(e){var t,o=$(e);return o&&(t=o.attr("type"),t&&"undefined"!==t||(t=o.prop("tagName").toLowerCase())),t},d=function(e){var t,o=$(e);if(o){var n=u(o);-1!==$.inArray(n,["radio","checkbox"])?(t=o.prop("checked"),t&&o.attr("value")&&(t=o.attr("value"))):t="file"===n?o.prop("files"):-1!==$.inArray(n,["text","password","select","textarea","hidden","color","date","datetime","datetime-local","email","month","number","range","search","tel","time","url","week"])?o.val():o.html()}return t},p=function(e,t,o){var n=$(e);if(n){var a=u(n);$.isArray(t)&&"textarea"!==a&&(t=t[0]||null),-1!==$.inArray(a,["radio","checkbox"])?n.prop("checked",t):"file"===a?"FileList"===$.type(t)&&n.attr("files",t):"textarea"===a?($.isArray(t)&&(t=t.join("\n")),n.val(t)):-1!==$.inArray(a,["text","password","select","hidden","color","date","datetime","datetime-local","email","month","number","range","search","tel","time","url","week"])?n.val(t):n.html(t),o!==!1&&n.trigger("change")}},m=function(){if(!e){if("function"!=typeof Basil)return!1;e=new window.Basil(o.basil)}var t,n,a,r;$(o.garlic.formsSelector).each(function(){t=$(this),t.find(":input").not(':button, [type="submit"], [type="reset"]').filter("[id]").each(function(){n=$(this),r=n.attr("id"),a=e.get(r),null!==a&&(p(n,a,!1),console.log("#"+r+" value restored",a)),n.on("change",function(t){var o=t.target;a=d(o),r=o.id,e.set(r,a),console.log("#"+r+" value stored",a)})})})},g=function(e){if(!o.inputReset.defaultAttribut)return!1;e||(e=o.dataReset.formsSelector);var t,n;$(e).find(":input").not(':file, :button, [type="submit"], [type="reset"]').each(function(){t=$(this),n=d(this),t.attr("data-"+o.inputReset.defaultAttribut,n)})},f=function(t){var n,a,r;return o.inputReset.defaultAttribut?(t||(t=o.inputReset.formsSelector),void $(t).find(":input").filter("[data-"+o.inputReset.defaultAttribut+"]").each(function(){n=$(this),a=n.attr("id"),r=n.data(o.inputReset.defaultAttribut),a&&(e&&e.remove(a),p(this,r))})):!1},y=function(){$(o.dataReset.toggleSelector).click(function(){swal?swal(o.swal.resetData,function(e){e&&(c(),location.reload())}):(c(),location.reload())})},h=function(){$(o.inputReset.toggleSelector).click(function(){f(),swal&&swal(o.swal.inputReset)})},w=function(e){if($.extend(!0,o.googleFonts,e),!window.WebFontConfig){if(!o.webFontLoader.config)return console.warn("Global variable WebFontConfig is not defined"),!1;window.WebFontConfig={},$.extend(!0,window.WebFontConfig,o.webFontLoader.config)}!function(e){var t=e.createElement("script"),n=e.scripts[0];t.src="https://ajax.googleapis.com/ajax/libs/webfont/"+o.webFontLoader.version+"/webfont.js",n.parentNode.insertBefore(t,n)}(document)},b=function(){console.log=function(){},console.time=function(){},console.timeEnd=function(){},o.disabledLogs.forEach(function(e){console[e]=function(){}})},v=function(){if(!o.debug)return b(),$(".debug-only").hide(),!1;if($(".debug-only").show(),console.log("Debug",o.debug),o.input.events){var e=o.input.events;$().chosen&&(e+=o.chosen.events),$().bootstrapSwitch&&(e+=o.bootstrapSwitch.events),$(":input").on(e,function(e){var t=[];t.push('"'+e.type+'" event fired on "'+e.target.tagName+'" element'),e.target.type&&t.push('[type="'+e.target.type+'"]'),e.target.id&&t.push('[id="'+e.target.id+'"]'),e.target.name&&t.push('[name="'+e.target.name+'"]'),"input"!==e.type&&"change"!==e.type||(t.push('value="'+e.target.value+'"'),"checkbox"!==e.target.type&&"radio"!==e.target.type||t.push('checked="'+e.target.checked+'"')),console.log(t.join(" "),e)})}console.time("jQuery is ready"),console.time("HTML is loaded and DOM is ready"),console.time("Images, frames and objects are loaded"),$(function(){console.timeEnd("jQuery is ready")}),$(document).ready(function(){console.timeEnd("HTML is loaded and DOM is ready")}),$(window).on("load",function(){console.timeEnd("Images, frames and objects are loaded")}),console.log("window",window),console.log("document",document),console.log("document.domain",document.domain),console.log("document.URL",document.URL),console.log("location",location),console.log("navigator",navigator),$().sortable&&o.sortable.events&&$(".ui-sortable").on(o.sortable.events,function(e){console.log("#"+$(this).attr("id")+" event "+e.type+"("+$(this).sortable("toArray").length+")")}),$().mixitup&&o.mixitup.selector&&$(o.mixitup.selector).on("mixLoad mixStart mixEnd mixFail mixBusy",function(e,t){console.log("mixItUp "+e.type+": "+t.totalShow+" elements match the current filter")}),$().garlic&&o.garlic.fieldsSelector&&$(o.garlic.selector).garlic({onRetrieve:function(e,t){console.log("Garlic retrieved for "+(e.attr("id")?'id="#'+e.attr("id")+'"':"")+" "+(e.attr("name")?'name="#'+e.attr("name")+'"':""),t)},onPersist:function(e,t){console.log("Garlic persisted value for "+(e.attr("id")?'id="#'+e.attr("id")+'"':"")+" "+(e.attr("name")?'name="#'+e.attr("name")+'"':""),t)}}),$().parsley&&$.each(["form:init","form:validate","form:success","form:error","form:validated","form:submit","field:init","field:validate","field:success","field:error","field:validated"],function(e,t){window.Parsley.on(t,function(){console.log("Parsley "+t,"#"+this.$element.attr("id"))})}),"function"==typeof i18next&&o.i18next.instance&&(o.i18next.instance.useLocalStorage=!1,o.i18next.instance.localStorageExpirationTime=0,o.i18next.instance.on("initialized",function(){console.log("i18next initialized")}).on("loaded",function(){console.log("i18next loaded")}).on("failedLoading",function(e,t,o){console.warn("i18next failed loading: "+o+" language: "+e+" ns: "+t)}))},S=function(e,t,o){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob))return!1;var n=new $.Deferred,r=0;return a.addJob(n),o=$.extend(!0,{},{format:"text",encoding:"UTF-8",cancelSelector:null},o),$.each(e,function(a,i){var l=new FileReader;"buffer"===o.format?l.readAsArrayBuffer(i,o.encoding):"binary"===o.format?l.readAsBinaryString(i,o.encoding):"data"===o.format?l.readAsDataURL(i,o.encoding):l.readAsText(i,o.encoding),l.onload=function(e){console.log("File load",e),t(e.target.result)},l.onloadstart=function(){},l.onloadend=function(){console.log(a+1+"/"+e.length+" file loaded"),r+=1,r===e.length&&(console.log("Last file loaded"),n.resolve())},l.onerror=function(){swal({title:"Oups!",text:"An error occured while trying to read your file.",type:"warning"})},o.cancelSelector&&$(o.cancelSelector).on("click",function(){l.abort()})}),n},M=function(){window.File&&window.FileReader&&window.FileList&&window.Blob||($('input[type="file"]').addClass("disabled"),console.warn("The File APIs are not fully supported by your browser."))},T=function(e){var t=$(e||"body");t&&t.on("click",'a[href^="#"]',function(){window.location.hash=""})},x=function(e,t,o){var n=[];return o.forEach(function(o){t[o]?e instanceof t[o]&&n.push(o):console.log(o+" is not defined")}),n},L=function(e){var t=e||navigator.language||navigator.userLanguage||navigator.languages[0]||"en";console.log("User language defined",t),$(o.selector.userLanguage).each(function(){$(this).val(t).trigger("change")})},k=function(e){o=$.extend(!0,{},t,e),o.debug&&v(),o.webFontLoader&&w(),$(function(){L(),o.inputReset&&(g(),h()),"function"==typeof Basil&&o.basil&&m(),o.dataReset&&y(),o.hideHash&&T(),M(),o.scrollTo&&s(),o.parallax&&l(),o.adsense&&i()})};return{hideHashOnClick:T,storeInputChanges:m,basil:e,getInputType:u,getInputValue:d,getInstancesOf:x,hideLogs:b,init:k,insertAdsenseAds:r,reader:S,resetInputValues:f,setInputValue:p,setUserLanguage:L,watchInputResetButton:h}}(),bootstrapModule=function(){var e,t={debug:!1,useHash:!0,showHash:!1,basil:{namespace:"bootstrap"},modal:{modalSelector:".modal",toggleSelector:'[data-toggle="modal"]'},tab:{toggleSelector:'[data-toggle="tab"]',storeActive:!0},tooltip:{toggleSelector:'[data-toggle="tooltip"]',options:{}},switchButton:{togglerSelector:".btn-switch"}},o=t;"undefined"!=typeof Basil&&(e=new window.Basil(o.basil));var n=function(){if("undefined"==typeof $.fn.tab)return console.warn("Bootstrap tab plugin is not loaded"),!1;var t,n=$(o.tab.toggleSelector),a="activeTab";if(n){if(o.useHash&&location.hash&&$(location.hash)&&n.filter('[href="'+location.hash+'"]').length>0?(t=location.hash,console.log("URL hash detected",t)):e&&(t=e.get(a),console.log("Hash restored",t)),t){var r=n.filter('[href="'+t+'"]').first();r.tab("show"),e&&e.set(a,t),console.log("Last active tab restored",t)}n.on("shown.bs.tab",function(n){t=n.target.hash,t&&(o.showHash?(location.hash=t,console.log("Active tab hash added to URL",t)):e&&(e.set(a,t),console.log("Active tab stored",t)))})}},a=function(){if(!$().tab)return!1;var e=$(o.tab.toggleSelector);e&&e.on("click",function(){$(".dropdown-menu").find(".active").removeClass("active")})},r=function(){if("undefined"==typeof $.fn.modal)return console.warn("Bootstrap modal plugin is not loaded"),!1;var t=$(o.modal.modalSelector),n="activeModal",a=e.get(n);if(t){if(o.useHash&&location.hash&&$(location.hash)&&t.filter(location.hash).length>0?(a=location.hash,console.log("URL hash detected",a)):e&&(a=e.get(n),console.log("Hash restored",a)),a){var r=$(a);r.modal("show"),e&&e.set(n,a),console.log("Last active modal restored",a)}t.on("shown.bs.modal",function(t){a="#"+t.target.id,e&&a&&(e.set(n,a),console.log("Active modal stored",a))}),t.on("hidden.bs.modal",function(){e&&(e.set(n,null),console.log("Active modal stored",null))})}},i=function(){return $().modal?void $(o.modal.modalSelector).on("show.bs.modal",function(e){var t,o=$(this),n=$(e.relatedTarget),a=n.data();if(a){if(a.filter){var r=o.find("section");console.log("Modal section filter",a.filter);var i;r&&r.each(function(){i=$(this),i.is(a.filter)?i.show():i.hide()})}a.title&&(t=o.find(".modal-title").first(),t&&t.text(a.title)),a.ok&&(t=o.find(".modal-footer .btn-primary").first(),t&&t.text(a.ok)),a.ok&&(t=o.find('.modal-footer [data-dismiss="modal"]').first(),t&&t.text(a.ok))}}):!1},l=function(e){if(!e)return!1;var t=[];return $.each(e,function(e,o){t.push('<li class="list-group-item">'+escape(o.name)+' <span class="badge">'+formatBytes(o.size)+(" "+o.type||"")+"<span></li>")}),'<ul class="list-group">'+t.join("")+"</ul>"},s=function(e,t){var n=$(e);return n?void n.find(o.tab.toggleSelector).one("shown.bs.tab",function(e){var o=$(e.target).attr("href");t(o)}):!1},c=function(){var e;$('input[type="range"]').each(function(){e=$(this),e.attr("data-original-title",e.val()),e.on("input",function(e){$(this).attr("data-original-title",e.target.value).tooltip("show")}),e.on("focus",function(){$(this).tooltip("show")})})},u=function(){$().tooltip&&$(o.tooltip.toggleSelector).tooltip(o.tooltip.options)},d=function(){if(!o.debug)return commonsModule.hideLogs(),!1;if(console.log("Bootstrap debug started"),$().tab){console.log("Tab plugin loaded");var e=$(o.tab.toggleSelector);console.log(e.length+" tab(s) found"),e.on("shown.bs.tab hidden.bs.tab",function(e){console.log(e.target.href+" tab "+e.type,e)})}if($().modal){console.log("Modal plugin loaded");var t=$(o.modal.modalSelector);console.log(t.length+" modal(s) found"),t.on("shown.bs.modal hidden.bs.modal",function(e){console.log("#"+e.target.id+" modal "+e.type,e)})}},p=function(){if($().tab){var e=$(o.tab.toggleSelector);e.on("shown.bs.tab",function(){commonsModule.hideHash()})}if($().modal){var t=$(o.modal.modalSelector);t.on("shown.bs.modal",function(){commonsModule.hideHash()})}},m=function(){$(o.switchButton.togglerSelector).click(function(){var e=$(this);$(this).parents(".btn-group").find(o.switchButton.togglerSelector).filter(".active").removeClass("active"),e.toggleClass("active")})},g=function(){if(!e)return!1;var t,n,a,r;$(o.switchButton.togglerSelector).filter("[id]").each(function(){t=$(this),t.on("click",function(){n=$(this).parents(".btn-group").find(o.switchButton.togglerSelector).filter("[id]"),n.length||(n=$(this)),n.each(function(){t=$(this),a=t.hasClass("active"),r=t.attr("id"),e.set(r,a),console.log("#"+r+" button state stored",a)})}),r=t.attr("id"),a=e.get(r),null!==a&&(a?t.trigger("click"):t.removeClass("active"),console.log("#"+r+" button click fired",a))})},f=function(e){o=$.extend(!0,{},t,e),d(),$(function(){o.useHash,$().tooltip&&o.tooltip&&(u(),c()),$().tab&&o.tab&&(a(),o.tab.storeActive&&n()),$().modal&&o.modal&&i(),$().button&&o.switchButton&&(m(),"function"==typeof Basil&&o.basil&&g())})};return{buildFileList:l,hideHashOnShown:p,init:f,oneShownHiddenTab:s,rangeValueTooltip:c,restoreActiveModal:r,settings:o}}(),MapModule=function(e,t){var o,n,a={ol:{},basil:{},narrowWidth:300,flatHeight:300,centerOnPosition:!0,debug:!0},r=function(){if(!n)return!1;var t=e.getView(),o={center:"getCenter",resolution:"getResolution",rotation:"getRotation"};$.each(o,function(e,o){t.on("change:"+e,function(t){n.set(e,this[o]()),console.log(e+" stored after view "+t.type,n.get(e))})})},i=function(){if(!n)return!1;var t,o=!1,a=e.getView(),r={center:"setCenter",resolution:"setResolution",rotation:"setRotation"};return $.each(r,function(e,r){t=n.get(e),null!==t?("function"==typeof a[r]?a[r](t):a.set(e,t),console.log("View "+e+" restored",t),o=!0):console.log("View "+e+" was not stored")}),o},l=function(){var t=e.getView();"change change:layerGroup change:size change:target change:view click dblclick moveend pointerdrag propertychange singleclick".split(" ").forEach(function(t){e.on(t,function(t){console.log("Map",t.type),t.key&&console.log("New "+t.key,e.get(t.key))})}),"change change:center change:resolution change:rotation propertychange".split(" ").forEach(function(e){t.on(e,function(e){console.log("View",e.type),e.key&&console.log("New "+e.key,t.get(e.key))})}),t.on("change:resolution",function(){console.log("New zoom",t.getZoom())})},s=function(){var t=e.getLayers();$.each(t,function(e,t){t.getVisible()?console.log("Selected layer",t.get("name")):console.log("Unselected layer",t.get("name")),t.on("change:visible",function(){this.getVisible()&&console.log("Selected layer",this.get("name"))})})},c=function b(e,t,o){if(e.get(t)===o)return e;if(e.getLayers){var n,a=e.getLayers().getArray();a.forEach(function(e){return n=b(e,t,o),n?n:void 0})}return null},u=function(t,o){var n=e.getView();n.setCenter(ol.proj.transform([t,o],"EPSG:4326","EPSG:3857")),console.log("Map centered at longitude: "+t+" latitude: "+o)},d=function(){var t=e.getView(),o=new ol.Geolocation({projection:t.getProjection(),tracking:!0});o.once("change:position",function(){t.setCenter(o.getPosition())})},p=function(t){t=parseInt(t),t&&e.getView().setZoom(t)},m=function(){var t=e.getView(),o=t.getExtent();t.fit(o,e.getSize())},g=function(){var t=e.getView(),o=ol.extent.createEmpty();e.getLayers().forEach(function(e){ol.extent.extend(o,e.getSource().getExtent())}),t.fit(o,e.getSize())},f=function(t){var o=t.getSource().getExtent();e.getView().fit(o,e.getSize())},y=function(t,o,n){var a=o.getSource(),r=a.getFeatureById(t),i=r.getGeometry(),l=e.getSize(),s=e.getView();s.fit(i,l,$.extend({padding:[0,0,0,0],constrainResolution:!1},n))},h=function(){e.updateSize(),o.toggleClass("narrow",o.width()<t.narrowWidth),o.toggleClass("flat",o.height()<t.flatHeight)},w=function(){t=$.extend(!0,{},a,t),o=$("#"+e.get("target")),window.onresize=function(){h()},h(),"undefined"!=typeof window.Basil&&(t.basil.namespace||(t.basil.namespace=e.get("target")),n=new window.Basil(t.basil),i()||t.centerOnPosition&&(d(),e.getView().setZoom(12)),r()),t.debug&&l()};return w(),{findLayerBy:c,fitLayerGeometry:y,fitLayers:g,fitVectorLayer:f,fitView:m,getSelectedBaseLayer:s,map:e,restoreMapProperties:i,setCenter:u,setCenterOnPosition:d,settings:t,setZoom:p,storeMapChanges:r,updateSize:h}},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},mapLayersModule=function(){var e,t,o={debug:!1,bingMapsKey:"Ak-dzM4wZjSqTlzveKz5u0d4IQ4bRzVI309GxmkgSVr1ewS6iPSrOvOKhA-CJlm3",properties:{visible:!1},basil:{}},n=["Base","Group","Heatmap","Image","Layer","Tile","Vector","VectorTile"],a=["BingMaps","CartoDB","Cluster","Image","ImageCanvas","ImageMapGuide","ImageStatic","ImageVector","ImageWMS","MapQuest","OSM","Raster","Source","Stamen","Tile","TileArcGISRest","TileDebug","TileImage","TileJSON","TileUTFGrid","TileWMS","Vector","VectorTile","WMTS","XYZ","Zoomify"],r=["GMLBase","JSONFeature","TextFeature","XML","XMLFeature","EsriJSON","Feature","GeoJSON","GML","GML2","GML3","GPX","IGC","KML","MVT","OSMXML","Polyline","TopoJSON","WFS","WKT","WMSCapabilities","WMSGetFeatureInfo","WMTSCapabilities"],i=["AtlasManager","Circle","Fill","Icon","Image","RegularShape","Stroke","Style","Text"],l={revision:"getRevision",state:"getState",urls:"getUrls",url:"getUrl"},s={Fill:"getFill",Image:"getImage",Stroke:"getStroke",Text:"getText"},c={color:"getColor",lineCap:"getLineCap",geometry:"getGeometry",geometryFunction:"getGeometryFunction",lineDash:"getLineDash",lineJoin:"getLineJoin",miterLimit:"getMiterLimit",width:"getWidth",zIndex:"getZIndex"},u={color:"setColor",lineCap:"setLineCap",geometry:"setGeometry",geometryFunction:"setGeometryFunction",lineDash:"setLineDash",lineJoin:"setLineJoin",miterLimit:"setMiterLimit",width:"setWidth",zIndex:"getZIndex"},d="https:"===window.location.protocol?"https:":"http:",p={};"function"==typeof Basil&&(t=new window.Basil(o.basil));var m=function(e){return o.debug?void"change change:blur change:extent change:gradient change:layers change:maxResolution change:minResolution change:opacity change:preload change:radius change:source change:useInterimTilesOnError change:visible change:zIndex".split(" ").forEach(function(t){e.on(t,function(t){t.key?console.log("Layer "+t.key+" changed",e.get(t.key)):console.log(t.target.get("name")+" layer"+t.type,t)})}):(commonsModule.hideLogs(),!1)},g=function(e){e.on("propertychange",function(){var o=e.get("name");if(o){var n=e.getProperties(),a="properties",r={visible:n.visible,zIndex:n.zIndex,opacity:n.opacity};t.set(a,r,{namespace:o}),console.log(o+" properties stored",r)}})},f=function(e){var o=e.get("name");if(o){var n="properties",a=t.get(n,{namespace:o});null!==a&&(e.setProperties(a),console.log(o+" "+n+" restored",a))}},y=function(e,n){if(!p[e])return console.warn(e+" layer definition is not defined"),!1;var a=p[e]();m(a),a.setProperties($.extend(!0,{},o.properties,n));var r=a.get("title");return r&&a.set("title",r+' <a href="#layer_settings_modal" data-toggle="modal" data-layer="'+e+'"><span class="glyphicon glyphicon-cog"></span></a>'),t&&(f(a),g(a)),a},h=function L(e,t){$.each(p,function(e,o){o.getLayers()?L(o,t):t(o)})},w=function(t){var o,n,a,r,i;if(!$().parsley)return console.warn("Parsley is not defined"),!1;var l=$(t);l.parsley({excluded:"input[type=button], input[type=submit], input[type=reset], input[type=hidden], [disabled], :hidden"}).on("field:success",function(){o=this.$element,o.is("[data-ol-layer][data-ol-property]")&&(n=o.data("ol-property"),a=commonsModule.getInputValue(o),n&&null!==a&&e.set(n,a)),o.is('[data-ol-source][data-ol-property="urls"]')&&(a=commonsModule.getInputValue(o),a=a.split("\n"),v(e,a)),o.is('[data-ol-source="Vector"][data-ol-format="GPX"]')&&(a=commonsModule.getInputValue(o),S(e,a,{dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"})),o.is("[data-ol-style][data-ol-property]")&&(n=o.data("ol-property"),a=commonsModule.getInputValue(o),i=o.data("ol-style"),r=e.getStyle(),s[i]&&_typeof(r[s[i]])&&(r=r[s[i]](),u[n]&&_typeof(r[u[n]])&&r[u[n]](a)))}).on("form:submit",function(){return!1})},b=function(t,o,u){var d,p,m,g,f=$(o),y=f.find(u);e=t,y.hide();var h=commonsModule.getInstancesOf(t,ol.layer,n);console.log("Layer types",h);var b=t.getKeys();console.log("Layer keys",b);var v=t.getProperties(t);if(console.log("Layer properties",v),"function"==typeof t.getSource)var S=t.getSource();if("function"==typeof t.getStyle)var M=t.getStyle();var T=h;if(T.push("*"),T.forEach(function(e){p=y.has('[data-ol-layer="'+e+'"]'),b.forEach(function(t){p.has('[data-ol-property="'+t+'"]').show().find("label small").html("("+e+")")})}),S){var x=commonsModule.getInstancesOf(S,ol.source,a);console.log("Layer source types",x);var L=S.getKeys();console.log("Layer source keys",L);var k=S.getProperties(t);if(console.log("Layer source properties",k),"function"==typeof S.getFormat)var C=S.getFormat();var B={};if($.each(l,function(e,t){"function"==typeof S[t]&&(g=S[t](),g&&!k[e]&&(B[e]=g))}),console.log("Source extra properties",B),T=x,T.push("*"),T.forEach(function(e){p=y.has('[data-ol-source="'+e+'"]'),L.forEach(function(t){p.has('[data-ol-property="'+t+'"]').show().find("label small").html("("+e+")")}),$.each(B,function(t){p.has('[data-ol-property="'+t+'"]').show().find("label small").html("("+e+")")})}),C){var A=commonsModule.getInstancesOf(C,ol.format,r);console.log("Layer format types",A),T=A,T.push("*"),T.forEach(function(e){p=y.has('[data-ol-format="'+e+'"]'),p.show().find("label small").html("("+e+")")}),p.has('[data-ol-format=""]').show()}}if(M){var I=commonsModule.getInstancesOf(M,ol.style,i);console.log("Layer style types",I);var _={};$.each(s,function(e,t){"function"==typeof M[t]&&(_[e]={},g=M[t](),g&&(I=commonsModule.getInstancesOf(g,ol.style,i),I?(console.log("Child style "+e+" found",I),T=I,T.push("*"),T.forEach(function(t){p=y.has('[data-ol-style="'+t+'"]'),$.each(c,function(o,n){"function"==typeof g[n]&&(g=g[n](),_[e][o]=g,p.has('[data-ol-property="'+o+'"]').show().find("label small").html("("+t+")"))})})):_[e]=g))}),console.log("Layer style properties",_)}if(v&&y.find(":input").filter("[data-ol-layer][data-ol-property]").each(function(){d=$(this),m=d.data("ol-property"),null!==v[m]&&(g=v[m],commonsModule.setInputValue(d,g),console.log("Layer property "+m+" populated",g))}),k&&y.find(":input").filter("[data-ol-source][data-ol-property]").each(function(){d=$(this),m=d.data("ol-property"),null!==k[m]&&(g=k[m],commonsModule.setInputValue(d,g),console.log("Source property "+m+" populated",g))}),B&&y.find(":input").filter("[data-ol-source][data-ol-property]").each(function(){d=$(this),m=d.data("ol-property"),null!==B[m]&&(g=B[m],commonsModule.setInputValue(d,g),console.log("Source property "+m+" populated",g))}),A&&y.find(":input").filter('[data-ol-source="Vector"][data-ol-format="GPX"]').each(function(){console.log('Layer input "file" ready',g)}),_){var F;y.find(":input").filter("[data-ol-style][data-ol-property]").each(function(){d=$(this),F=d.data("ol-style"),m=d.data("ol-property"),F&&m&&_[F]&&null!==_[F][m]&&(g=_[F][m],console.log(F+" "+m+" ("+("undefined"==typeof g?"undefined":_typeof(g))+")",g),commonsModule.setInputValue(d,g))})}w(o)},v=function(e,t){if(!e)return!1;var o=e.getSource();"undefined"!=typeof o.setUrls&&($.isArray(t)?o.setUrls(t):(t=$.trim(t),o.setUrl(t)))},S=function(e,t,o){if(0===t.length)return!1;var n=e.getSource();n.clear();var a=commonsModule.reader(t,function(t){var a=n.getFormat(),r=a.readFeatures(t,o);n.addFeatures(r),e.setVisible(!0)});return a},M=function(e){var t=0,o=e.get("name"),n=o.match(/([\-+]\d{2}):(\d{2})$/);if(n){var a=parseInt(n[1],10),r=parseInt(n[2],10);t=60*a+r}var i=new Date,l=new Date(i.getTime()+6e4*(i.getTimezoneOffset()+t)),s=Math.abs(12-l.getHours()+l.getMinutes()/60);s>12&&(s=24-s);var c=.75*(1-s/12);return[new ol.style.Style({fill:new ol.style.Fill({color:[85,85,85,c]}),stroke:new ol.style.Stroke({color:"#ffffff"})})]};p.openStreetMap=function(){return new ol.layer.Tile({name:"openStreetMap",title:'Road Map<small> (by <a href="https://www.openstreetmap.org">OpenStreetMap</a>)</small>',visible:!0,type:"base",source:new ol.source.OSM({urls:[d+"//a.tile.openstreetmap.org/{z}/{x}/{y}.png"]})})},p.openSeaMap=function(){return new ol.layer.Tile({name:"openSeaMap",title:'Shipping lanes<small> (by <a href="http://www.openseamap.org">OpenSeaMap</a>)</small>',type:"base",source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.openseamap.org/">OpenSeaMap</a>'}),ol.source.OSM.ATTRIBUTION],crossOrigin:null,urls:["http://tiles.openseamap.org/seamark/{z}/{x}/{y}.png","http://t1.openseamap.org/seamark/{z}/{x}/{y}.png"]})})},p.openStreetMapHumanitarian=function(){return new ol.layer.Tile({name:"openStreetMapHumanitarian",title:'Humanitarian <small>(by <a href="https://www.openstreetmap.org">OpenStreetMap</a>)</small>',type:"base",source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.openstreetmap.fr/">OpenStreetMap</a>'}),ol.source.OSM.ATTRIBUTION],url:d+"//tile-{a-c}.openstreetmap.fr/hot/{z}/{x}/{y}.png"})})},p.mapquestOSM=function(){return new ol.layer.Tile({name:"mapquestOSM",title:'Road map<small> (by <a href="http://open.mapquest.com">MapQuest</a>)</small>',type:"base",source:new ol.source.MapQuest({layer:"osm"})})},p.mapquestSat=function(){return new ol.layer.Tile({name:"mapquestSat",title:'Aerial view<small> (by <a href="http://open.mapquest.com">MapQuest</a>)</small>',type:"base",source:new ol.source.MapQuest({layer:"sat"})})},p.openCycleMap=function(){return new ol.layer.Tile({name:"openCycleMap",title:'Cycling roads<small> (by <a href="http://www.opencyclemap.org">OpenCycleMap</a>)</small>',type:"base",source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.opencyclemap.org/">OpenCycleMap</a>'}),ol.source.OSM.ATTRIBUTION],url:"http://{a-c}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png"})})},p.thunderforestTransport=function(){return new ol.layer.Tile({name:"thunderforestTransport",title:'Transports<small> (by <a href="http://www.thunderforest.com">ThunderForest</a>)</small>',type:"base",source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.thunderforest.com/">ThunderForest</a>'}),ol.source.OSM.ATTRIBUTION],url:"http://{a-c}.tile.thunderforest.com/transport/{z}/{x}/{y}.png"})})},p.thunderforestTransportDark=function(){
return new ol.layer.Tile({name:"thunderforestTransportDark",title:'Transport dark<small> (by <a href="http://www.thunderforest.com">ThunderForest</a>)</small>',type:"base",source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.thunderforest.com/">ThunderForest</a>'}),ol.source.OSM.ATTRIBUTION],url:"https://{a-c}.tile.thunderforest.com/transport-dark/{z}/{x}/{y}.png"})})},p.thunderforestLandscape=function(){return new ol.layer.Tile({name:"thunderforestLandscape",title:'Landscape<small> (by <a href="http://www.thunderforest.com">ThunderForest</a>)</small>',type:"base",source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.thunderforest.com/">ThunderForest</a>'}),ol.source.OSM.ATTRIBUTION],url:"https://{a-c}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png"})})},p.thunderforestOutdoor=function(){return new ol.layer.Tile({name:"thunderforestOutdoor",title:'Outdoor activities<small> (by <a href="http://www.thunderforest.com">ThunderForest</a>)</small>',type:"base",source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.thunderforest.com/">ThunderForest</a>'}),ol.source.OSM.ATTRIBUTION],url:"https://{a-c}.tile.thunderforest.com/outdoors/{z}/{x}/{y}.png"})})},p.arcgis=function(){return new ol.layer.Tile({name:"arcgis",title:'Terrain<small> (by <a href="https://services.arcgisonline.com">ArcGIS</a>)</small>',type:"base",source:new ol.source.XYZ({crossOrigin:"anonymous",attributions:[new ol.Attribution({html:'Tiles &copy; <a href="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer">ArcGIS</a>'})],url:d+"//server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"})})},p.arcgisRestHighwayUSA=function(){return new ol.layer.Tile({name:"arcgisRestHighwayUSA",title:'Highway USA<small> (by <a href="https://services.arcgisonline.com">ArcGIS</a>)</small>',type:"base",extent:[-13884991,2870341,-7455066,6338219],source:new ol.source.TileArcGISRest({url:d+"//sampleserver1.arcgisonline.com/ArcGIS/rest/services/Specialty/ESRI_StateCityHighway_USA/MapServer"})})},p.googleMap=function(){return new ol.layer.Tile({name:"googleMap",title:'Road map<small> (by <a href="https://www.google.com/maps/">Google</a>)</small>',type:"base",source:new ol.source.XYZ({crossOrigin:"anonymous",url:d+"//mt1.google.com/vt/lyrs=m@285235804&hl=en&x={x}&y={y}&z={z}&s=1"})})},p.googleTerrain=function(){return new ol.layer.Tile({name:"googleTerrain",title:'Terrain + labels<small> (by <a href="https://www.google.com/maps/">Google</a>)</small>',type:"base",source:new ol.source.XYZ({crossOrigin:"anonymous",url:d+"//mts1.google.com/vt/lyrs=t@132,r@285000000&hl=en&src=app&x={x}&y={y}&z={z}&s=1"})})},p.googleSatellite=function(){return new ol.layer.Tile({name:"googleSatellite",title:'Aerial view<small> (by <a href="https://www.google.com/maps/">Google</a>)</small>',type:"base",source:new ol.source.XYZ({crossOrigin:"anonymous",url:d+"//www.google.se/maps/vt/pb=!1m5!1m4!1i{z}!2i{x}!3i{y}!4i256!2m2!1e1!3i198!4e0"})})},p.bingRoad=function(){return new ol.layer.Tile({name:"bingRoad",title:'Road map<small> (by <a href="https://www.bing.com/maps/">Bing</a>)</small>',type:"base",maxZoom:19,source:new ol.source.BingMaps({key:o.bingMapsKey,imagerySet:"Road"})})},p.bingAerial=function(){return new ol.layer.Tile({name:"bingAerial",title:'Aerial view<small> (by <a href="https://www.bing.com/maps/">Bing</a>)</small>',type:"base",maxZoom:19,source:new ol.source.BingMaps({key:o.bingMapsKey,imagerySet:"Aerial"})})},p.bingAerialWithLabels=function(){return new ol.layer.Tile({name:"bingAerialWithLabels",title:'Aerial view with labels<small> (by <a href="https://www.bing.com/maps/">Bing</a>)</small>',type:"base",maxZoom:19,source:new ol.source.BingMaps({key:o.bingMapsKey,imagerySet:"AerialWithLabels"})})},p.bingCollinsBart=function(){return new ol.layer.Tile({name:"bingCollinsBart",title:'CollinsBart<small> (by <a href="https://www.bing.com/maps/">Bing</a>)</small>',type:"base",maxZoom:19,source:new ol.source.BingMaps({key:o.bingMapsKey,imagerySet:"collinsBart"})})},p.bingOrdnanceSurvey=function(){return new ol.layer.Tile({name:"bingOrdnanceSurvey",title:'OrdnanceSurvey<small> (by <a href="https://www.bing.com/maps/">Bing</a>)</small>',type:"base",maxZoom:19,source:new ol.source.BingMaps({key:o.bingMapsKey,imagerySet:"ordnanceSurvey"})})},p.stamenToner=function(){return new ol.layer.Tile({name:"stamenToner",title:'B&W map<small> (by <a href="http://maps.stamen.com">Stamen</a>)</small>',type:"base",source:new ol.source.Stamen({layer:"toner"})})},p.stamenTonerLite=function(){return new ol.layer.Tile({name:"stamenTonerLite",title:'Gray scale map<small> (by <a href="http://maps.stamen.com">Stamen</a>)</small>',type:"base",source:new ol.source.Stamen({layer:"toner-lite"})})},p.stamenTonerBackground=function(){return new ol.layer.Tile({name:"stamenTonerBackground",title:'B&W background<small> (by <a href="http://maps.stamen.com">Stamen</a>)</small>',type:"base",source:new ol.source.Stamen({layer:"toner-background"})})},p.stamenWatercolor=function(){return new ol.layer.Tile({name:"stamenWatercolor",title:'Watercolor map<small> (by <a href="http://maps.stamen.com">Stamen</a>)</small>',type:"base",source:new ol.source.Stamen({layer:"watercolor"})})},p.stamenTerrain=function(){return new ol.layer.Tile({name:"stamenTerrain",title:'Terrain USA<small> (by <a href="http://maps.stamen.com">Stamen</a>)</small>',type:"base",source:new ol.source.Stamen({layer:"terrain"})})},p.stamenTerrainWithLabels=function(){return new ol.layer.Tile({name:"stamenTerrainLabels",title:'Terrain + labels USA<small> (by <a href="http://maps.stamen.com">Stamen</a>)</small>',type:"base",source:new ol.source.Stamen({layer:"terrain-labels"})})},p.customBaseLayer=function(){return new ol.layer.Tile({name:"customBaseLayer",title:"Custom",type:"base",source:new ol.source.XYZ({urls:[]})})},p.mapsForFreeRelief=function(){return new ol.layer.Tile({name:"mapsForFreeRelief",title:'Relief<small> (by <a href="http://www.maps-for-free.com">maps-for-free.com</a>)</small>',type:"base",source:new ol.source.XYZ({maxZoom:12,urls:["http://www.maps-for-free.com/layer/relief/z{z}/row{y}/{z}_{x}-{y}.jpg"]})})},p.googleBike=function(){return new ol.layer.Tile({name:"googleBike",title:'Cycling roads<small> (by <a href="https://www.google.com/maps/">Google</a>)</small>',visible:!0,source:new ol.source.XYZ({crossOrigin:"anonymous",url:d+"//mts0.google.com/vt/lyrs=h@239000000,bike&hl=en&src=app&x={x}&y={y}&z={z}&s=1"})})},p.googleHybrid=function(){return new ol.layer.Tile({name:"googleHybrid",title:'Roads + labels<small> (by <a href="https://www.google.com/maps/">Google</a>)</small>',visible:!0,source:new ol.source.XYZ({crossOrigin:"anonymous",url:d+"//mt1.google.com/vt/lyrs=h@239000000&hl=en&x={x}&y={y}&z={z}&s=1"})})},p.mapquestHyb=function(){return new ol.layer.Tile({name:"mapquestHyb",title:'City names<small> (by <a href="http://open.mapquest.com">MapQuest</a>)</small>',source:new ol.source.MapQuest({layer:"hyb"})})},p.lonviaCycling=function(){return new ol.layer.Tile({name:"lonviaCycling",title:'Cycling roads<small> (by <a href="http://www.waymarkedtrails.org">Lonvia</a>)</small>',opacity:.6,source:new ol.source.OSM({attributions:[new ol.Attribution({html:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> and contributors <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'}),ol.source.OSM.ATTRIBUTION],crossOrigin:null,url:"http://tile.lonvia.de/cycling/{z}/{x}/{y}.png"})})},p.lonviaHiking=function(){return new ol.layer.Tile({name:"lonviaHiking",title:'Hiking paths<small> (by <a href="http://www.waymarkedtrails.org">Lonvia</a>)</small>',opacity:.6,source:new ol.source.OSM({attributions:[new ol.Attribution({html:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> and contributors <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'}),ol.source.OSM.ATTRIBUTION],crossOrigin:null,url:"http://tile.lonvia.de/hiking/{z}/{x}/{y}.png"})})},p.stamenTonerHybrid=function(){return new ol.layer.Tile({name:"stamenTonerHybrid",title:'B&W roads + labels<small> (by <a href="http://maps.stamen.com">Stamen</a>)</small>',source:new ol.source.Stamen({layer:"toner-hybrid"})})},p.stamenTonerLabels=function(){return new ol.layer.Tile({name:"stamenTonerLabels",title:'B&W labels<small> (by <a href="http://maps.stamen.com">Stamen</a>)</small>',source:new ol.source.Stamen({layer:"toner-labels"})})},p.stamenTonerLines=function(){return new ol.layer.Tile({name:"stamenTonerLines",title:'B&W roads<small> (by <a href="http://maps.stamen.com">Stamen</a>)</small>',source:new ol.source.Stamen({layer:"toner-lines"})})},p.mapsForFreeWater=function(){return new ol.layer.Tile({name:"mapsForFreeWater",title:'Water<small> (by <a href="http://www.maps-for-free.com">maps-for-free.com</a>)</small>',opacity:.7,source:new ol.source.XYZ({url:"http://www.maps-for-free.com/layer/water/z{z}/row{y}/{z}_{x}-{y}.gif"})})},p.mapsForFreeAdmin=function(){return new ol.layer.Tile({name:"mapsForFreeAdmin",title:'Admin<small> (by <a href="http://www.maps-for-free.com">maps-for-free.com</a>)</small>',opacity:.3,source:new ol.source.XYZ({url:"http://www.maps-for-free.com/layer/admin/z{z}/row{y}/{z}_{x}-{y}.gif"})})},p.uniHeidelbergAsterh=function(){return new ol.layer.Tile({name:"uniHeidelbergAsterh",title:'Hillshade<small> (by <a href="http://korona.geog.uni-heidelberg.de">uni-heidelberg.de</a>)</small>',source:new ol.source.XYZ({maxZoom:18,url:"http://korona.geog.uni-heidelberg.de/tiles/asterh/x={x}&y={y}&z={z}"})})},p.uniHeidelbergAdminb=function(){return new ol.layer.Tile({name:"uniHeidelbergAdminb",title:'Admin boundaries<small> (by <a href="http://korona.geog.uni-heidelberg.de">uni-heidelberg.de</a>)</small>',opacity:.8,source:new ol.source.XYZ({url:"http://korona.geog.uni-heidelberg.de/tiles/adminb/x={x}&y={y}&z={z}"})})},p.uniHeidelbergHybrid=function(){return new ol.layer.Tile({name:"uniHeidelbergHybrid",title:'Hibrid<small> (by <a href="http://korona.geog.uni-heidelberg.de">uni-heidelberg.de</a>)</small>',opacity:.8,source:new ol.source.XYZ({url:"http://korona.geog.uni-heidelberg.de/tiles/hybrid/x={x}&y={y}&z={z}"})})};var T=function(){console.warm("ImageData function in development")},x=function(e,t){var o,n,a,r,i,l,s,c,u,d,p,m,g,f,y,h=e[0],w=h.width,b=h.height,v=h.data,S=new Uint8ClampedArray(v.length),M=2*t.resolution,$=w-1,x=b-1,L=[0,0,0,0],k=2*Math.PI,C=Math.PI/2,B=Math.PI*t.sunEl/180,A=Math.PI*t.sunAz/180,I=Math.cos(B),_=Math.sin(B);for(n=0;x>=n;++n)for(i=0===n?0:n-1,l=n===x?x:n+1,o=0;$>=o;++o)a=0===o?0:o-1,r=o===$?$:o+1,s=4*(n*w+a),L[0]=v[s],L[1]=v[s+1],L[2]=v[s+2],L[3]=v[s+3],c=t.vert*(L[0]+2*L[1]+3*L[2]),s=4*(n*w+r),L[0]=v[s],L[1]=v[s+1],L[2]=v[s+2],L[3]=v[s+3],u=t.vert*(L[0]+2*L[1]+3*L[2]),d=(u-c)/M,s=4*(i*w+o),L[0]=v[s],L[1]=v[s+1],L[2]=v[s+2],L[3]=v[s+3],c=t.vert*(L[0]+2*L[1]+3*L[2]),s=4*(l*w+o),L[0]=v[s],L[1]=v[s+1],L[2]=v[s+2],L[3]=v[s+3],u=t.vert*(L[0]+2*L[1]+3*L[2]),p=(u-c)/M,m=Math.atan(Math.sqrt(d*d+p*p)),g=Math.atan2(p,-d),g=0>g?C-g:g>C?k-g+C:C-g,f=_*Math.cos(m)+I*Math.sin(m)*Math.cos(A-g),s=4*(n*w+o),y=255*f,S[s]=y,S[s+1]=y,S[s+2]=y,S[s+3]=v[s+3];return new T(S,w,b)};return p.mapboxShadedRelief=function(){return new ol.layer.Image({name:"mapboxShadedRelief",title:'Shaded relief<small> (by <a href="http://www.mapbox.com">Mapbox</a>)</small>',source:new ol.source.Raster({sources:[new ol.source.XYZ({url:"https://{a-d}.tiles.mapbox.com/v3/aj.sf-dem/{z}/{x}/{y}.png",crossOrigin:"anonymous"})],operationType:"image",operation:x}),opacity:.3})},p.timeZones=function(){return new ol.layer.Vector({name:"timeZones",title:"Time zones",style:M,minResolution:4891,source:new ol.source.Vector({extractStyles:!1,projection:"EPSG:3857",url:"data/kml/timezones.kml",format:new ol.format.KML})})},p.gpxFile=function(){return new ol.layer.Vector({name:"gpxFile",title:"GPS tracks",visible:!1,source:new ol.source.Vector({url:"",format:new ol.format.GPX}),style:new ol.style.Style({stroke:new ol.style.Stroke({color:"#33ff00",width:5})})})},p.drawingVector=function(){return new ol.layer.Tile({name:"drawing",title:"My drawings"})},p.customOverlay=function(){return new ol.layer.Tile({name:"customOverlay",title:"Custom",source:new ol.source.XYZ({urls:[]})})},{create:y,loadFileFeatures:S,initSettingsForm:b,selectedLayer:e,settings:o,treatLayers:h,updateSourceUrl:v}}(),mapControlsModule=function(){var e={},t=function(t){if(!e[t])return console.warn(t+" control definition is not defined"),!1;var o=e[t]();return o};return e.attribution=function(){return new ol.control.Attribution({collapsible:!0})},e.zoomSlider=function(){return new ol.control.ZoomSlider({})},e.zoomToExtent=function(){return new ol.control.ZoomToExtent({})},e.scaleLine=function(){return new ol.control.ScaleLine({})},e.fullScreen=function(){return new ol.control.FullScreen({})},e.overviewMap=function(){return new ol.control.OverviewMap({className:"ol-overviewmap ol-custom-overviewmap",collapseLabel:"«",label:"»",collapsed:!0})},e.layerSwitcher=function(){return new ol.control.LayerSwitcher({})},e.mousePosition=function(){return new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(4),projection:"EPSG:4326",className:"custom-mouse-position",target:document.getElementById("mouse-position"),undefinedHTML:"&nbsp;"})},{create:t}}(),mapInputsModule=function(){var e,t={},o=function(e,o){if(!t[e])return console.warn(e+" input definition does not exists"),!1;var n=t[e](o);return n};return t.layer=function(t){var o=$(t);o&&(e.getLayers().forEach(function(e){e.get("visible")&&o.val(e.get("name"))}),o.on("change",function(){var t=o.find(":selected").val();e.getLayers().forEach(function(e){e.set("visible",e.get("name")===t)})}))},t.zoom=function(t){var o=$(t);o&&(o.val(this.getZoom()),o.on("change",function(){var t=o.val();(t||0===t)&&e.getView().setZoom(t)}),e.getView().on("change:resolution",function(){o.val(this.getZoom())}))},t.resolution=function(t){var o=$(t);o&&(o.val(this.getResolution()),o.on("change",function(){var t=o.val();(t||0===t)&&e.getView().setResolution(t)}),e.getView().on("change:resolution",function(){o.val(this.getResolution())}))},t.rotation=function(t){var o=$(t);o.on("change",function(){var t=o.val();(t||0===t)&&e.getView().setRotation(t)}),e.getView().on("change:rotation",function(){o.val(this.getRotation())})},t.centerX=function(t){var o=$(t);o.on("change",function(){o.val()}),e.getView().on("change:center",function(){var e=this.getCenter();o.val(e[0])})},t.centerY=function(t){var o=$(t);o.on("change",function(){o.val()}),e.getView().on("change:center",function(){var e=this.getCenter();o.val(e[1])})},t.center=function(t,o){var n=$(t),a=$(o);e.getView().on("change:center",function(){var e=this.getCenter();e&&(n.val(e[0].toFixed(2)),a.val(e[1].toFixed(2)))}),$(t+", "+o).on("change",function(){!n.val()&&0!==n.val()||!a.val()&&0!==a.val()||e.getView().setCenter(n.val(),a.val())})},t.exportPNG=function(){var t=document.getElementById("export-png");t&&t.on("click",function(){e.once("postcompose",function(e){var o=e.context.canvas;t.attr("href",o.toDataURL("image/png"))})})},t.GPXSource=function(e,t){window.File&&window.FileReader&&window.FileList&&window.Blob||console.warn("The File APIs are not fully supported in this browser.");var o=$(e);o.on("change",function(e){var o=e.target.files;o.forEach(function(e){var o=new FileReader;o.onload=function(e){return function(o){t.setProperties({title:escape(e.name),source:new ol.source.Vector({url:o.target.result,format:new ol.format.GPX}),visible:!0})}}(e),o.readAsDataURL(e)})})},{create:o}}(),mapDrawModule=function(){var e,t=new ol.Collection,o=new ol.interaction.Modify({features:t,deleteCondition:function(e){return ol.events.condition.shiftKeyOnly(e)&&ol.events.condition.singleClick(e)}}),n=new ol.layer.Vector({source:new ol.source.Vector({features:t}),style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})}),a=function(e){n.setMap(e),e.addInteraction(o)},r=function(o,n){o&&(e=new ol.interaction.Draw({features:t,type:o}),n.addInteraction(e))},i=function(t,o){var n=document.getElementById(t);n.onchange=function(){o.removeInteraction(e),r(n.value,o)},r(n.value,o)};return{init:a,drawInteraction:r,addDrawTypeSwitcher:i}}(),pickerModule=function(){var e={allowedTypes:{admin:["country","state","state_district","county","island","islet","city_district","suburb","hamlet","locality","municipality","isolated_dwelling"],city:["city","town","village"],suburb:["city_district","suburb","hamlet","locality","municipality","isolated_dwelling"],road:["bike_route","bus-route-segment","fitness_trail","footway","historic_route","loc_route","master_route","nature trail","old_route","path","pedestrian","road","route","route","route-disabled","route-part","route-template","routeindex","routemaster","routerating","routetmp","route_fragments","route_link","route_master","route_rating","route_ref","route_section","runway","superroute","through_route","track","trail"],poi:null,various:null},disallowedTypes:{admin:null,city:null,suburb:null,road:null,poi:null,various:["country_code","postcode","neighbourhood"]}};e.disallowedTypes.poi=[].concat.apply([],[e.allowedTypes.admin,e.allowedTypes.city,e.allowedTypes.suburb,e.allowedTypes.road,e.disallowedTypes.various]);var t,o=0,n=21,a=-2,r="city",i="en",l="https:"===window.location.protocol?"https:":"http:",s=new Spinner({selector:"#map .spinner"}),c=function(e,t){console.time("Nominatim geocoding complete");var o=l+"//nominatim.openstreetmap.org/search/"+encodeURI(t)+"?"+$.param(e);return console.log("Nominatim geocoding request",o),$.ajax({url:o}).done(function(e){console.log("Nominatim geocoding result",JSON.stringify(e))}).fail(function(){console.warn("Nominatim geocoding failed")}).always(function(){console.timeEnd("Nominatim geocoding complete")})},u=function(e){console.time("Nominatim reverse geocoding complete");var t=l+"//nominatim.openstreetmap.org/reverse?"+$.param(e);return console.log("Nominatim reverse geocoding request",t),$.ajax({url:t}).done(function(e){console.log("Nominatim reverse geocoding result",JSON.stringify(e))}).fail(function(){console.warn("Nominatim reverse geocoding failed")}).always(function(){console.timeEnd("Nominatim reverse geocoding complete")})},d=function(e,o,n,a){var r=new $.Deferred;if(!e||!e.address)return r.resolve(e),!1;var l={format:"json",limit:1,polygon_svg:0,addressdetails:1,extratags:1,namedetails:1,"accept-language":i};a&&$.extend(l,a);var u=[],d=$.extend({},e.address);if(console.log("Search for an allowed place type in ",o),$.each(e.address,function(t,a){return o&&-1===$.inArray(t,o)||n&&-1!==$.inArray(t,n)?(delete l[t],void delete d[t]):(u.push(a),delete d[t],"house_number"===t&&e.address.road&&(u[0]=u[0]+" "+e.address.road,delete d.road),!1)}),u.length>0){var p=[];d.house_number&&p.push(e.address.house_number);var m=d.road||d.pedestrian;m&&p.push(m),p.length>0&&(l.street=p.join(" ")),d.city&&d.city!==u[0]&&(l.city=e.address.city,u.push(e.address.city)),d.county&&d.county!==u[0]&&(l.county=e.address.county,u.push(e.address.county)),d.state&&d.state!==u[0]&&(l.state=e.address.state,u.push(e.address.state)),d.country&&d.country!==u[0]&&(l.country=e.address.country,u.push(e.address.country)),t=c(l,$.unique(u)).done(function(e){r.resolve(e)}).fail(function(){r.resolve(e)})}else r.resolve(e);return s.addJob(r),r},p=function(t,o,n,a){var r=new $.Deferred;return t&&t.address?($.each(t.address,function(a,i){return o&&-1===$.inArray(a,o)||n&&-1!==$.inArray(a,n)||-1!==$.inArray(a,e.allowedTypes.poi)||r.resolve(t),!1}),"pending"===r.state()&&d(t,o,n,a).done(function(e){e.length>0?r.resolve(e[0]):r.resolve(t)}).fail(function(){r.resolve(t)})):r.resolve(t),r},m=function(t){var o,n=$("#road");if(!t||!n)return!1;if(t&&t.address){var a,r;$.each(t.address,function(e,t){return a=e,r=t,!1})}if((t&&t.namedetails||r)&&(o=t.namedetails.ref||t.namedetails.int_ref||t.namedetails.name||r),o&&a&&-1!==$.inArray(a,e.allowedTypes.road)){if(n.is(":focus")){var i=document.getElementById(n.attr("id")).selectionStart,l=n.val();o=l.substring(0,i)+o+l.substring(i)}n.attr("data-nominatim-reverse",JSON.stringify(t)),n.val(o).trigger("change")}},g=function(){var e=$("#auto_insert_road");if("road"!==r&&e&&e.is(":checked")){var t=$("#road"),o=t.data("nominatim-reverse"),n=t.val();roadbookModule.insertNominatimResult(o,{address:{road:n},namedetails:{name:n}})}},f=function(){var e=$("#default_type");if(e){var t=$('[data-pick-type="'+e.val()+'"]');t&&t.trigger("click")}},y=function(t){var i;t.on("singleclick",function(l){console.log("Pick type",r),console.log("Selected pick type",r);var s=t.getView(),c=s.getZoom();console.log("Zoom",c);var u=l.coordinate,d=s.getProjection();u=ol.proj.transform(u,d.getCode(),"EPSG:4326");var y=u[0],w=u[1];"admin"===r?(c=Math.min(Math.max(c+a,0),15),h(y,w,{osm_type:"relation",zoom:c}).done(function(t){p(t,e.allowedTypes[r],e.disallowedTypes[r],{zoom:c}).done(function(e){roadbookModule.insertNominatimResult(e),g(),f()})})):"city"===r?(c=Math.min(Math.max(c+a,10),16),h(y,w,{osm_type:"relation",zoom:c}).done(function(t){p(t,e.allowedTypes[r],e.disallowedTypes[r],{zoom:c}).done(function(e){roadbookModule.insertNominatimResult(e),g(),f()})})):"road"===r?(c=Math.min(Math.max(c+a,16),17),h(y,w,{osm_type:"way",zoom:c}).done(function(t){p(t,e.allowedTypes[r],e.disallowedTypes[r],{zoom:c}).done(function(e){m(e);var t=$("#auto_insert_road");if(t&&!t.is(":checked")){i=$("#road");var o=i.val();roadbookModule.insertNominatimResult(e,{address:{road:o},namedetails:{name:o}}),f()}})})):"poi"===r?(c=Math.min(Math.max(c+a,18),21),h(y,w,{osm_type:"node",zoom:c}).done(function(t){p(t,e.allowedTypes[r],e.disallowedTypes[r],{zoom:c}).done(function(e){roadbookModule.insertNominatimResult(e),g(),f()})})):(c=Math.min(Math.max(c+a,o),n),h(y,w,{zoom:c}).done(function(e){m(e),roadbookModule.insertNominatimResult(e),g(),f()}))})},h=function(e,o,n){var a={format:"json",lon:e,lat:o,addressdetails:1,extratags:1,namedetails:1,"accept-language":i};return console.log("getPlace options",n),$.extend(a,n),t=u(a),s.addJob(t),t};return $(function(){$("#zoom_delta").on("change",function(){a=parseInt($(this).val())}).trigger("change"),$("#zoom_max").on("change",function(){n=parseInt($(this).val())}).trigger("change"),$("#zoom_min").on("change",function(){o=parseInt($(this).val())}).trigger("change"),$("#user_language").on("change",function(){i=$(this).val()}).trigger("change");var e=$("[data-pick-type]");e.filter('[data-pick-type="'+r+'"]').trigger("click"),console.log("Pick type initialized",r),e.click(function(){r=$(this).data("pick-type"),console.log("Pick type changed",r)});var t=$("#road");t.on("change",function(){t.val()||t.attr("data-nominatim-reverse",null)})}),{geolocationXhr:t,watchMapClick:y}}(),styleModule=function(){var e,t={style:{containerSelector:"#roadbook_style"},basil:{namespace:"roadbook_style_editor"},quill:{containerSelector:"#roadbook_style_editor",styles:!1,formats:[]}},o=new window.Basil(t.basil),n=function(t){e.getLength()?swal({title:"Replace styles",text:"The current styles will be overwritten.\nDo you really want to continue?",type:"question",confirmButtonText:"Yes replace",cancelButtonText:"No stop !",showCancelButton:!0,buttonsStyling:!1,confirmButtonClass:"btn btn-warning",cancelButtonClass:"btn btn-warning"},function(o){o&&(e.setText(t),r())}):(e.setText(t),r())},a=function(){return e.getText()},r=function(){var n=e.getText();$(t.style.containerSelector).html(n),o.set("contents",e.getContents()),console.log("Style updated")},i=function(){e=new Quill(t.quill.containerSelector,t.quill),e.on("text-change",function(e,t){"user"===t&&r(),appModule.updateSaveLink()});var n=$(t.style.containerSelector).html();$(t.style.containerSelector).attr("data-default-value",n);var a=o.get("contents");a?(e.setContents(a),r()):e.setText(n),$(".reset_style").click(function(){n=$(t.style.containerSelector).data("default-value"),e.setText(n),r(),swal({title:"Done",text:"Styles have been reset with the default values.",type:"success",timer:3e3,showConfirmButton:!1})})},l=function(){return e},s=function(){i()};return $(function(){}),{getEditor:l,init:s,getStyle:a,updateStyle:r,replaceTextAlert:n}}(),roadbookModule=function(){var e,t=" ",o={basil:{namespace:"roadbook"},quill:{styles:!1}},n=["cuisine","place","population","religion","shop"],a=["description","denomination","wikidata","wikipedia","contact","website","opening_hours","drive_through","data-wheelchair"];if("function"==typeof Basil)var r=new window.Basil(o.basil);var i=function(){var t=0;e.focus();var o=e.getSelection();return t=o?o.start:e.getLength()-1,console.log("getCaretPos",t),t},l=function(){e.focus();var t=e.getSelection();t&&t.start!==t.end&&(e.deleteText(t.start,t.end),console.log("Selection deleted from ",t.start+" to "+t.end))},s=function(o,r){var s,c={span:!0},u=[],d="";if(o=$.extend(!0,o||{},r),console.log("json",o),o&&o.lat&&o.lon&&(c.latitude=o.lat,c.longitude=o.lon),o&&o.address&&$.each(o.address,function(e,t){return c.addrType=e,s=t,"house_number"===e&&o.address.road&&(s=s+" "+o.address.road),console.log("Detected type",c.type),!1}),o&&o.extratags&&(o.extratags.population&&(c.populationLevel=Math.log(o.extratags.population).toFixed(0)),o.extratags.capital&&(c.capital=o.extratags.capital),$.each(o.extratags,function(t,o){t=t.replace(/[:].*$/,""),-1===$.inArray(t,a)&&(-1===$.inArray(t,n)&&(n.push(t),e.addFormat(t,{attribute:"data-"+t})),c[t]=o)})),o&&o["class"]&&(c["class"]=o["class"]),o&&o.type&&(c.type=o.type),o&&o.icon){var p=o.icon.replace(/^.*\//g,"").replace(/\.[a-z]+\.[0-9]+\.png/i,"");c.icon=p}if(o&&o.namedetails&&o.namedetails.name){var m=$.map(o.namedetails.name.split(/(?:[\/,;:]| - )+/),$.trim);$.merge(u,m)}if(r&&r.namedetails&&o.namedetails.name&&(s=null),!u.length&&s&&(u.push(s),s=null),u.length>0){l();var g=i();console.log("Names",u),d=$.unique(u).shift(),e.insertText(g,d,c,"user"),g+=d.length,s&&s!==d&&(d=t,e.insertText(g,d,!1,"user"),g+=t.length,d=s,e.insertText(g,d,{span:!0,"class":"translation"},"user"),g+=d.length),e.insertText(g,t,!1,"user"),g+=t.length,e.setSelection(g,g,"user"),console.log("Nominatim result inserted.")}else console.log("Nominatim result does not contain any valid place name.")},c=function(t){e.getLength()?swal({title:"Replace styles",text:"The current styles will be overwritten.\nDo you really want to continue?",type:"warning",confirmButtonText:"Yes replace",cancelButtonText:"No stop !",showCancelButton:!0,buttonsStyling:!1,confirmButtonClass:"btn btn-warning",cancelButtonClass:"btn btn-warning"},function(o){o&&e.setHTML(t)}):e.setHTML(t)},u=function(){var t=$('.save_roadbook, .copy_roadbook, .print_roadbook, .new_roadbook, .erase_roadbook, [data-target="#style_edition_modal"]'),o=e.getLength()>1;t.attr("disabled",!o).closest("li").toggleClass("disabled",!o)},d=function(){appModule.buildExport().done(function(e){var t=window.open("",window.location.hostname,"");t.document.write(e),t.print(),t.close()})},p=function(){return e},m=function(){var t=$("#editor");if(e=new Quill("#editor",o.quill),$("#editor").find(".ql-editor").addClass("roadbook"),e.addFormat("capital",{attribute:"data-capital"}),e.addFormat("class",{attribute:"data-class"}),e.addFormat("icon",{attribute:"data-icon"}),e.addFormat("latitude",{attribute:"data-latitude"}),e.addFormat("longitude",{attribute:"data-longitude"}),e.addFormat("nominatimReverse",{attribute:"data-nominatim-reverse"}),e.addFormat("placeType",{attribute:"[data-type-type"}),e.addFormat("populationLevel",{attribute:"data-population-level"}),e.addFormat("span",{tag:"span"}),e.addFormat("tagType",{attribute:"data-tag-type"}),e.addFormat("tagValue",{attribute:"data-tag-value"}),e.addFormat("type",{attribute:"data-type"}),e.addFormat("addrType",{attribute:"data-address-type"}),$.each(n,function(t,o){e.addFormat(o,{attribute:"data-"+o})}),e.on("text-change",function(){u(),appModule.updateSaveLink(),t.scrollTop(t[0].scrollHeight),$("#roadbook_editor_contents").html(JSON.stringify(e.getContents())),r&&r.set("roadbook_editor_contents",e.getContents())}),e.on("selection-change",function(e,t){var o=$("#editor_toolbar").find('[data-target="#style_edition_modal"], .ql-bold, .ql-italic, .ql-strike, .ql-underline, .ql-size, .ql-color, .ql-background');e?e.start===e.end?(o.attr("disabled",!0).closest("li").addClass("disabled"),console.log("Caret moved by "+t,e.start)):(o.attr("disabled",!1).closest("li").removeClass("disabled"),console.log("Text selected by "+t,e.start+" to "+e.end)):console.log("Editor lost focus")}),r){var a=r.get("roadbook_editor_contents");if(a){e.getSelection(),e.setContents(a),console.log("Roadbook content restored");var i=e.getLength()-1;e.setSelection(i,i,"user")}}},g=function(){u(),$(".print_roadbook").click(function(e){e.preventDefault(),d()}),$("#insert_road").click(function(e){e.preventDefault();var t=$("#road"),o=t.data("nominatim-reverse"),n=t.val();roadbookModule.insertNominatimResult(o,n)}),$(".erase_roadbook, .new_roadbook").click(function(t){t.preventDefault(),swal({title:"Delete roadbook",text:"The current roadbook will be permanently removed.\nDo you really want to continue?",type:"warning",confirmButtonText:"Yes delete",cancelButtonText:"No cancel",showCancelButton:!0},function(o){o&&(e.deleteText(0,e.getLength()-1,"user"),"new_roadbook"===t.currentTarget.id||swal({title:"Deleted!",text:"Your roadbook has been deleted.\nLet's start a new one!",type:"success",timer:3e3,showConfirmButton:!1}))})}),$("#file_settings_form").on("submit",function(e){e.preventDefault(),$("#file_settings_modal").modal("hide"),appModule.updateSaveLink(),$(".save_roadbook").first().trigger("click")})},f=function(){m(),g()};return $(function(){var e=$("#style_edition_modal");e.find(".modal-footer .btn-primary").on("click",function(){e.modal("hide")}),$("#map_width").on("change",function(e){var t=$("#editor_pane").find(".container-fluid > .row > div"),o=e.target.value;t.removeClass(function(e,t){return(t.match(/(^|\s)col-md-\S+/g)||[]).join(" ")}),t.eq(0).addClass("col-md-"+o),t.eq(1).addClass("col-md-"+(12-o))}).trigger("change")}),{getEditor:p,init:f,insertNominatimResult:s,replaceHtmlAlert:c}}(),htmlEditorModule=function(){var e,t=function(){return e},o=function(){var t=roadbookModule.getEditor();e.setText(t.getHTML()),e.on("text-change",function(o,n){"user"===n&&t.setHTML(e.getText())}),t.on("text-change",function(o,n){"user"===n&&e.setText(t.getHTML())})},n=function(){e=new Quill("#roadbook_editor_html",{}),o()};return{getEditor:t,init:n}}(),importModule=function(){var e=function(e){commonsModule.reader(e,function(e){swal({title:"Replace roadbook",text:"Current roadbook and / or style will be replaced.\nDo you really want to continue?",type:"question",showCancelButton:!0,confirmButtonText:"Yes replace",cancelButtonText:"No cancel",closeOnConfirm:!1},function(t){if(t){var o,n=$("<div>").append(e);if($("#import_html").is(":checked")){o=n.find(".roadbook").html();var a=roadbookModule.getEditor();a.setHTML(o),o=n.find("title").text(),$("#roadbook_title").val(o).trigger("change"),o=n.find('meta[name="description"]').attr("content"),$("#roadbook_description").val(o).trigger("change")}if($("#import_style").is(":checked")){o=n.find("style").html();var r=styleModule.getEditor();r.setText(o),styleModule.updateStyle()}swal({title:"Imported!",text:"Your file has been imported.\nLet's start editing!",type:"success",timer:3e3,showConfirmButton:!1})}})})},t=function(){$("#import_form").on("submit",function(t){t.preventDefault(),$("#import_modal").modal("hide");var o=document.getElementById("html_file").files;e(o)})};return $(function(){}),{init:t}}(),appModule=function(){var debug=!!parseInt($.urlParam("debug")),mapMod1,mapIconsStyle,selectedLayer;commonsModule.init({
debug:debug}),mapLayersModule.settings.debug=debug,swal.setDefaults({buttonsStyling:!1,confirmButtonClass:"btn btn-primary",cancelButtonClass:"btn btn-default"});var openCycleMapLayer=mapLayersModule.create("openCycleMap"),openStreetMapLayer=mapLayersModule.create("openStreetMap",{visible:!0}),mapsForFreeReliefLayer=mapLayersModule.create("mapsForFreeRelief"),customBaseLayerLayer=mapLayersModule.create("customBaseLayer"),googleMapLayer=mapLayersModule.create("googleMap"),googleTerrainLayer=mapLayersModule.create("googleTerrain"),googleSatelliteLayer=mapLayersModule.create("googleSatellite"),mapquestOSMLayer=mapLayersModule.create("mapquestOSM"),mapquestSatLayer=mapLayersModule.create("mapquestSat"),gpxFileLayer=mapLayersModule.create("gpxFile",{zIndex:8}),googleHybridLayer=mapLayersModule.create("googleHybrid",{zIndex:7}),googleBikeLayer=mapLayersModule.create("googleBike",{zIndex:6}),lonviaCyclingLayer=mapLayersModule.create("lonviaCycling",{zIndex:5}),lonviaHikingLayer=mapLayersModule.create("lonviaHiking",{zIndex:4}),mapquestHybLayer=mapLayersModule.create("mapquestHyb",{zIndex:3}),uniHeidelbergAsterhLayer=mapLayersModule.create("uniHeidelbergAsterh",{zIndex:2}),customOverlayLayer=mapLayersModule.create("customOverlay",{zIndex:1}),attributionControl=mapControlsModule.create("attribution"),scaleLineControl=mapControlsModule.create("scaleLine"),fullScreenControl=mapControlsModule.create("fullScreen"),layerSwitcherControl=mapControlsModule.create("layerSwitcher"),zoomSliderControl=mapControlsModule.create("zoomSlider"),godfatherMode=!!parseInt($.urlParam("godfather"));console.log("Godfather mode",godfatherMode);var initAddthisWidget=function(){var e={url:document.URL,title:"I'm doing a tiny roadbook for my next tour"},t=roadbookModule.getEditor();t.on("text-change",function(){var o=t.getText();$.extend(e,{description:o.substring(0,100)+(o.length>100?"...":"")})})},buildExport=function(){var e="",t=new $.Deferred,o=roadbookModule.getEditor(),n=styleModule.getEditor(),a=window.location.hostname,r=$("#roadbook_title");r&&r.val()&&(a=r.val());var i="";return r=$("#roadbook_description"),r&&r.val()&&(i=r.val()),o&&n&&mapIconsStyle&&(e="<html>\n<head>\n<title>"+a+'</title>\n<meta content="text/html; charset=UTF-8" http-equiv="content-type">\n<meta name="description" content="'+i+'">\n<style type="text/css">\n'+n.getText()+"\n"+mapIconsStyle+'\n</style>\n</head>\n<body>\n<div class="roadbook">\n'+o.getHTML()+"\n</div>\n</body>\n</html>",t.resolve(e)),t},updateSaveLink=function(){buildExport().done(function(e){e&&$(".save_roadbook").attr("href","data:text/html;base64, "+Base64.encode(e))});var e=$("#roadbook_title");if(e){var t=$.trim(e.val()||document.domain).replace(/\s+/gi,"_").replace(/[^a-zA-Z0-9\_-]/gi,"")+".html";$(".save_roadbook").attr("download",t)}},initMap=function(e){var t;t=godfatherMode?[new ol.layer.Group({name:"baseLayers",title:"Base map",layers:[customBaseLayerLayer,googleSatelliteLayer,mapquestSatLayer,googleTerrainLayer,mapsForFreeReliefLayer,openCycleMapLayer,googleMapLayer,mapquestOSMLayer,openStreetMapLayer]}),new ol.layer.Group({name:"overlays",title:"Overlays",layers:[customOverlayLayer,uniHeidelbergAsterhLayer,mapquestHybLayer,lonviaHikingLayer,lonviaCyclingLayer,googleBikeLayer,googleHybridLayer,gpxFileLayer]})]:[new ol.layer.Group({name:"baseLayers",title:"Base map",layers:[customBaseLayerLayer,mapquestSatLayer,openCycleMapLayer,mapquestOSMLayer,openStreetMapLayer]}),new ol.layer.Group({name:"overlays",title:"Overlays",layers:[customOverlayLayer,mapquestHybLayer,lonviaHikingLayer,lonviaCyclingLayer,gpxFileLayer]})];var o=ol.control.defaults({attribution:!1,attributionOptions:{collapsible:!1},zoomOptions:{}}).extend([attributionControl,scaleLineControl,fullScreenControl,zoomSliderControl,layerSwitcherControl]);return new ol.Map({layers:t,target:e,view:new ol.View({center:[0,0],zoom:4,minZoom:2,maxZoom:19}),controls:o,logo:!1})};return $(function(){console.time("Bootstrap module initialized"),bootstrapModule.init({debug:debug}),roadbookModule.init(),htmlEditorModule.init(),styleModule.init(),importModule.init(),initAddthisWidget();var $input,$tabs=$('a[data-toggle="tab"]');$tabs.filter('[href="#editor_pane"]').one("shown.bs.tab",function(){return mapMod1?!1:(mapMod1=new MapModule(initMap("map"),{debug:debug}),console.log("Map initialized"),$("#map_width").on("change",function(){$tabs.filter('[href="#editor_pane"]').one("shown.bs.tab",function(){mapMod1.updateSize()})}),pickerModule.watchMapClick(mapMod1.map),$("#layer_settings_modal").on("show.bs.modal",function(e){var $modal=$(this),layerVarName=$(e.relatedTarget).data("layer")+"Layer";if("undefined"!=typeof layerVarName&&(selectedLayer=eval(layerVarName)),selectedLayer){mapLayersModule.initSettingsForm(selectedLayer,"#layer_settings_form",".form-group");var title=selectedLayer.get("title");$modal.find(".modal-title").html(title),bootstrapModule.rangeValueTooltip()}}),$("#layer_settings_form").on("submit",function(e){e.preventDefault();var t=$("#layer_settings_modal");t.modal("hide")}),commonsModule.hideHashOnClick("#map .layer-switcher"),void $(".layer-switcher").on("click",'a[data-toggle="modal"]',function(e){e.preventDefault(),$(this).trigger("click.bs.modal.data-api")}))}),$tabs.filter('[href="#settings_pane"]').one("shown.bs.tab",function(){}),$tabs.filter('[href="#style_pane"]').one("shown.bs.tab",function(){}),$.get("styles/poi.css",function(e){mapIconsStyle=e,updateSaveLink()}),$input=$("#gpx_file"),$input.on("change",function(e){var t=e.target.files,o=bootstrapModule.buildFileList(t);$("#"+$input.attr("id")+"_output").html(o)})}),{mapMod1:mapMod1,buildExport:buildExport,updateSaveLink:updateSaveLink}}();